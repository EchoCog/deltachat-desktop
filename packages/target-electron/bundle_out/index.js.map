{
  "version": 3,
  "sources": ["../src/cjs-shim.ts", "../../../node_modules/.pnpm/ini@1.3.8/node_modules/ini/ini.js", "../../../node_modules/.pnpm/strip-json-comments@2.0.1/node_modules/strip-json-comments/index.js", "../../../node_modules/.pnpm/rc@1.2.8/node_modules/rc/lib/utils.js", "../../../node_modules/.pnpm/deep-extend@0.6.0/node_modules/deep-extend/lib/deep-extend.js", "../../../node_modules/.pnpm/minimist@1.2.6/node_modules/minimist/index.js", "../../../node_modules/.pnpm/rc@1.2.8/node_modules/rc/index.js", "../../../node_modules/.pnpm/stackframe@1.3.4/node_modules/stackframe/stackframe.js", "../../../node_modules/.pnpm/error-stack-parser@2.1.4/node_modules/error-stack-parser/error-stack-parser.js", "../../../node_modules/.pnpm/dotenv@16.4.5/node_modules/dotenv/package.json", "../../../node_modules/.pnpm/dotenv@16.4.5/node_modules/dotenv/lib/main.js", "../../../node_modules/.pnpm/application-config-path@0.1.0/node_modules/application-config-path/index.js", "../../../node_modules/.pnpm/mkdirp@0.5.6/node_modules/mkdirp/index.js", "../../../node_modules/.pnpm/application-config@1.0.1/node_modules/application-config/index.js", "../../../node_modules/.pnpm/debounce@1.2.1/node_modules/debounce/index.js", "../src/index.ts", "../src/rc.ts", "../src/electron-context-menu.ts", "../src/load-translations.ts", "../../shared/logger.ts", "../../shared/localize.ts", "../src/menu.ts", "../../shared/constants.ts", "../src/application-constants.ts", "../src/application-config.ts", "../src/windows/main.ts", "../src/tray.ts", "../src/desktop_settings.ts", "../../shared/state.ts", "../src/windows/helpers.ts", "../src/content-protection.ts", "../src/isAppx.ts", "../src/getLocaleDirectory.ts", "../src/help_menu.ts", "../src/resume_from_sleep.ts", "../src/log-handler.ts", "../src/ipc.ts", "../src/windows/help.ts", "../src/windows/html_email.ts", "../../shared/util.ts", "../src/open_url.ts", "../src/themes.ts", "../../shared/themes.ts", "../src/deltachat/controller.ts", "../src/deltachat/webxdc.ts", "../src/deltachat/stdio_server.ts", "../src/get-build-info.ts", "../src/deltachat/migration.ts", "../src/notifications.ts", "../src/cleanup_temp_dir.ts"],
  "sourcesContent": ["import { createRequire } from 'node:module'\nimport path from 'node:path'\nimport url from 'node:url'\n\nglobalThis.require = createRequire(import.meta.url)\nglobalThis.__filename = url.fileURLToPath(import.meta.url)\nglobalThis.__dirname = path.dirname(__filename)\n\n// from https://github.com/evanw/esbuild/issues/1921#issuecomment-1898197331\n// read the issue for more context, basically esbuild can not convert cjs style `require()` calls to import calls (yet).\n// and since we output esm, \"require\" is not avaiable unless we bing it back with this trick.\n// Another option would be to only use esm dependencies, but that's too much work at the time of writing this.\n", "exports.parse = exports.decode = decode\n\nexports.stringify = exports.encode = encode\n\nexports.safe = safe\nexports.unsafe = unsafe\n\nvar eol = typeof process !== 'undefined' &&\n  process.platform === 'win32' ? '\\r\\n' : '\\n'\n\nfunction encode (obj, opt) {\n  var children = []\n  var out = ''\n\n  if (typeof opt === 'string') {\n    opt = {\n      section: opt,\n      whitespace: false,\n    }\n  } else {\n    opt = opt || {}\n    opt.whitespace = opt.whitespace === true\n  }\n\n  var separator = opt.whitespace ? ' = ' : '='\n\n  Object.keys(obj).forEach(function (k, _, __) {\n    var val = obj[k]\n    if (val && Array.isArray(val)) {\n      val.forEach(function (item) {\n        out += safe(k + '[]') + separator + safe(item) + '\\n'\n      })\n    } else if (val && typeof val === 'object')\n      children.push(k)\n    else\n      out += safe(k) + separator + safe(val) + eol\n  })\n\n  if (opt.section && out.length)\n    out = '[' + safe(opt.section) + ']' + eol + out\n\n  children.forEach(function (k, _, __) {\n    var nk = dotSplit(k).join('\\\\.')\n    var section = (opt.section ? opt.section + '.' : '') + nk\n    var child = encode(obj[k], {\n      section: section,\n      whitespace: opt.whitespace,\n    })\n    if (out.length && child.length)\n      out += eol\n\n    out += child\n  })\n\n  return out\n}\n\nfunction dotSplit (str) {\n  return str.replace(/\\1/g, '\\u0002LITERAL\\\\1LITERAL\\u0002')\n    .replace(/\\\\\\./g, '\\u0001')\n    .split(/\\./).map(function (part) {\n      return part.replace(/\\1/g, '\\\\.')\n        .replace(/\\2LITERAL\\\\1LITERAL\\2/g, '\\u0001')\n    })\n}\n\nfunction decode (str) {\n  var out = {}\n  var p = out\n  var section = null\n  //          section     |key      = value\n  var re = /^\\[([^\\]]*)\\]$|^([^=]+)(=(.*))?$/i\n  var lines = str.split(/[\\r\\n]+/g)\n\n  lines.forEach(function (line, _, __) {\n    if (!line || line.match(/^\\s*[;#]/))\n      return\n    var match = line.match(re)\n    if (!match)\n      return\n    if (match[1] !== undefined) {\n      section = unsafe(match[1])\n      if (section === '__proto__') {\n        // not allowed\n        // keep parsing the section, but don't attach it.\n        p = {}\n        return\n      }\n      p = out[section] = out[section] || {}\n      return\n    }\n    var key = unsafe(match[2])\n    if (key === '__proto__')\n      return\n    var value = match[3] ? unsafe(match[4]) : true\n    switch (value) {\n      case 'true':\n      case 'false':\n      case 'null': value = JSON.parse(value)\n    }\n\n    // Convert keys with '[]' suffix to an array\n    if (key.length > 2 && key.slice(-2) === '[]') {\n      key = key.substring(0, key.length - 2)\n      if (key === '__proto__')\n        return\n      if (!p[key])\n        p[key] = []\n      else if (!Array.isArray(p[key]))\n        p[key] = [p[key]]\n    }\n\n    // safeguard against resetting a previously defined\n    // array by accidentally forgetting the brackets\n    if (Array.isArray(p[key]))\n      p[key].push(value)\n    else\n      p[key] = value\n  })\n\n  // {a:{y:1},\"a.b\":{x:2}} --> {a:{y:1,b:{x:2}}}\n  // use a filter to return the keys that have to be deleted.\n  Object.keys(out).filter(function (k, _, __) {\n    if (!out[k] ||\n      typeof out[k] !== 'object' ||\n      Array.isArray(out[k]))\n      return false\n\n    // see if the parent section is also an object.\n    // if so, add it to that, and mark this one for deletion\n    var parts = dotSplit(k)\n    var p = out\n    var l = parts.pop()\n    var nl = l.replace(/\\\\\\./g, '.')\n    parts.forEach(function (part, _, __) {\n      if (part === '__proto__')\n        return\n      if (!p[part] || typeof p[part] !== 'object')\n        p[part] = {}\n      p = p[part]\n    })\n    if (p === out && nl === l)\n      return false\n\n    p[nl] = out[k]\n    return true\n  }).forEach(function (del, _, __) {\n    delete out[del]\n  })\n\n  return out\n}\n\nfunction isQuoted (val) {\n  return (val.charAt(0) === '\"' && val.slice(-1) === '\"') ||\n    (val.charAt(0) === \"'\" && val.slice(-1) === \"'\")\n}\n\nfunction safe (val) {\n  return (typeof val !== 'string' ||\n    val.match(/[=\\r\\n]/) ||\n    val.match(/^\\[/) ||\n    (val.length > 1 &&\n     isQuoted(val)) ||\n    val !== val.trim())\n    ? JSON.stringify(val)\n    : val.replace(/;/g, '\\\\;').replace(/#/g, '\\\\#')\n}\n\nfunction unsafe (val, doUnesc) {\n  val = (val || '').trim()\n  if (isQuoted(val)) {\n    // remove the single quotes before calling JSON.parse\n    if (val.charAt(0) === \"'\")\n      val = val.substr(1, val.length - 2)\n\n    try {\n      val = JSON.parse(val)\n    } catch (_) {}\n  } else {\n    // walk the val to find the first not-escaped ; character\n    var esc = false\n    var unesc = ''\n    for (var i = 0, l = val.length; i < l; i++) {\n      var c = val.charAt(i)\n      if (esc) {\n        if ('\\\\;#'.indexOf(c) !== -1)\n          unesc += c\n        else\n          unesc += '\\\\' + c\n\n        esc = false\n      } else if (';#'.indexOf(c) !== -1)\n        break\n      else if (c === '\\\\')\n        esc = true\n      else\n        unesc += c\n    }\n    if (esc)\n      unesc += '\\\\'\n\n    return unesc.trim()\n  }\n  return val\n}\n", "'use strict';\nvar singleComment = 1;\nvar multiComment = 2;\n\nfunction stripWithoutWhitespace() {\n\treturn '';\n}\n\nfunction stripWithWhitespace(str, start, end) {\n\treturn str.slice(start, end).replace(/\\S/g, ' ');\n}\n\nmodule.exports = function (str, opts) {\n\topts = opts || {};\n\n\tvar currentChar;\n\tvar nextChar;\n\tvar insideString = false;\n\tvar insideComment = false;\n\tvar offset = 0;\n\tvar ret = '';\n\tvar strip = opts.whitespace === false ? stripWithoutWhitespace : stripWithWhitespace;\n\n\tfor (var i = 0; i < str.length; i++) {\n\t\tcurrentChar = str[i];\n\t\tnextChar = str[i + 1];\n\n\t\tif (!insideComment && currentChar === '\"') {\n\t\t\tvar escaped = str[i - 1] === '\\\\' && str[i - 2] !== '\\\\';\n\t\t\tif (!escaped) {\n\t\t\t\tinsideString = !insideString;\n\t\t\t}\n\t\t}\n\n\t\tif (insideString) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (!insideComment && currentChar + nextChar === '//') {\n\t\t\tret += str.slice(offset, i);\n\t\t\toffset = i;\n\t\t\tinsideComment = singleComment;\n\t\t\ti++;\n\t\t} else if (insideComment === singleComment && currentChar + nextChar === '\\r\\n') {\n\t\t\ti++;\n\t\t\tinsideComment = false;\n\t\t\tret += strip(str, offset, i);\n\t\t\toffset = i;\n\t\t\tcontinue;\n\t\t} else if (insideComment === singleComment && currentChar === '\\n') {\n\t\t\tinsideComment = false;\n\t\t\tret += strip(str, offset, i);\n\t\t\toffset = i;\n\t\t} else if (!insideComment && currentChar + nextChar === '/*') {\n\t\t\tret += str.slice(offset, i);\n\t\t\toffset = i;\n\t\t\tinsideComment = multiComment;\n\t\t\ti++;\n\t\t\tcontinue;\n\t\t} else if (insideComment === multiComment && currentChar + nextChar === '*/') {\n\t\t\ti++;\n\t\t\tinsideComment = false;\n\t\t\tret += strip(str, offset, i + 1);\n\t\t\toffset = i + 1;\n\t\t\tcontinue;\n\t\t}\n\t}\n\n\treturn ret + (insideComment ? strip(str.substr(offset)) : str.substr(offset));\n};\n", "'use strict';\nvar fs   = require('fs')\nvar ini  = require('ini')\nvar path = require('path')\nvar stripJsonComments = require('strip-json-comments')\n\nvar parse = exports.parse = function (content) {\n\n  //if it ends in .json or starts with { then it must be json.\n  //must be done this way, because ini accepts everything.\n  //can't just try and parse it and let it throw if it's not ini.\n  //everything is ini. even json with a syntax error.\n\n  if(/^\\s*{/.test(content))\n    return JSON.parse(stripJsonComments(content))\n  return ini.parse(content)\n\n}\n\nvar file = exports.file = function () {\n  var args = [].slice.call(arguments).filter(function (arg) { return arg != null })\n\n  //path.join breaks if it's a not a string, so just skip this.\n  for(var i in args)\n    if('string' !== typeof args[i])\n      return\n\n  var file = path.join.apply(null, args)\n  var content\n  try {\n    return fs.readFileSync(file,'utf-8')\n  } catch (err) {\n    return\n  }\n}\n\nvar json = exports.json = function () {\n  var content = file.apply(null, arguments)\n  return content ? parse(content) : null\n}\n\nvar env = exports.env = function (prefix, env) {\n  env = env || process.env\n  var obj = {}\n  var l = prefix.length\n  for(var k in env) {\n    if(k.toLowerCase().indexOf(prefix.toLowerCase()) === 0) {\n\n      var keypath = k.substring(l).split('__')\n\n      // Trim empty strings from keypath array\n      var _emptyStringIndex\n      while ((_emptyStringIndex=keypath.indexOf('')) > -1) {\n        keypath.splice(_emptyStringIndex, 1)\n      }\n\n      var cursor = obj\n      keypath.forEach(function _buildSubObj(_subkey,i){\n\n        // (check for _subkey first so we ignore empty strings)\n        // (check for cursor to avoid assignment to primitive objects)\n        if (!_subkey || typeof cursor !== 'object')\n          return\n\n        // If this is the last key, just stuff the value in there\n        // Assigns actual value from env variable to final key\n        // (unless it's just an empty string- in that case use the last valid key)\n        if (i === keypath.length-1)\n          cursor[_subkey] = env[k]\n\n\n        // Build sub-object if nothing already exists at the keypath\n        if (cursor[_subkey] === undefined)\n          cursor[_subkey] = {}\n\n        // Increment cursor used to track the object at the current depth\n        cursor = cursor[_subkey]\n\n      })\n\n    }\n\n  }\n\n  return obj\n}\n\nvar find = exports.find = function () {\n  var rel = path.join.apply(null, [].slice.call(arguments))\n\n  function find(start, rel) {\n    var file = path.join(start, rel)\n    try {\n      fs.statSync(file)\n      return file\n    } catch (err) {\n      if(path.dirname(start) !== start) // root\n        return find(path.dirname(start), rel)\n    }\n  }\n  return find(process.cwd(), rel)\n}\n\n\n", "/*!\n * @description Recursive object extending\n * @author Viacheslav Lotsmanov <lotsmanov89@gmail.com>\n * @license MIT\n *\n * The MIT License (MIT)\n *\n * Copyright (c) 2013-2018 Viacheslav Lotsmanov\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of\n * the Software, and to permit persons to whom the Software is furnished to do so,\n * subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS\n * FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR\n * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER\n * IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN\n * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\n\n'use strict';\n\nfunction isSpecificValue(val) {\n\treturn (\n\t\tval instanceof Buffer\n\t\t|| val instanceof Date\n\t\t|| val instanceof RegExp\n\t) ? true : false;\n}\n\nfunction cloneSpecificValue(val) {\n\tif (val instanceof Buffer) {\n\t\tvar x = Buffer.alloc\n\t\t\t? Buffer.alloc(val.length)\n\t\t\t: new Buffer(val.length);\n\t\tval.copy(x);\n\t\treturn x;\n\t} else if (val instanceof Date) {\n\t\treturn new Date(val.getTime());\n\t} else if (val instanceof RegExp) {\n\t\treturn new RegExp(val);\n\t} else {\n\t\tthrow new Error('Unexpected situation');\n\t}\n}\n\n/**\n * Recursive cloning array.\n */\nfunction deepCloneArray(arr) {\n\tvar clone = [];\n\tarr.forEach(function (item, index) {\n\t\tif (typeof item === 'object' && item !== null) {\n\t\t\tif (Array.isArray(item)) {\n\t\t\t\tclone[index] = deepCloneArray(item);\n\t\t\t} else if (isSpecificValue(item)) {\n\t\t\t\tclone[index] = cloneSpecificValue(item);\n\t\t\t} else {\n\t\t\t\tclone[index] = deepExtend({}, item);\n\t\t\t}\n\t\t} else {\n\t\t\tclone[index] = item;\n\t\t}\n\t});\n\treturn clone;\n}\n\nfunction safeGetProperty(object, property) {\n\treturn property === '__proto__' ? undefined : object[property];\n}\n\n/**\n * Extening object that entered in first argument.\n *\n * Returns extended object or false if have no target object or incorrect type.\n *\n * If you wish to clone source object (without modify it), just use empty new\n * object as first argument, like this:\n *   deepExtend({}, yourObj_1, [yourObj_N]);\n */\nvar deepExtend = module.exports = function (/*obj_1, [obj_2], [obj_N]*/) {\n\tif (arguments.length < 1 || typeof arguments[0] !== 'object') {\n\t\treturn false;\n\t}\n\n\tif (arguments.length < 2) {\n\t\treturn arguments[0];\n\t}\n\n\tvar target = arguments[0];\n\n\t// convert arguments to array and cut off target object\n\tvar args = Array.prototype.slice.call(arguments, 1);\n\n\tvar val, src, clone;\n\n\targs.forEach(function (obj) {\n\t\t// skip argument if isn't an object, is null, or is an array\n\t\tif (typeof obj !== 'object' || obj === null || Array.isArray(obj)) {\n\t\t\treturn;\n\t\t}\n\n\t\tObject.keys(obj).forEach(function (key) {\n\t\t\tsrc = safeGetProperty(target, key); // source value\n\t\t\tval = safeGetProperty(obj, key); // new value\n\n\t\t\t// recursion prevention\n\t\t\tif (val === target) {\n\t\t\t\treturn;\n\n\t\t\t/**\n\t\t\t * if new value isn't object then just overwrite by new value\n\t\t\t * instead of extending.\n\t\t\t */\n\t\t\t} else if (typeof val !== 'object' || val === null) {\n\t\t\t\ttarget[key] = val;\n\t\t\t\treturn;\n\n\t\t\t// just clone arrays (and recursive clone objects inside)\n\t\t\t} else if (Array.isArray(val)) {\n\t\t\t\ttarget[key] = deepCloneArray(val);\n\t\t\t\treturn;\n\n\t\t\t// custom cloning and overwrite for specific objects\n\t\t\t} else if (isSpecificValue(val)) {\n\t\t\t\ttarget[key] = cloneSpecificValue(val);\n\t\t\t\treturn;\n\n\t\t\t// overwrite by new value if source isn't object or array\n\t\t\t} else if (typeof src !== 'object' || src === null || Array.isArray(src)) {\n\t\t\t\ttarget[key] = deepExtend({}, val);\n\t\t\t\treturn;\n\n\t\t\t// source value and new value is objects both, extending...\n\t\t\t} else {\n\t\t\t\ttarget[key] = deepExtend(src, val);\n\t\t\t\treturn;\n\t\t\t}\n\t\t});\n\t});\n\n\treturn target;\n};\n", "module.exports = function (args, opts) {\n    if (!opts) opts = {};\n    \n    var flags = { bools : {}, strings : {}, unknownFn: null };\n\n    if (typeof opts['unknown'] === 'function') {\n        flags.unknownFn = opts['unknown'];\n    }\n\n    if (typeof opts['boolean'] === 'boolean' && opts['boolean']) {\n      flags.allBools = true;\n    } else {\n      [].concat(opts['boolean']).filter(Boolean).forEach(function (key) {\n          flags.bools[key] = true;\n      });\n    }\n    \n    var aliases = {};\n    Object.keys(opts.alias || {}).forEach(function (key) {\n        aliases[key] = [].concat(opts.alias[key]);\n        aliases[key].forEach(function (x) {\n            aliases[x] = [key].concat(aliases[key].filter(function (y) {\n                return x !== y;\n            }));\n        });\n    });\n\n    [].concat(opts.string).filter(Boolean).forEach(function (key) {\n        flags.strings[key] = true;\n        if (aliases[key]) {\n            flags.strings[aliases[key]] = true;\n        }\n     });\n\n    var defaults = opts['default'] || {};\n    \n    var argv = { _ : [] };\n    Object.keys(flags.bools).forEach(function (key) {\n        setArg(key, defaults[key] === undefined ? false : defaults[key]);\n    });\n    \n    var notFlags = [];\n\n    if (args.indexOf('--') !== -1) {\n        notFlags = args.slice(args.indexOf('--')+1);\n        args = args.slice(0, args.indexOf('--'));\n    }\n\n    function argDefined(key, arg) {\n        return (flags.allBools && /^--[^=]+$/.test(arg)) ||\n            flags.strings[key] || flags.bools[key] || aliases[key];\n    }\n\n    function setArg (key, val, arg) {\n        if (arg && flags.unknownFn && !argDefined(key, arg)) {\n            if (flags.unknownFn(arg) === false) return;\n        }\n\n        var value = !flags.strings[key] && isNumber(val)\n            ? Number(val) : val\n        ;\n        setKey(argv, key.split('.'), value);\n        \n        (aliases[key] || []).forEach(function (x) {\n            setKey(argv, x.split('.'), value);\n        });\n    }\n\n    function setKey (obj, keys, value) {\n        var o = obj;\n        for (var i = 0; i < keys.length-1; i++) {\n            var key = keys[i];\n            if (isConstructorOrProto(o, key)) return;\n            if (o[key] === undefined) o[key] = {};\n            if (o[key] === Object.prototype || o[key] === Number.prototype\n                || o[key] === String.prototype) o[key] = {};\n            if (o[key] === Array.prototype) o[key] = [];\n            o = o[key];\n        }\n\n        var key = keys[keys.length - 1];\n        if (isConstructorOrProto(o, key)) return;\n        if (o === Object.prototype || o === Number.prototype\n            || o === String.prototype) o = {};\n        if (o === Array.prototype) o = [];\n        if (o[key] === undefined || flags.bools[key] || typeof o[key] === 'boolean') {\n            o[key] = value;\n        }\n        else if (Array.isArray(o[key])) {\n            o[key].push(value);\n        }\n        else {\n            o[key] = [ o[key], value ];\n        }\n    }\n    \n    function aliasIsBoolean(key) {\n      return aliases[key].some(function (x) {\n          return flags.bools[x];\n      });\n    }\n\n    for (var i = 0; i < args.length; i++) {\n        var arg = args[i];\n        \n        if (/^--.+=/.test(arg)) {\n            // Using [\\s\\S] instead of . because js doesn't support the\n            // 'dotall' regex modifier. See:\n            // http://stackoverflow.com/a/1068308/13216\n            var m = arg.match(/^--([^=]+)=([\\s\\S]*)$/);\n            var key = m[1];\n            var value = m[2];\n            if (flags.bools[key]) {\n                value = value !== 'false';\n            }\n            setArg(key, value, arg);\n        }\n        else if (/^--no-.+/.test(arg)) {\n            var key = arg.match(/^--no-(.+)/)[1];\n            setArg(key, false, arg);\n        }\n        else if (/^--.+/.test(arg)) {\n            var key = arg.match(/^--(.+)/)[1];\n            var next = args[i + 1];\n            if (next !== undefined && !/^-/.test(next)\n            && !flags.bools[key]\n            && !flags.allBools\n            && (aliases[key] ? !aliasIsBoolean(key) : true)) {\n                setArg(key, next, arg);\n                i++;\n            }\n            else if (/^(true|false)$/.test(next)) {\n                setArg(key, next === 'true', arg);\n                i++;\n            }\n            else {\n                setArg(key, flags.strings[key] ? '' : true, arg);\n            }\n        }\n        else if (/^-[^-]+/.test(arg)) {\n            var letters = arg.slice(1,-1).split('');\n            \n            var broken = false;\n            for (var j = 0; j < letters.length; j++) {\n                var next = arg.slice(j+2);\n                \n                if (next === '-') {\n                    setArg(letters[j], next, arg)\n                    continue;\n                }\n                \n                if (/[A-Za-z]/.test(letters[j]) && /=/.test(next)) {\n                    setArg(letters[j], next.split('=')[1], arg);\n                    broken = true;\n                    break;\n                }\n                \n                if (/[A-Za-z]/.test(letters[j])\n                && /-?\\d+(\\.\\d*)?(e-?\\d+)?$/.test(next)) {\n                    setArg(letters[j], next, arg);\n                    broken = true;\n                    break;\n                }\n                \n                if (letters[j+1] && letters[j+1].match(/\\W/)) {\n                    setArg(letters[j], arg.slice(j+2), arg);\n                    broken = true;\n                    break;\n                }\n                else {\n                    setArg(letters[j], flags.strings[letters[j]] ? '' : true, arg);\n                }\n            }\n            \n            var key = arg.slice(-1)[0];\n            if (!broken && key !== '-') {\n                if (args[i+1] && !/^(-|--)[^-]/.test(args[i+1])\n                && !flags.bools[key]\n                && (aliases[key] ? !aliasIsBoolean(key) : true)) {\n                    setArg(key, args[i+1], arg);\n                    i++;\n                }\n                else if (args[i+1] && /^(true|false)$/.test(args[i+1])) {\n                    setArg(key, args[i+1] === 'true', arg);\n                    i++;\n                }\n                else {\n                    setArg(key, flags.strings[key] ? '' : true, arg);\n                }\n            }\n        }\n        else {\n            if (!flags.unknownFn || flags.unknownFn(arg) !== false) {\n                argv._.push(\n                    flags.strings['_'] || !isNumber(arg) ? arg : Number(arg)\n                );\n            }\n            if (opts.stopEarly) {\n                argv._.push.apply(argv._, args.slice(i + 1));\n                break;\n            }\n        }\n    }\n    \n    Object.keys(defaults).forEach(function (key) {\n        if (!hasKey(argv, key.split('.'))) {\n            setKey(argv, key.split('.'), defaults[key]);\n            \n            (aliases[key] || []).forEach(function (x) {\n                setKey(argv, x.split('.'), defaults[key]);\n            });\n        }\n    });\n    \n    if (opts['--']) {\n        argv['--'] = new Array();\n        notFlags.forEach(function(key) {\n            argv['--'].push(key);\n        });\n    }\n    else {\n        notFlags.forEach(function(key) {\n            argv._.push(key);\n        });\n    }\n\n    return argv;\n};\n\nfunction hasKey (obj, keys) {\n    var o = obj;\n    keys.slice(0,-1).forEach(function (key) {\n        o = (o[key] || {});\n    });\n\n    var key = keys[keys.length - 1];\n    return key in o;\n}\n\nfunction isNumber (x) {\n    if (typeof x === 'number') return true;\n    if (/^0x[0-9a-f]+$/i.test(x)) return true;\n    return /^[-+]?(?:\\d+(?:\\.\\d*)?|\\.\\d+)(e[-+]?\\d+)?$/.test(x);\n}\n\n\nfunction isConstructorOrProto (obj, key) {\n    return key === 'constructor' && typeof obj[key] === 'function' || key === '__proto__';\n}\n", "var cc   = require('./lib/utils')\nvar join = require('path').join\nvar deepExtend = require('deep-extend')\nvar etc = '/etc'\nvar win = process.platform === \"win32\"\nvar home = win\n           ? process.env.USERPROFILE\n           : process.env.HOME\n\nmodule.exports = function (name, defaults, argv, parse) {\n  if('string' !== typeof name)\n    throw new Error('rc(name): name *must* be string')\n  if(!argv)\n    argv = require('minimist')(process.argv.slice(2))\n  defaults = (\n      'string' === typeof defaults\n    ? cc.json(defaults) : defaults\n    ) || {}\n\n  parse = parse || cc.parse\n\n  var env = cc.env(name + '_')\n\n  var configs = [defaults]\n  var configFiles = []\n  function addConfigFile (file) {\n    if (configFiles.indexOf(file) >= 0) return\n    var fileConfig = cc.file(file)\n    if (fileConfig) {\n      configs.push(parse(fileConfig))\n      configFiles.push(file)\n    }\n  }\n\n  // which files do we look at?\n  if (!win)\n   [join(etc, name, 'config'),\n    join(etc, name + 'rc')].forEach(addConfigFile)\n  if (home)\n   [join(home, '.config', name, 'config'),\n    join(home, '.config', name),\n    join(home, '.' + name, 'config'),\n    join(home, '.' + name + 'rc')].forEach(addConfigFile)\n  addConfigFile(cc.find('.'+name+'rc'))\n  if (env.config) addConfigFile(env.config)\n  if (argv.config) addConfigFile(argv.config)\n\n  return deepExtend.apply(null, configs.concat([\n    env,\n    argv,\n    configFiles.length ? {configs: configFiles, config: configFiles[configFiles.length - 1]} : undefined,\n  ]))\n}\n", "(function(root, factory) {\n    'use strict';\n    // Universal Module Definition (UMD) to support AMD, CommonJS/Node.js, Rhino, and browsers.\n\n    /* istanbul ignore next */\n    if (typeof define === 'function' && define.amd) {\n        define('stackframe', [], factory);\n    } else if (typeof exports === 'object') {\n        module.exports = factory();\n    } else {\n        root.StackFrame = factory();\n    }\n}(this, function() {\n    'use strict';\n    function _isNumber(n) {\n        return !isNaN(parseFloat(n)) && isFinite(n);\n    }\n\n    function _capitalize(str) {\n        return str.charAt(0).toUpperCase() + str.substring(1);\n    }\n\n    function _getter(p) {\n        return function() {\n            return this[p];\n        };\n    }\n\n    var booleanProps = ['isConstructor', 'isEval', 'isNative', 'isToplevel'];\n    var numericProps = ['columnNumber', 'lineNumber'];\n    var stringProps = ['fileName', 'functionName', 'source'];\n    var arrayProps = ['args'];\n    var objectProps = ['evalOrigin'];\n\n    var props = booleanProps.concat(numericProps, stringProps, arrayProps, objectProps);\n\n    function StackFrame(obj) {\n        if (!obj) return;\n        for (var i = 0; i < props.length; i++) {\n            if (obj[props[i]] !== undefined) {\n                this['set' + _capitalize(props[i])](obj[props[i]]);\n            }\n        }\n    }\n\n    StackFrame.prototype = {\n        getArgs: function() {\n            return this.args;\n        },\n        setArgs: function(v) {\n            if (Object.prototype.toString.call(v) !== '[object Array]') {\n                throw new TypeError('Args must be an Array');\n            }\n            this.args = v;\n        },\n\n        getEvalOrigin: function() {\n            return this.evalOrigin;\n        },\n        setEvalOrigin: function(v) {\n            if (v instanceof StackFrame) {\n                this.evalOrigin = v;\n            } else if (v instanceof Object) {\n                this.evalOrigin = new StackFrame(v);\n            } else {\n                throw new TypeError('Eval Origin must be an Object or StackFrame');\n            }\n        },\n\n        toString: function() {\n            var fileName = this.getFileName() || '';\n            var lineNumber = this.getLineNumber() || '';\n            var columnNumber = this.getColumnNumber() || '';\n            var functionName = this.getFunctionName() || '';\n            if (this.getIsEval()) {\n                if (fileName) {\n                    return '[eval] (' + fileName + ':' + lineNumber + ':' + columnNumber + ')';\n                }\n                return '[eval]:' + lineNumber + ':' + columnNumber;\n            }\n            if (functionName) {\n                return functionName + ' (' + fileName + ':' + lineNumber + ':' + columnNumber + ')';\n            }\n            return fileName + ':' + lineNumber + ':' + columnNumber;\n        }\n    };\n\n    StackFrame.fromString = function StackFrame$$fromString(str) {\n        var argsStartIndex = str.indexOf('(');\n        var argsEndIndex = str.lastIndexOf(')');\n\n        var functionName = str.substring(0, argsStartIndex);\n        var args = str.substring(argsStartIndex + 1, argsEndIndex).split(',');\n        var locationString = str.substring(argsEndIndex + 1);\n\n        if (locationString.indexOf('@') === 0) {\n            var parts = /@(.+?)(?::(\\d+))?(?::(\\d+))?$/.exec(locationString, '');\n            var fileName = parts[1];\n            var lineNumber = parts[2];\n            var columnNumber = parts[3];\n        }\n\n        return new StackFrame({\n            functionName: functionName,\n            args: args || undefined,\n            fileName: fileName,\n            lineNumber: lineNumber || undefined,\n            columnNumber: columnNumber || undefined\n        });\n    };\n\n    for (var i = 0; i < booleanProps.length; i++) {\n        StackFrame.prototype['get' + _capitalize(booleanProps[i])] = _getter(booleanProps[i]);\n        StackFrame.prototype['set' + _capitalize(booleanProps[i])] = (function(p) {\n            return function(v) {\n                this[p] = Boolean(v);\n            };\n        })(booleanProps[i]);\n    }\n\n    for (var j = 0; j < numericProps.length; j++) {\n        StackFrame.prototype['get' + _capitalize(numericProps[j])] = _getter(numericProps[j]);\n        StackFrame.prototype['set' + _capitalize(numericProps[j])] = (function(p) {\n            return function(v) {\n                if (!_isNumber(v)) {\n                    throw new TypeError(p + ' must be a Number');\n                }\n                this[p] = Number(v);\n            };\n        })(numericProps[j]);\n    }\n\n    for (var k = 0; k < stringProps.length; k++) {\n        StackFrame.prototype['get' + _capitalize(stringProps[k])] = _getter(stringProps[k]);\n        StackFrame.prototype['set' + _capitalize(stringProps[k])] = (function(p) {\n            return function(v) {\n                this[p] = String(v);\n            };\n        })(stringProps[k]);\n    }\n\n    return StackFrame;\n}));\n", "(function(root, factory) {\n    'use strict';\n    // Universal Module Definition (UMD) to support AMD, CommonJS/Node.js, Rhino, and browsers.\n\n    /* istanbul ignore next */\n    if (typeof define === 'function' && define.amd) {\n        define('error-stack-parser', ['stackframe'], factory);\n    } else if (typeof exports === 'object') {\n        module.exports = factory(require('stackframe'));\n    } else {\n        root.ErrorStackParser = factory(root.StackFrame);\n    }\n}(this, function ErrorStackParser(StackFrame) {\n    'use strict';\n\n    var FIREFOX_SAFARI_STACK_REGEXP = /(^|@)\\S+:\\d+/;\n    var CHROME_IE_STACK_REGEXP = /^\\s*at .*(\\S+:\\d+|\\(native\\))/m;\n    var SAFARI_NATIVE_CODE_REGEXP = /^(eval@)?(\\[native code])?$/;\n\n    return {\n        /**\n         * Given an Error object, extract the most information from it.\n         *\n         * @param {Error} error object\n         * @return {Array} of StackFrames\n         */\n        parse: function ErrorStackParser$$parse(error) {\n            if (typeof error.stacktrace !== 'undefined' || typeof error['opera#sourceloc'] !== 'undefined') {\n                return this.parseOpera(error);\n            } else if (error.stack && error.stack.match(CHROME_IE_STACK_REGEXP)) {\n                return this.parseV8OrIE(error);\n            } else if (error.stack) {\n                return this.parseFFOrSafari(error);\n            } else {\n                throw new Error('Cannot parse given Error object');\n            }\n        },\n\n        // Separate line and column numbers from a string of the form: (URI:Line:Column)\n        extractLocation: function ErrorStackParser$$extractLocation(urlLike) {\n            // Fail-fast but return locations like \"(native)\"\n            if (urlLike.indexOf(':') === -1) {\n                return [urlLike];\n            }\n\n            var regExp = /(.+?)(?::(\\d+))?(?::(\\d+))?$/;\n            var parts = regExp.exec(urlLike.replace(/[()]/g, ''));\n            return [parts[1], parts[2] || undefined, parts[3] || undefined];\n        },\n\n        parseV8OrIE: function ErrorStackParser$$parseV8OrIE(error) {\n            var filtered = error.stack.split('\\n').filter(function(line) {\n                return !!line.match(CHROME_IE_STACK_REGEXP);\n            }, this);\n\n            return filtered.map(function(line) {\n                if (line.indexOf('(eval ') > -1) {\n                    // Throw away eval information until we implement stacktrace.js/stackframe#8\n                    line = line.replace(/eval code/g, 'eval').replace(/(\\(eval at [^()]*)|(,.*$)/g, '');\n                }\n                var sanitizedLine = line.replace(/^\\s+/, '').replace(/\\(eval code/g, '(').replace(/^.*?\\s+/, '');\n\n                // capture and preseve the parenthesized location \"(/foo/my bar.js:12:87)\" in\n                // case it has spaces in it, as the string is split on \\s+ later on\n                var location = sanitizedLine.match(/ (\\(.+\\)$)/);\n\n                // remove the parenthesized location from the line, if it was matched\n                sanitizedLine = location ? sanitizedLine.replace(location[0], '') : sanitizedLine;\n\n                // if a location was matched, pass it to extractLocation() otherwise pass all sanitizedLine\n                // because this line doesn't have function name\n                var locationParts = this.extractLocation(location ? location[1] : sanitizedLine);\n                var functionName = location && sanitizedLine || undefined;\n                var fileName = ['eval', '<anonymous>'].indexOf(locationParts[0]) > -1 ? undefined : locationParts[0];\n\n                return new StackFrame({\n                    functionName: functionName,\n                    fileName: fileName,\n                    lineNumber: locationParts[1],\n                    columnNumber: locationParts[2],\n                    source: line\n                });\n            }, this);\n        },\n\n        parseFFOrSafari: function ErrorStackParser$$parseFFOrSafari(error) {\n            var filtered = error.stack.split('\\n').filter(function(line) {\n                return !line.match(SAFARI_NATIVE_CODE_REGEXP);\n            }, this);\n\n            return filtered.map(function(line) {\n                // Throw away eval information until we implement stacktrace.js/stackframe#8\n                if (line.indexOf(' > eval') > -1) {\n                    line = line.replace(/ line (\\d+)(?: > eval line \\d+)* > eval:\\d+:\\d+/g, ':$1');\n                }\n\n                if (line.indexOf('@') === -1 && line.indexOf(':') === -1) {\n                    // Safari eval frames only have function names and nothing else\n                    return new StackFrame({\n                        functionName: line\n                    });\n                } else {\n                    var functionNameRegex = /((.*\".+\"[^@]*)?[^@]*)(?:@)/;\n                    var matches = line.match(functionNameRegex);\n                    var functionName = matches && matches[1] ? matches[1] : undefined;\n                    var locationParts = this.extractLocation(line.replace(functionNameRegex, ''));\n\n                    return new StackFrame({\n                        functionName: functionName,\n                        fileName: locationParts[0],\n                        lineNumber: locationParts[1],\n                        columnNumber: locationParts[2],\n                        source: line\n                    });\n                }\n            }, this);\n        },\n\n        parseOpera: function ErrorStackParser$$parseOpera(e) {\n            if (!e.stacktrace || (e.message.indexOf('\\n') > -1 &&\n                e.message.split('\\n').length > e.stacktrace.split('\\n').length)) {\n                return this.parseOpera9(e);\n            } else if (!e.stack) {\n                return this.parseOpera10(e);\n            } else {\n                return this.parseOpera11(e);\n            }\n        },\n\n        parseOpera9: function ErrorStackParser$$parseOpera9(e) {\n            var lineRE = /Line (\\d+).*script (?:in )?(\\S+)/i;\n            var lines = e.message.split('\\n');\n            var result = [];\n\n            for (var i = 2, len = lines.length; i < len; i += 2) {\n                var match = lineRE.exec(lines[i]);\n                if (match) {\n                    result.push(new StackFrame({\n                        fileName: match[2],\n                        lineNumber: match[1],\n                        source: lines[i]\n                    }));\n                }\n            }\n\n            return result;\n        },\n\n        parseOpera10: function ErrorStackParser$$parseOpera10(e) {\n            var lineRE = /Line (\\d+).*script (?:in )?(\\S+)(?:: In function (\\S+))?$/i;\n            var lines = e.stacktrace.split('\\n');\n            var result = [];\n\n            for (var i = 0, len = lines.length; i < len; i += 2) {\n                var match = lineRE.exec(lines[i]);\n                if (match) {\n                    result.push(\n                        new StackFrame({\n                            functionName: match[3] || undefined,\n                            fileName: match[2],\n                            lineNumber: match[1],\n                            source: lines[i]\n                        })\n                    );\n                }\n            }\n\n            return result;\n        },\n\n        // Opera 10.65+ Error.stack very similar to FF/Safari\n        parseOpera11: function ErrorStackParser$$parseOpera11(error) {\n            var filtered = error.stack.split('\\n').filter(function(line) {\n                return !!line.match(FIREFOX_SAFARI_STACK_REGEXP) && !line.match(/^Error created at/);\n            }, this);\n\n            return filtered.map(function(line) {\n                var tokens = line.split('@');\n                var locationParts = this.extractLocation(tokens.pop());\n                var functionCall = (tokens.shift() || '');\n                var functionName = functionCall\n                    .replace(/<anonymous function(: (\\w+))?>/, '$2')\n                    .replace(/\\([^)]*\\)/g, '') || undefined;\n                var argsRaw;\n                if (functionCall.match(/\\(([^)]*)\\)/)) {\n                    argsRaw = functionCall.replace(/^[^(]+\\(([^)]*)\\)$/, '$1');\n                }\n                var args = (argsRaw === undefined || argsRaw === '[arguments not available]') ?\n                    undefined : argsRaw.split(',');\n\n                return new StackFrame({\n                    functionName: functionName,\n                    args: args,\n                    fileName: locationParts[0],\n                    lineNumber: locationParts[1],\n                    columnNumber: locationParts[2],\n                    source: line\n                });\n            }, this);\n        }\n    };\n}));\n", "{\n  \"name\": \"dotenv\",\n  \"version\": \"16.4.5\",\n  \"description\": \"Loads environment variables from .env file\",\n  \"main\": \"lib/main.js\",\n  \"types\": \"lib/main.d.ts\",\n  \"exports\": {\n    \".\": {\n      \"types\": \"./lib/main.d.ts\",\n      \"require\": \"./lib/main.js\",\n      \"default\": \"./lib/main.js\"\n    },\n    \"./config\": \"./config.js\",\n    \"./config.js\": \"./config.js\",\n    \"./lib/env-options\": \"./lib/env-options.js\",\n    \"./lib/env-options.js\": \"./lib/env-options.js\",\n    \"./lib/cli-options\": \"./lib/cli-options.js\",\n    \"./lib/cli-options.js\": \"./lib/cli-options.js\",\n    \"./package.json\": \"./package.json\"\n  },\n  \"scripts\": {\n    \"dts-check\": \"tsc --project tests/types/tsconfig.json\",\n    \"lint\": \"standard\",\n    \"lint-readme\": \"standard-markdown\",\n    \"pretest\": \"npm run lint && npm run dts-check\",\n    \"test\": \"tap tests/*.js --100 -Rspec\",\n    \"test:coverage\": \"tap --coverage-report=lcov\",\n    \"prerelease\": \"npm test\",\n    \"release\": \"standard-version\"\n  },\n  \"repository\": {\n    \"type\": \"git\",\n    \"url\": \"git://github.com/motdotla/dotenv.git\"\n  },\n  \"funding\": \"https://dotenvx.com\",\n  \"keywords\": [\n    \"dotenv\",\n    \"env\",\n    \".env\",\n    \"environment\",\n    \"variables\",\n    \"config\",\n    \"settings\"\n  ],\n  \"readmeFilename\": \"README.md\",\n  \"license\": \"BSD-2-Clause\",\n  \"devDependencies\": {\n    \"@definitelytyped/dtslint\": \"^0.0.133\",\n    \"@types/node\": \"^18.11.3\",\n    \"decache\": \"^4.6.1\",\n    \"sinon\": \"^14.0.1\",\n    \"standard\": \"^17.0.0\",\n    \"standard-markdown\": \"^7.1.0\",\n    \"standard-version\": \"^9.5.0\",\n    \"tap\": \"^16.3.0\",\n    \"tar\": \"^6.1.11\",\n    \"typescript\": \"^4.8.4\"\n  },\n  \"engines\": {\n    \"node\": \">=12\"\n  },\n  \"browser\": {\n    \"fs\": false\n  }\n}\n", "const fs = require('fs')\nconst path = require('path')\nconst os = require('os')\nconst crypto = require('crypto')\nconst packageJson = require('../package.json')\n\nconst version = packageJson.version\n\nconst LINE = /(?:^|^)\\s*(?:export\\s+)?([\\w.-]+)(?:\\s*=\\s*?|:\\s+?)(\\s*'(?:\\\\'|[^'])*'|\\s*\"(?:\\\\\"|[^\"])*\"|\\s*`(?:\\\\`|[^`])*`|[^#\\r\\n]+)?\\s*(?:#.*)?(?:$|$)/mg\n\n// Parse src into an Object\nfunction parse (src) {\n  const obj = {}\n\n  // Convert buffer to string\n  let lines = src.toString()\n\n  // Convert line breaks to same format\n  lines = lines.replace(/\\r\\n?/mg, '\\n')\n\n  let match\n  while ((match = LINE.exec(lines)) != null) {\n    const key = match[1]\n\n    // Default undefined or null to empty string\n    let value = (match[2] || '')\n\n    // Remove whitespace\n    value = value.trim()\n\n    // Check if double quoted\n    const maybeQuote = value[0]\n\n    // Remove surrounding quotes\n    value = value.replace(/^(['\"`])([\\s\\S]*)\\1$/mg, '$2')\n\n    // Expand newlines if double quoted\n    if (maybeQuote === '\"') {\n      value = value.replace(/\\\\n/g, '\\n')\n      value = value.replace(/\\\\r/g, '\\r')\n    }\n\n    // Add to object\n    obj[key] = value\n  }\n\n  return obj\n}\n\nfunction _parseVault (options) {\n  const vaultPath = _vaultPath(options)\n\n  // Parse .env.vault\n  const result = DotenvModule.configDotenv({ path: vaultPath })\n  if (!result.parsed) {\n    const err = new Error(`MISSING_DATA: Cannot parse ${vaultPath} for an unknown reason`)\n    err.code = 'MISSING_DATA'\n    throw err\n  }\n\n  // handle scenario for comma separated keys - for use with key rotation\n  // example: DOTENV_KEY=\"dotenv://:key_1234@dotenvx.com/vault/.env.vault?environment=prod,dotenv://:key_7890@dotenvx.com/vault/.env.vault?environment=prod\"\n  const keys = _dotenvKey(options).split(',')\n  const length = keys.length\n\n  let decrypted\n  for (let i = 0; i < length; i++) {\n    try {\n      // Get full key\n      const key = keys[i].trim()\n\n      // Get instructions for decrypt\n      const attrs = _instructions(result, key)\n\n      // Decrypt\n      decrypted = DotenvModule.decrypt(attrs.ciphertext, attrs.key)\n\n      break\n    } catch (error) {\n      // last key\n      if (i + 1 >= length) {\n        throw error\n      }\n      // try next key\n    }\n  }\n\n  // Parse decrypted .env string\n  return DotenvModule.parse(decrypted)\n}\n\nfunction _log (message) {\n  console.log(`[dotenv@${version}][INFO] ${message}`)\n}\n\nfunction _warn (message) {\n  console.log(`[dotenv@${version}][WARN] ${message}`)\n}\n\nfunction _debug (message) {\n  console.log(`[dotenv@${version}][DEBUG] ${message}`)\n}\n\nfunction _dotenvKey (options) {\n  // prioritize developer directly setting options.DOTENV_KEY\n  if (options && options.DOTENV_KEY && options.DOTENV_KEY.length > 0) {\n    return options.DOTENV_KEY\n  }\n\n  // secondary infra already contains a DOTENV_KEY environment variable\n  if (process.env.DOTENV_KEY && process.env.DOTENV_KEY.length > 0) {\n    return process.env.DOTENV_KEY\n  }\n\n  // fallback to empty string\n  return ''\n}\n\nfunction _instructions (result, dotenvKey) {\n  // Parse DOTENV_KEY. Format is a URI\n  let uri\n  try {\n    uri = new URL(dotenvKey)\n  } catch (error) {\n    if (error.code === 'ERR_INVALID_URL') {\n      const err = new Error('INVALID_DOTENV_KEY: Wrong format. Must be in valid uri format like dotenv://:key_1234@dotenvx.com/vault/.env.vault?environment=development')\n      err.code = 'INVALID_DOTENV_KEY'\n      throw err\n    }\n\n    throw error\n  }\n\n  // Get decrypt key\n  const key = uri.password\n  if (!key) {\n    const err = new Error('INVALID_DOTENV_KEY: Missing key part')\n    err.code = 'INVALID_DOTENV_KEY'\n    throw err\n  }\n\n  // Get environment\n  const environment = uri.searchParams.get('environment')\n  if (!environment) {\n    const err = new Error('INVALID_DOTENV_KEY: Missing environment part')\n    err.code = 'INVALID_DOTENV_KEY'\n    throw err\n  }\n\n  // Get ciphertext payload\n  const environmentKey = `DOTENV_VAULT_${environment.toUpperCase()}`\n  const ciphertext = result.parsed[environmentKey] // DOTENV_VAULT_PRODUCTION\n  if (!ciphertext) {\n    const err = new Error(`NOT_FOUND_DOTENV_ENVIRONMENT: Cannot locate environment ${environmentKey} in your .env.vault file.`)\n    err.code = 'NOT_FOUND_DOTENV_ENVIRONMENT'\n    throw err\n  }\n\n  return { ciphertext, key }\n}\n\nfunction _vaultPath (options) {\n  let possibleVaultPath = null\n\n  if (options && options.path && options.path.length > 0) {\n    if (Array.isArray(options.path)) {\n      for (const filepath of options.path) {\n        if (fs.existsSync(filepath)) {\n          possibleVaultPath = filepath.endsWith('.vault') ? filepath : `${filepath}.vault`\n        }\n      }\n    } else {\n      possibleVaultPath = options.path.endsWith('.vault') ? options.path : `${options.path}.vault`\n    }\n  } else {\n    possibleVaultPath = path.resolve(process.cwd(), '.env.vault')\n  }\n\n  if (fs.existsSync(possibleVaultPath)) {\n    return possibleVaultPath\n  }\n\n  return null\n}\n\nfunction _resolveHome (envPath) {\n  return envPath[0] === '~' ? path.join(os.homedir(), envPath.slice(1)) : envPath\n}\n\nfunction _configVault (options) {\n  _log('Loading env from encrypted .env.vault')\n\n  const parsed = DotenvModule._parseVault(options)\n\n  let processEnv = process.env\n  if (options && options.processEnv != null) {\n    processEnv = options.processEnv\n  }\n\n  DotenvModule.populate(processEnv, parsed, options)\n\n  return { parsed }\n}\n\nfunction configDotenv (options) {\n  const dotenvPath = path.resolve(process.cwd(), '.env')\n  let encoding = 'utf8'\n  const debug = Boolean(options && options.debug)\n\n  if (options && options.encoding) {\n    encoding = options.encoding\n  } else {\n    if (debug) {\n      _debug('No encoding is specified. UTF-8 is used by default')\n    }\n  }\n\n  let optionPaths = [dotenvPath] // default, look for .env\n  if (options && options.path) {\n    if (!Array.isArray(options.path)) {\n      optionPaths = [_resolveHome(options.path)]\n    } else {\n      optionPaths = [] // reset default\n      for (const filepath of options.path) {\n        optionPaths.push(_resolveHome(filepath))\n      }\n    }\n  }\n\n  // Build the parsed data in a temporary object (because we need to return it).  Once we have the final\n  // parsed data, we will combine it with process.env (or options.processEnv if provided).\n  let lastError\n  const parsedAll = {}\n  for (const path of optionPaths) {\n    try {\n      // Specifying an encoding returns a string instead of a buffer\n      const parsed = DotenvModule.parse(fs.readFileSync(path, { encoding }))\n\n      DotenvModule.populate(parsedAll, parsed, options)\n    } catch (e) {\n      if (debug) {\n        _debug(`Failed to load ${path} ${e.message}`)\n      }\n      lastError = e\n    }\n  }\n\n  let processEnv = process.env\n  if (options && options.processEnv != null) {\n    processEnv = options.processEnv\n  }\n\n  DotenvModule.populate(processEnv, parsedAll, options)\n\n  if (lastError) {\n    return { parsed: parsedAll, error: lastError }\n  } else {\n    return { parsed: parsedAll }\n  }\n}\n\n// Populates process.env from .env file\nfunction config (options) {\n  // fallback to original dotenv if DOTENV_KEY is not set\n  if (_dotenvKey(options).length === 0) {\n    return DotenvModule.configDotenv(options)\n  }\n\n  const vaultPath = _vaultPath(options)\n\n  // dotenvKey exists but .env.vault file does not exist\n  if (!vaultPath) {\n    _warn(`You set DOTENV_KEY but you are missing a .env.vault file at ${vaultPath}. Did you forget to build it?`)\n\n    return DotenvModule.configDotenv(options)\n  }\n\n  return DotenvModule._configVault(options)\n}\n\nfunction decrypt (encrypted, keyStr) {\n  const key = Buffer.from(keyStr.slice(-64), 'hex')\n  let ciphertext = Buffer.from(encrypted, 'base64')\n\n  const nonce = ciphertext.subarray(0, 12)\n  const authTag = ciphertext.subarray(-16)\n  ciphertext = ciphertext.subarray(12, -16)\n\n  try {\n    const aesgcm = crypto.createDecipheriv('aes-256-gcm', key, nonce)\n    aesgcm.setAuthTag(authTag)\n    return `${aesgcm.update(ciphertext)}${aesgcm.final()}`\n  } catch (error) {\n    const isRange = error instanceof RangeError\n    const invalidKeyLength = error.message === 'Invalid key length'\n    const decryptionFailed = error.message === 'Unsupported state or unable to authenticate data'\n\n    if (isRange || invalidKeyLength) {\n      const err = new Error('INVALID_DOTENV_KEY: It must be 64 characters long (or more)')\n      err.code = 'INVALID_DOTENV_KEY'\n      throw err\n    } else if (decryptionFailed) {\n      const err = new Error('DECRYPTION_FAILED: Please check your DOTENV_KEY')\n      err.code = 'DECRYPTION_FAILED'\n      throw err\n    } else {\n      throw error\n    }\n  }\n}\n\n// Populate process.env with parsed values\nfunction populate (processEnv, parsed, options = {}) {\n  const debug = Boolean(options && options.debug)\n  const override = Boolean(options && options.override)\n\n  if (typeof parsed !== 'object') {\n    const err = new Error('OBJECT_REQUIRED: Please check the processEnv argument being passed to populate')\n    err.code = 'OBJECT_REQUIRED'\n    throw err\n  }\n\n  // Set process.env\n  for (const key of Object.keys(parsed)) {\n    if (Object.prototype.hasOwnProperty.call(processEnv, key)) {\n      if (override === true) {\n        processEnv[key] = parsed[key]\n      }\n\n      if (debug) {\n        if (override === true) {\n          _debug(`\"${key}\" is already defined and WAS overwritten`)\n        } else {\n          _debug(`\"${key}\" is already defined and was NOT overwritten`)\n        }\n      }\n    } else {\n      processEnv[key] = parsed[key]\n    }\n  }\n}\n\nconst DotenvModule = {\n  configDotenv,\n  _configVault,\n  _parseVault,\n  config,\n  decrypt,\n  parse,\n  populate\n}\n\nmodule.exports.configDotenv = DotenvModule.configDotenv\nmodule.exports._configVault = DotenvModule._configVault\nmodule.exports._parseVault = DotenvModule._parseVault\nmodule.exports.config = DotenvModule.config\nmodule.exports.decrypt = DotenvModule.decrypt\nmodule.exports.parse = DotenvModule.parse\nmodule.exports.populate = DotenvModule.populate\n\nmodule.exports = DotenvModule\n", "var os = require('os')\nvar path = require('path')\n\nfunction darwin (name) {\n  return path.join(process.env['HOME'], 'Library', 'Application Support', name)\n}\n\nfunction linux (name) {\n  if (process.env['XDG_CONFIG_HOME']) {\n    return path.join(process.env['XDG_CONFIG_HOME'], name)\n  }\n\n  return path.join(process.env['HOME'], '.config', name)\n}\n\nfunction win32 (name) {\n  if (process.env['LOCALAPPDATA']) {\n    return path.join(process.env['LOCALAPPDATA'], name)\n  }\n\n  return path.join(process.env['USERPROFILE'], 'Local Settings', 'Application Data', name)\n}\n\nfunction applicationConfigPath (name) {\n  if (typeof name !== 'string') {\n    throw new TypeError('`name` must be string')\n  }\n\n  switch (os.platform()) {\n    case 'darwin': return darwin(name)\n    case 'linux': return linux(name)\n    case 'win32': return win32(name)\n  }\n\n  throw new Error('Platform not supported')\n}\n\nmodule.exports = applicationConfigPath\n", "var path = require('path');\nvar fs = require('fs');\nvar _0777 = parseInt('0777', 8);\n\nmodule.exports = mkdirP.mkdirp = mkdirP.mkdirP = mkdirP;\n\nfunction mkdirP (p, opts, f, made) {\n    if (typeof opts === 'function') {\n        f = opts;\n        opts = {};\n    }\n    else if (!opts || typeof opts !== 'object') {\n        opts = { mode: opts };\n    }\n    \n    var mode = opts.mode;\n    var xfs = opts.fs || fs;\n    \n    if (mode === undefined) {\n        mode = _0777\n    }\n    if (!made) made = null;\n    \n    var cb = f || /* istanbul ignore next */ function () {};\n    p = path.resolve(p);\n    \n    xfs.mkdir(p, mode, function (er) {\n        if (!er) {\n            made = made || p;\n            return cb(null, made);\n        }\n        switch (er.code) {\n            case 'ENOENT':\n                /* istanbul ignore if */\n                if (path.dirname(p) === p) return cb(er);\n                mkdirP(path.dirname(p), opts, function (er, made) {\n                    /* istanbul ignore if */\n                    if (er) cb(er, made);\n                    else mkdirP(p, opts, cb, made);\n                });\n                break;\n\n            // In the case of any other error, just see if there's a dir\n            // there already.  If so, then hooray!  If not, then something\n            // is borked.\n            default:\n                xfs.stat(p, function (er2, stat) {\n                    // if the stat fails, then that's super weird.\n                    // let the original error be the failure reason.\n                    if (er2 || !stat.isDirectory()) cb(er, made)\n                    else cb(null, made);\n                });\n                break;\n        }\n    });\n}\n\nmkdirP.sync = function sync (p, opts, made) {\n    if (!opts || typeof opts !== 'object') {\n        opts = { mode: opts };\n    }\n    \n    var mode = opts.mode;\n    var xfs = opts.fs || fs;\n    \n    if (mode === undefined) {\n        mode = _0777\n    }\n    if (!made) made = null;\n\n    p = path.resolve(p);\n\n    try {\n        xfs.mkdirSync(p, mode);\n        made = made || p;\n    }\n    catch (err0) {\n        switch (err0.code) {\n            case 'ENOENT' :\n                made = sync(path.dirname(p), opts, made);\n                sync(p, opts, made);\n                break;\n\n            // In the case of any other error, just see if there's a dir\n            // there already.  If so, then hooray!  If not, then something\n            // is borked.\n            default:\n                var stat;\n                try {\n                    stat = xfs.statSync(p);\n                }\n                catch (err1) /* istanbul ignore next */ {\n                    throw err0;\n                }\n                /* istanbul ignore if */\n                if (!stat.isDirectory()) throw err0;\n                break;\n        }\n    }\n\n    return made;\n};\n", "var fs = require('fs')\nvar path = require('path')\nvar applicationConfigPath = require('application-config-path')\n\nfunction ApplicationConfig (name) {\n  this.filePath = path.join(applicationConfigPath(name), 'config.json')\n}\n\nApplicationConfig.prototype.read = function (cb) {\n  var self = this\n  fs.readFile(self.filePath, function (err, raw) {\n    if (err && err.code === 'ENOENT') return cb(null, {})\n    if (err) return cb(err)\n\n    var data\n    try {\n      data = JSON.parse(raw.toString())\n    } catch (err) {\n      return cb(err)\n    }\n\n    cb(null, data)\n  })\n}\n\nApplicationConfig.prototype.write = function (data, cb) {\n  var self = this\n  var mkdirp = require('mkdirp')\n  if (typeof data !== 'object' || data === null) {\n    throw new TypeError('data is not an object')\n  }\n  var directoryPath = path.dirname(self.filePath)\n  mkdirp(directoryPath, function (err) {\n    if (err) { return cb(err) }\n\n    var tempFilePath =\n      self.filePath + '-' +\n      Math.random().toString().substr(2) +\n      Date.now().toString() +\n      path.extname(self.filePath)\n\n    fs.writeFile(tempFilePath, JSON.stringify(data, null, 2), function (err) {\n      if (err) { return cb(err) }\n\n      fs.rename(tempFilePath, self.filePath, cb)\n    })\n  })\n}\n\nApplicationConfig.prototype.trash = function (cb) {\n  var self = this\n  fs.unlink(self.filePath, function (err) {\n    if (err && err.code !== 'ENOENT') return cb(err)\n\n    var directoryPath = path.dirname(self.filePath)\n    fs.rmdir(directoryPath, function (err) {\n      if (err && err.code !== 'ENOENT') return cb(err)\n\n      cb(null)\n    })\n  })\n}\n\nmodule.exports = function createApplicationConfig (name) {\n  return new ApplicationConfig(name)\n}\n", "/**\n * Returns a function, that, as long as it continues to be invoked, will not\n * be triggered. The function will be called after it stops being called for\n * N milliseconds. If `immediate` is passed, trigger the function on the\n * leading edge, instead of the trailing. The function also has a property 'clear' \n * that is a function which will clear the timer to prevent previously scheduled executions. \n *\n * @source underscore.js\n * @see http://unscriptable.com/2009/03/20/debouncing-javascript-methods/\n * @param {Function} function to wrap\n * @param {Number} timeout in ms (`100`)\n * @param {Boolean} whether to execute at the beginning (`false`)\n * @api public\n */\nfunction debounce(func, wait, immediate){\n  var timeout, args, context, timestamp, result;\n  if (null == wait) wait = 100;\n\n  function later() {\n    var last = Date.now() - timestamp;\n\n    if (last < wait && last >= 0) {\n      timeout = setTimeout(later, wait - last);\n    } else {\n      timeout = null;\n      if (!immediate) {\n        result = func.apply(context, args);\n        context = args = null;\n      }\n    }\n  };\n\n  var debounced = function(){\n    context = this;\n    args = arguments;\n    timestamp = Date.now();\n    var callNow = immediate && !timeout;\n    if (!timeout) timeout = setTimeout(later, wait);\n    if (callNow) {\n      result = func.apply(context, args);\n      context = args = null;\n    }\n\n    return result;\n  };\n\n  debounced.clear = function() {\n    if (timeout) {\n      clearTimeout(timeout);\n      timeout = null;\n    }\n  };\n  \n  debounced.flush = function() {\n    if (timeout) {\n      result = func.apply(context, args);\n      context = args = null;\n      \n      clearTimeout(timeout);\n      timeout = null;\n    }\n  };\n\n  return debounced;\n};\n\n// Adds compatibility for ES modules\ndebounce.debounce = debounce;\n\nmodule.exports = debounce;\n", "console.time('init')\n\nimport { mkdirSync, Stats, watchFile } from 'fs'\nimport { app as rawApp, dialog, ipcMain, protocol } from 'electron'\nimport rc from './rc.js'\nimport contextMenu from './electron-context-menu.js'\nimport { isWindowsStorePackage } from './isAppx.js'\nimport { getHelpMenu } from './help_menu.js'\nimport { initialisePowerMonitor } from './resume_from_sleep.js'\n\nimport type { EventEmitter } from 'events'\n\n// Hardening: prohibit all DNS queries, except for  OpenStreetMap\n// (used by /static/xdcs/maps.xdc)\n// The `~NOTFOUND` string is here:\n// https://chromium.googlesource.com/chromium/src/+/6459548ee396bbe1104978b01e19fcb1bb68d0e5/net/dns/mapped_host_resolver.cc#46\n// Chromium docs that touch on `--host-resolver-rules` and DNS:\n// https://www.chromium.org/developers/design-documents/network-stack/socks-proxy/\n// https://www.chromium.org/developers/design-documents/dns-prefetching/\nconst hostRules = 'MAP * ~NOTFOUND, EXCLUDE *.openstreetmap.org'\nrawApp.commandLine.appendSwitch('host-resolver-rules', hostRules)\nrawApp.commandLine.appendSwitch('host-rules', hostRules)\n\nrawApp.commandLine.appendSwitch('disable-features', 'IsolateSandboxedIframes')\n\nif (rc['version'] === true || rc['v'] === true) {\n  /* ignore-console-log */\n  console.info(BuildInfo.VERSION)\n  process.exit()\n}\n\nif (rc['help'] === true || rc['h'] === true) {\n  getHelpMenu()\n  process.exit()\n}\n\nprotocol.registerSchemesAsPrivileged([\n  {\n    scheme: 'webxdc',\n    privileges: {\n      // This gives apps access to APIs such as\n      // - Web Cryptography\n      // - Web Share\n      // , also see https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts/features_restricted_to_secure_contexts\n      //\n      // To give a brief explanation of what \"secure context\" is:\n      // Generally all websites served thorugh `https` (and not through `http`)\n      // are in a \"secure context\".\n      //\n      // For reference:\n      // - https://support.delta.chat/t/allow-access-to-camera-geolocation-other-web-apis/2446?u=wofwca\n      //\n      // Note that APIs requiring explicit user permission (such as camera)\n      // still don't work, see\n      // https://github.com/deltachat/deltachat-desktop/blob/455a4d01501ed82f9d8e0a36064ffbc3981722ee/src/main/deltachat/webxdc.ts#L457-L473\n      //\n      // In terms of `isSecureContext`, webxdc apps are similar to files,\n      // extensions, and FirefoxOS apps, i.e. [\"Packaged Applications\"]\n      // (https://w3c.github.io/webappsec-secure-contexts/#packaged-applications),\n      // so `secure: true` is applicable.\n      secure: true,\n\n      allowServiceWorkers: true,\n      standard: true,\n      supportFetchAPI: true,\n      stream: true, // needed for audio playback\n    },\n  },\n])\n\nconst app = rawApp as ExtendedAppMainProcess\napp.rc = rc\n\n// requestSingleInstanceLock always returns false on mas (mac app store) builds\n// due to electron issue https://github.com/electron/electron/issues/35540\n// dc-desktop issue: https://github.com/deltachat/deltachat-desktop/issues/3938\nif (\n  !process.mas &&\n  !app.requestSingleInstanceLock() &&\n  !process.env.DC_TEST_DIR\n) {\n  /* ignore-console-log */\n  console.error('Only one instance allowed. Quitting.')\n  app.quit()\n  process.exit(0)\n}\n\n// Setup folders\nimport {\n  getConfigPath,\n  getLogsPath,\n  getAccountsPath,\n  getCustomThemesPath,\n} from './application-constants.js'\nmkdirSync(getConfigPath(), { recursive: true })\nmkdirSync(getLogsPath(), { recursive: true })\nmkdirSync(getCustomThemesPath(), { recursive: true })\n\n// Setup Logger\nimport { cleanupLogFolder, createLogHandler } from './log-handler.js'\nconst logHandler = createLogHandler()\nimport { getLogger, setLogHandler } from '../../shared/logger.js'\nconst log = getLogger('main/index')\nsetLogHandler(logHandler.log, rc)\nlog.info(\n  `Deltachat Version ${BuildInfo.VERSION} ${BuildInfo.GIT_REF} ${BuildInfo.BUILD_TIMESTAMP}`\n)\nprocess.on('exit', logHandler.end)\n\n// Report uncaught exceptions\nprocess.on('uncaughtException', err => {\n  const error = { message: err.message, stack: err.stack }\n  if (log) {\n    log.error('uncaughtError', error)\n  } else {\n    /* ignore-console-log */\n    console.error('uncaughtException', error)\n  }\n  dialog.showErrorBox(\n    'Error - uncaughtException',\n    `See the logfile (${logHandler.logFilePath()}) for details and contact the developers about this issue:\\n` +\n      JSON.stringify(error)\n  )\n})\n\nimport setLanguage, { getCurrentLocaleDate } from './load-translations.js'\nimport * as ipc from './ipc.js'\nimport { init as initMenu } from './menu.js'\nimport { DesktopSettings } from './desktop_settings.js'\nimport * as mainWindow from './windows/main.js'\nimport { ExtendedAppMainProcess } from './types.js'\nimport { updateTrayIcon, hideDeltaChat, showDeltaChat } from './tray.js'\nimport './notifications.js'\nimport { acceptThemeCLI } from './themes.js'\nimport { webxdcStartUpCleanup } from './deltachat/webxdc.js'\nimport {\n  cleanupDraftTempDir,\n  cleanupInternalTempDirs,\n} from './cleanup_temp_dir.js'\n\napp.ipcReady = false\napp.isQuitting = false\n\nPromise.all([\n  new Promise((resolve, _reject) => app.on('ready', resolve)),\n  DesktopSettings.load(),\n  isWindowsStorePackage(),\n  webxdcStartUpCleanup(),\n])\n  .then(onReady)\n  .catch(error => {\n    log.critical('Fatal Error during init', error)\n    dialog.showErrorBox(\n      'Fatal Error during init',\n      `[Version: ${BuildInfo.VERSION} | ${platform()} | ${arch()}]]\n${error}\n\nAlso make sure you are not trying to run multiple instances of deltachat.`\n    )\n    process.exit(1)\n  })\n\nlet ipc_shutdown_function: (() => void) | null = null\n\nasync function onReady([_appReady, _loadedState, _appx, _webxdc_cleanup]: [\n  any,\n  any,\n  any,\n  any,\n]) {\n  // can fail due to user error so running it first is better (cli argument)\n  acceptThemeCLI()\n\n  setLanguage(DesktopSettings.state.locale || app.getLocale())\n\n  const cwd = getAccountsPath()\n  log.info(`cwd ${cwd}`)\n  ipc_shutdown_function = await ipc.init(cwd, logHandler)\n\n  mainWindow.init({ hidden: app.rc['minimized'] })\n  initMenu(logHandler)\n\n  if (rc.devmode) {\n    mainWindow.toggleDevTools()\n  }\n\n  if (app.rc['translation-watch']) {\n    watchFile(\n      join(getLocaleDirectoryPath(), '/_untranslated_en.json'),\n      (curr: Stats, prev: Stats) => {\n        if (curr.mtime !== prev.mtime) {\n          log.info('translation-watch: File changed reloading translation data')\n          mainWindow.chooseLanguage(getCurrentLocaleDate().locale)\n          log.info('translation-watch: reloading translation data - done')\n        }\n      }\n    )\n  }\n\n  cleanupLogFolder().catch(err =>\n    log.error('Cleanup of old logfiles failed: ', err)\n  )\n  cleanupDraftTempDir()\n  cleanupInternalTempDirs()\n  // NOTE: Make sure to use `powerMonitor` only when electron signals it is ready\n  initialisePowerMonitor()\n}\n\n;(app as EventEmitter).once('ipcReady', () => {\n  if (!mainWindow.window) {\n    throw new Error('window does not exist, this should never happen')\n  }\n  console.timeEnd('init')\n  if (process.env.NODE_ENV === 'test') {\n    mainWindow.window.maximize()\n  }\n\n  updateTrayIcon()\n\n  mainWindow.window.on('close', e => {\n    log.debug(\"mainWindow.window.on('close')\")\n    if (!app.isQuitting) {\n      e.preventDefault()\n      if (app.rc['minimized'] || DesktopSettings.state.minimizeToTray) {\n        log.debug(\"mainWindow.window.on('close') Hiding main window\")\n        hideDeltaChat()\n      } else {\n        if (process.platform === 'darwin') {\n          log.debug(\n            \"mainWindow.window.on('close') We are on mac, so lets hide the main window\"\n          )\n          hideDeltaChat()\n        } else {\n          log.debug(\"mainWindow.window.on('close') Quitting deltachat\")\n          quit(e)\n        }\n      }\n    }\n  })\n})\n\nexport function quit(e?: Electron.Event) {\n  if (app.isQuitting) return\n\n  app.isQuitting = true\n  e?.preventDefault()\n\n  log.info('Starting app shutdown process')\n  // close window\n  try {\n    mainWindow.window?.close()\n    mainWindow.window?.destroy()\n  } catch (error) {\n    log.error('failed to close window, error:', error)\n  }\n\n  // does stop io and other things\n  ipc_shutdown_function && ipc_shutdown_function()\n\n  cleanupDraftTempDir()\n\n  function doQuit() {\n    log.info('Quitting now. Bye.')\n    app.quit()\n  }\n  DesktopSettings.saveImmediate().then(() => {\n    // timeout here to ensure core messages that come after quit are still logged\n    // (there should not be core activity after quit, but sometimes there are)\n    setTimeout(doQuit, 500)\n  })\n  setTimeout(() => {\n    log.error('Saving state took too long. Quitting.')\n    doQuit()\n  }, 4000)\n}\napp.on('activate', () => {\n  log.debug(\"app.on('activate')\")\n  if (!mainWindow.window) {\n    log.warn('window not set, this is normal on startup')\n    return\n  }\n  if (mainWindow.window.isVisible() === false) {\n    log.debug(\"app.on('activate') showing main window\")\n    showDeltaChat()\n  } else {\n    log.debug(\"app.on('activate') mainWindow is visible, no need to show it\")\n  }\n})\napp.on('before-quit', e => quit(e))\napp.on('window-all-closed', () => quit())\n\napp.on('web-contents-created', (_ev, contents) => {\n  const is_webxdc =\n    contents.session.storagePath &&\n    contents.session.storagePath.indexOf('webxdc_') !== -1\n  if (is_webxdc) {\n    const webxdcOpenUrl = (url: string) => {\n      if (url.startsWith('mailto:') || url.startsWith('openpgp4fpr:')) {\n        // handle mailto in dc\n        open_url(url)\n        mainWindow.window?.show()\n      }\n    }\n\n    contents.on('will-navigate', (ev, navigationUrl) => {\n      if (navigationUrl.startsWith('webxdc://')) {\n        // allow internal webxdc nav\n        return\n      } else if (navigationUrl.startsWith('mailto:')) {\n        // handle mailto in dc\n        ev.preventDefault()\n        webxdcOpenUrl(navigationUrl)\n      } else {\n        // prevent navigation to unknown scheme\n        ev.preventDefault()\n      }\n    })\n\n    contents.on('will-frame-navigate', ev => {\n      if (ev.url.startsWith('webxdc://')) {\n        // allow internal webxdc nav\n        return\n      } else if (ev.url.startsWith('mailto:')) {\n        // handle mailto in dc\n        ev.preventDefault()\n        webxdcOpenUrl(ev.url)\n      } else {\n        // prevent navigation to unknown scheme\n        ev.preventDefault()\n      }\n    })\n\n    contents.setWindowOpenHandler(_details => {\n      webxdcOpenUrl(_details.url)\n      // prevent new windows from being created when clicking on links\n      return { action: 'deny' }\n    })\n  } else {\n    contents.on('will-navigate', (e, navigationUrl) => {\n      log.warn('blocked navigation attempt to', navigationUrl)\n      e.preventDefault()\n    })\n    contents.setWindowOpenHandler(_details => {\n      // prevent new windows from being created when clicking on links\n      return { action: 'deny' }\n    })\n  }\n\n  // Prevent webview tags from being created,\n  // if you need them make sure to read https://www.electronjs.org/docs/latest/tutorial/security#12-verify-webview-options-before-creation\n  // to not indroduce security risks\n  contents.on('will-attach-webview', (event, _webPreferences, _params) => {\n    event.preventDefault()\n  })\n})\n\ncontextMenu()\n\nimport { openUrlsAndFilesFromArgv, open_url } from './open_url.js'\nimport { getLocaleDirectoryPath } from './getLocaleDirectory.js'\nimport { join } from 'path'\nimport { BuildInfo } from './get-build-info.js'\nimport { arch, platform } from 'os'\nopenUrlsAndFilesFromArgv(process.argv)\n\nipcMain.handle('restart_app', async _ev => {\n  app.relaunch()\n  app.quit()\n})\n", "import rc from 'rc'\nimport type { RC_Config } from '../../shared/shared-types.js'\n\nconst defaults: RC_Config = {\n  'log-debug': false,\n  'log-to-console': false,\n  'machine-readable-stacktrace': false,\n  theme: undefined,\n  devmode: false,\n  'translation-watch': false,\n  'theme-watch': false,\n  minimized: false,\n  version: false,\n  v: false,\n  help: false,\n  h: false,\n  'allow-unsafe-core-replacement': false,\n}\n\nconst config = rc('DeltaChat', defaults) as RC_Config\n\nif (config.version || config.v) {\n  config.version == true\n}\n\nif (config.help || config.h) {\n  config.help == true\n}\n\nif (config.devmode) {\n  config['log-debug'] = true\n  config['log-to-console'] = true\n}\n\nconst rc_config = Object.freeze(config)\n\nexport default rc_config\n", "/*\nthis is a modified version of https://github.com/sindresorhus/electron-context-menu/\nwith the following license:\n\nMIT License\n\nCopyright (c) Sindre Sorhus <sindresorhus@gmail.com> (https://sindresorhus.com)\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n*/\n\n/*\nmodifications:\n- remove unnecessary functionality\n- add use of our translation system\n*/\n\n'use strict'\nimport electron, { BrowserWindow, MenuItemConstructorOptions } from 'electron'\nimport { Event } from 'electron/common'\nimport { tx } from './load-translations.js'\n\ntype todo = any\n\ntype MenuItem = electron.MenuItemConstructorOptions | electron.MenuItem\n\nconst webContents = (win: BrowserWindow) => win.webContents\n\nconst removeUnusedMenuItems = (\n  menuTemplate: (MenuItem | false | undefined)[]\n): MenuItem[] => {\n  let notDeletedPreviousElement: MenuItem\n\n  return menuTemplate\n    .filter(menuItem => {\n      // We can pass in falsy values into this list as a workaround to remove them here\n      if (!menuItem) {\n        return false\n      } else if (typeof menuItem === 'object' && menuItem.visible === false) {\n        return false\n      }\n\n      return true\n    })\n    .filter((item, index, array) => {\n      // We've filtered all booleans above, just TS doesn't know that yet\n      const menuItem = item as MenuItem\n      const items = array as MenuItem[]\n\n      const toDelete =\n        menuItem.type === 'separator' &&\n        (!notDeletedPreviousElement ||\n          index === array.length - 1 ||\n          items[index + 1].type === 'separator')\n\n      notDeletedPreviousElement = toDelete\n        ? notDeletedPreviousElement\n        : menuItem\n\n      return !toDelete\n    }) as MenuItem[]\n}\n\nconst create = (win: BrowserWindow) => {\n  const enableSpellChecking = false\n  const handleContextMenu = (_event: Event, props: todo) => {\n    const { editFlags } = props\n    const hasText = props.selectionText.trim().length > 0\n    const can = (type: todo) => editFlags[`can${type}`] && hasText\n\n    const defaultActions: {\n      [key: string]: () => MenuItemConstructorOptions\n    } = {\n      separator: () => ({ type: 'separator' }),\n      learnSpelling: () => ({\n        id: 'learnSpelling',\n        label: tx('menu_learn_spelling'),\n        visible: Boolean(props.isEditable && hasText && props.misspelledWord),\n        click() {\n          const target = webContents(win)\n          target.session.addWordToSpellCheckerDictionary(props.misspelledWord)\n        },\n      }),\n      cut: () => ({\n        id: 'cut',\n        label: tx('global_menu_edit_cut_desktop'),\n        enabled: can('Cut'),\n        visible: props.isEditable,\n        click(_menuItem) {\n          const target = webContents(win)\n          if (target) {\n            target.cut()\n          } else {\n            electron.clipboard.writeText(props.selectionText)\n          }\n        },\n      }),\n      copy: () => ({\n        id: 'copy',\n        label: tx('global_menu_edit_copy_desktop'),\n        enabled: can('Copy'),\n        visible: props.isEditable || hasText,\n        click() {\n          const target = webContents(win)\n          if (target) {\n            target.copy()\n          } else {\n            electron.clipboard.writeText(props.selectionText)\n          }\n        },\n      }),\n      paste: () => ({\n        id: 'paste',\n        label: tx('global_menu_edit_paste_desktop'),\n        enabled: editFlags.canPaste,\n        visible: props.isEditable,\n        click() {\n          const target = webContents(win)\n          target.paste()\n        },\n      }),\n      copyLink: () => ({\n        id: 'copyLink',\n        label: tx('menu_copy_link_to_clipboard'),\n        visible: props.linkURL.length !== 0 && props.mediaType === 'none',\n        click() {\n          electron.clipboard.write({\n            bookmark: props.linkText,\n            text: props.linkURL,\n          })\n        },\n      }),\n      copyImage: () => ({\n        id: 'copyImage',\n        label: tx('menu_copy_image_to_clipboard'),\n        visible: props.mediaType === 'image',\n        click() {\n          webContents(win).copyImageAt(props.x, props.y)\n        },\n      }),\n    }\n\n    function word(suggestion: string) {\n      return {\n        id: 'dictionarySuggestions',\n        label: suggestion,\n        visible: Boolean(props.isEditable && hasText && props.misspelledWord),\n        click(menuItem: MenuItemConstructorOptions) {\n          if (menuItem.label) {\n            const target = webContents(win)\n            target.insertText(menuItem.label)\n          }\n        },\n      }\n    }\n\n    let dictionarySuggestions = []\n    if (enableSpellChecking) {\n      if (\n        hasText &&\n        props.misspelledWord &&\n        props.dictionarySuggestions.length > 0\n      ) {\n        dictionarySuggestions = props.dictionarySuggestions.map(\n          (suggestion: string) => word(suggestion)\n        )\n      } else {\n        dictionarySuggestions.push({\n          id: 'dictionarySuggestions',\n          label: tx('no_spellcheck_suggestions_found'),\n          visible: Boolean(hasText && props.misspelledWord),\n          enabled: false,\n        })\n      }\n    }\n\n    let menuTemplate: MenuItem[] = [\n      dictionarySuggestions.length > 0 && defaultActions.separator(),\n      ...dictionarySuggestions,\n      defaultActions.separator(),\n      enableSpellChecking && defaultActions.learnSpelling(),\n      defaultActions.separator(),\n      defaultActions.cut(),\n      defaultActions.copy(),\n      defaultActions.paste(),\n      defaultActions.separator(),\n      defaultActions.copyImage(),\n      defaultActions.separator(),\n      defaultActions.copyLink(),\n      defaultActions.separator(),\n    ]\n\n    // Filter out leading/trailing separators\n    // TODO: https://github.com/electron/electron/issues/5869\n    menuTemplate = removeUnusedMenuItems(menuTemplate)\n\n    if (menuTemplate.length > 0) {\n      const menu = electron.Menu.buildFromTemplate(menuTemplate as MenuItem[])\n\n      menu.popup({ window: win })\n    }\n  }\n\n  webContents(win).on('context-menu', handleContextMenu)\n\n  return () => {\n    if (win.isDestroyed()) {\n      return\n    }\n\n    webContents(win).removeListener('context-menu', handleContextMenu)\n  }\n}\n\nconst ContextMenu = () => {\n  let isDisposed = false\n  const disposables: (() => void)[] = []\n\n  const init = (win: BrowserWindow) => {\n    if (isDisposed) {\n      return\n    }\n\n    const disposeMenu = create(win)\n\n    disposables.push(disposeMenu)\n    const removeDisposable = () => {\n      const index = disposables.indexOf(disposeMenu)\n      if (index !== -1) {\n        disposables.splice(index, 1)\n      }\n    }\n\n    if (typeof win.once !== 'undefined') {\n      // Support for BrowserView\n      win.once('closed', removeDisposable)\n    }\n\n    disposables.push(() => {\n      win.off('closed', removeDisposable)\n    })\n  }\n\n  const dispose = () => {\n    for (const dispose of disposables) {\n      dispose()\n    }\n\n    disposables.length = 0\n    isDisposed = true\n  }\n\n  for (const win of electron.BrowserWindow.getAllWindows()) {\n    init(win)\n  }\n\n  const app = electron.app\n\n  const onWindowCreated = (_event: todo, win: BrowserWindow) => {\n    init(win)\n  }\n\n  app.on('browser-window-created', onWindowCreated)\n  disposables.push(() => {\n    app.removeListener('browser-window-created', onWindowCreated)\n  })\n\n  return dispose\n}\n\nexport default ContextMenu\n", "import path from 'path'\nimport fs from 'fs'\nimport { ipcMain } from 'electron'\n\nimport { getLogger } from '../../shared/logger.js'\nimport {\n  getMessageFunction,\n  LocaleData,\n  translate as getTranslateFunction,\n} from '../../shared/localize.js'\nimport { refresh as refreshMenu } from './menu.js'\nimport { getLocaleDirectoryPath } from './getLocaleDirectory.js'\n\nconst log = getLogger('load-translations')\n\nlet currentlocaleData: LocaleData | null = null\n\nexport function getCurrentLocaleDate(): LocaleData {\n  if (currentlocaleData === null) {\n    log.error('tried to get locale data before init')\n    throw new Error('no locale data is loaded yet')\n  }\n  return currentlocaleData\n}\n\nlet translateFunction: getMessageFunction | null = null\nexport const tx: getMessageFunction = function (key, substitutions, raw_opts) {\n  if (translateFunction === null) {\n    log.error('tried to use translation function before init')\n    return key as string\n  }\n  return translateFunction(key, substitutions, raw_opts)\n}\n\nexport default function setLanguage(locale: string) {\n  const localeData = loadTranslations(locale)\n  currentlocaleData = localeData\n  translateFunction = getTranslateFunction(\n    localeData.locale,\n    localeData.messages\n  )\n}\n\nexport function loadTranslations(locale: string) {\n  const messagesEnglish = getLocaleMessages(retrieveLocaleFile('en'))\n\n  let messages\n\n  let localeFile = retrieveLocaleFile(locale)\n  let localeMessages = getLocaleMessages(localeFile)\n\n  if (!localeMessages && locale.indexOf('-') !== -1) {\n    // We couldn't load the file for the locale but it's a dialect. Try to fall\n    // back to the main language (example: de-CH -> de)\n    locale = locale.split('-')[0]\n    localeFile = retrieveLocaleFile(locale)\n    localeMessages = getLocaleMessages(localeFile)\n  } else if (!localeMessages) {\n    log.error(`Could not load messages for ${locale}`, locale)\n    locale = 'en'\n    messages = messagesEnglish\n  }\n\n  if (localeMessages) {\n    messages = Object.assign({}, messagesEnglish, localeMessages)\n  }\n\n  const experimentalFile = retrieveLocaleFile('_untranslated_en')\n  const experimentalMessages = getLocaleMessages(experimentalFile)\n  if (experimentalMessages) {\n    messages = Object.assign(messages, experimentalMessages)\n  } else {\n    log.debug(`No experimental language file (${experimentalFile}) found`)\n  }\n\n  log.debug(messages['no_chat_selected_suggestion_desktop'])\n  return { messages, locale }\n}\n\nfunction retrieveLocaleFile(locale: string) {\n  const onDiskLocale = locale.replace('-', '_')\n  return path.join(getLocaleDirectoryPath(), onDiskLocale + '.json')\n}\n\nfunction getLocaleMessages(file: string) {\n  if (!fs.existsSync(file)) return false\n  try {\n    return JSON.parse(fs.readFileSync(file, 'utf-8'))\n  } catch (err) {\n    log.error(`JSON parse error in language file '${file}'`, err)\n    throw err\n  }\n}\n\nipcMain.handle('getLocaleData', (_ev, locale?: string): LocaleData => {\n  if (locale) {\n    loadTranslations(locale)\n  }\n  return getCurrentLocaleDate()\n})\n\nipcMain.handle('setLocale', (_ev, locale: string) => {\n  setLanguage(locale)\n  refreshMenu()\n})\n", "import errorStackParser from 'error-stack-parser'\nimport StackFrame from 'stackframe'\nimport { RC_Config } from './shared-types.js'\n\nconst startTime = Date.now()\n\nexport const colorize = (light: number, code: number) => (str: string) =>\n  '\\x1B[' + light + ';' + code + 'm' + str + '\\x1b[0m'\nexport const blue = colorize(1, 34)\nexport const red = colorize(1, 31)\nexport const yellow = colorize(1, 33)\nexport const grey = colorize(0, 37)\nexport const green = colorize(1, 37)\nexport const cyan = colorize(1, 36)\n\nconst emojiFontCss =\n  'font-family: Roboto, \"Apple Color Emoji\", NotoEmoji, \"Helvetica Neue\", Arial, Helvetica, NotoMono, sans-serif !important;'\n\nexport const enum LogLevelString {\n  DEBUG = 'DEBUG',\n  WARNING = 'WARNING',\n  INFO = 'INFO',\n  ERROR = 'ERROR',\n  CRITICAL = 'CRITICAL',\n}\n\nconst LoggerVariants = [\n  {\n    log: console.debug,\n    level: LogLevelString.DEBUG,\n    emoji: '\uD83D\uDD78\uFE0F',\n    symbol: '[D]',\n  },\n  {\n    log: console.info,\n    level: LogLevelString.INFO,\n    emoji: '\u2139\uFE0F',\n    symbol: blue('[i]'),\n  },\n  {\n    log: console.warn,\n    level: LogLevelString.WARNING,\n    emoji: '\u26A0\uFE0F',\n    symbol: yellow('[w]'),\n  },\n  {\n    log: console.error,\n    level: LogLevelString.ERROR,\n    emoji: '\uD83D\uDEA8',\n    symbol: red('[E]'),\n  },\n  {\n    log: console.error,\n    level: LogLevelString.CRITICAL,\n    emoji: '\uD83D\uDEA8\uD83D\uDEA8',\n    symbol: red('[C]'),\n  },\n]\n\nexport function printProcessLogLevelInfo() {\n  /* ignore-console-log */\n  console.info(\n    `%cLogging Levels:\\n${LoggerVariants.map(v => `${v.emoji} ${v.level}`).join(\n      '\\n'\n    )}`,\n    emojiFontCss\n  )\n  /* ignore-console-log */\n  console.info(\n    `# Tips and Tricks for using the search filter in the browser console:\n\n\u2022 Use space to separate search terms\n\u2022 Exclude search terms using -\n\u2022 If the search term contains spaces you should escape it with \"\"\n\nExamples:\n\n\uD83D\uDD78\uFE0F          only show debug messages\n-\uD83D\uDD78\uFE0F         don't show debug messages\n\u2139\uFE0F          only show info messages\n-\u2139\uFE0F         don't show info messages\n\uD83D\uDC7B          only show events from background accounts (not selected accounts)\n-\uD83D\uDC7B         don't show events from background accounts (not selected accounts)\n\uD83D\uDCE1          only show events\n-\uD83D\uDCE1         don't show any events\n[JSONRPC]   only show jsonrpc messages\n-[JSONRPC]  don't show jsonrpc messages\n\nStart deltachat with --devmode (or --log-debug and --log-to-console) argument to show full log output.\nIf the log seems quiet, make sure the 'All levels' drop down has 'Verbose' checked.\n  `\n  )\n}\n\nexport type LogHandlerFunction = (\n  channel: string,\n  level: LogLevelString,\n  stacktrace: ReturnType<typeof getStackTrace>,\n  ...args: any[]\n) => void\n\nlet handler: LogHandlerFunction\nlet rc: RC_Config = {} as any\n\nexport function setLogHandler(\n  LogHandler: LogHandlerFunction,\n  rcObject: RC_Config\n) {\n  handler = LogHandler\n  rc = rcObject\n}\n\nfunction log(\n  { channel, isMainProcess }: Logger,\n  level: number,\n  stacktrace: ReturnType<typeof getStackTrace>,\n  args: any[]\n) {\n  const variant = LoggerVariants[level]\n  if (!handler) {\n    /* ignore-console-log */\n    console.log('Failed to log message - Handler not initialized yet')\n    /* ignore-console-log */\n    console.log(`Log Message: ${channel} ${level} ${args.join(' ')}`)\n    throw Error('Failed to log message - Handler not initialized yet')\n  }\n  handler(channel, variant.level, stacktrace, ...args)\n  if (rc['log-to-console']) {\n    if (isMainProcess) {\n      const beginning = `${Math.round((Date.now() - startTime) / 100) / 10}s ${\n        LoggerVariants[level].symbol\n      }${grey(channel)}:`\n      if (!stacktrace) {\n        variant.log(beginning, ...args)\n      } else {\n        variant.log(\n          beginning,\n          ...args,\n          red(\n            Array.isArray(stacktrace)\n              ? stacktrace.map(s => `\\n${s.toString()}`).join()\n              : stacktrace\n          )\n        )\n      }\n    } else {\n      const prefix = `%c${variant.emoji}%c${channel}`\n      const prefixStyle = [emojiFontCss, 'color:blueviolet;']\n\n      if (stacktrace) {\n        variant.log(prefix, ...prefixStyle, stacktrace, ...args)\n      } else {\n        variant.log(prefix, ...prefixStyle, ...args)\n      }\n    }\n  }\n}\n\nfunction getStackTrace(): StackFrame[] | string {\n  const rawStack: StackFrame[] = errorStackParser.parse(\n    new Error('Get Stacktrace')\n  )\n  const stack = rawStack.slice(2, rawStack.length)\n  return rc['machine-readable-stacktrace']\n    ? stack\n    : stack.map(s => `\\n${s.toString()}`).join()\n}\n\nexport class Logger {\n  //@ts-ignore\n  isMainProcess = typeof window === 'undefined'\n  constructor(public readonly channel: string) {\n    if (channel === 'core/event') {\n      // disable js stacktrace for core events\n      // as it is useless information (always pointing to the event emitter)\n      this.getStackTrace = () => ''\n    }\n  }\n\n  private getStackTrace(): StackFrame[] | string {\n    const rawStack: StackFrame[] = errorStackParser.parse(\n      new Error('Get Stacktrace')\n    )\n    const stack = rawStack.slice(2, rawStack.length)\n    return rc['machine-readable-stacktrace']\n      ? stack\n      : stack.map(s => `\\n${s.toString()}`).join()\n  }\n\n  debug(...args: any[]) {\n    if (!rc['log-debug']) return\n    log(this, 0, '', args)\n  }\n\n  info(...args: any[]) {\n    log(this, 1, '', args)\n  }\n\n  warn(...args: any[]) {\n    log(this, 2, this.getStackTrace(), args)\n  }\n\n  error(...args: any[]) {\n    log(this, 3, this.getStackTrace(), args)\n  }\n\n  /** use this when you know that the stacktrace is not relevant */\n  errorWithoutStackTrace(...args: any[]) {\n    log(this, 3, [], args)\n  }\n\n  critical(...args: any[]) {\n    log(this, 4, this.getStackTrace(), args)\n  }\n}\n\nexport function getLogger(channel: string) {\n  return new Logger(channel)\n}\n\n// Fix for error not being able to be converted into json\n// From https://stackoverflow.com/a/18391400\nif (!('toJSON' in Error.prototype))\n  Object.defineProperty(Error.prototype, 'toJSON', {\n    value: function () {\n      const alt = {}\n      Object.getOwnPropertyNames(this).forEach(function (key) {\n        //@ts-ignore\n        alt[key] = this[key]\n      }, this)\n      return alt\n    },\n    configurable: true,\n    writable: true,\n  })\n", "import { getLogger } from './logger.js'\nimport { TranslationKey } from './translationKeyType.js'\nconst log = getLogger('localize')\n\nexport interface LocaleData {\n  locale: string\n  messages: {\n    [key: string]: {\n      [P in Intl.LDMLPluralRule]?: string\n    } & {\n      message?: string\n    }\n  }\n}\n\n// 'other' should exists for all languages (source?)\n// https://www.unicode.org/cldr/charts/43/supplemental/language_plural_rules.html\ntype getMessageOptions = { quantity?: 'other' | number }\n\nexport type getMessageFunction = (\n  key: TranslationKey,\n  substitutions?: string | string[],\n  raw_opts?: 'other' | getMessageOptions\n) => string\n\nexport function translate(\n  locale: string,\n  messages: LocaleData['messages']\n): getMessageFunction {\n  const localeBCP47 = locale.replace('_', '-')\n  let pluralRules: Intl.PluralRules\n  try {\n    pluralRules = new Intl.PluralRules(localeBCP47)\n  } catch (err) {\n    // Ideally we'd want a build-time check for this.\n    // But let's not crash for this silly reason and apply the rules that apply\n    // for many languages (see https://www.unicode.org/cldr/charts/43/supplemental/language_plural_rules.html#Cardinal-Integer)\n    // Although keep in mind that English only has 'one' and 'other'\n    // plural categorues, but some languages, such as Korean,\n    // do not have 'one': only 'other'.\n    // Before you ask, yes, _all_ languages have 'other' (source?)\n    log.errorWithoutStackTrace(err)\n\n    pluralRules = new Intl.PluralRules('en')\n  }\n\n  function getMessage(\n    key: TranslationKey,\n    substitutions?: string | string[],\n    raw_opts?: 'other' | getMessageOptions\n  ) {\n    const translationKey = key as string\n    let opts: getMessageOptions = {}\n    if (typeof raw_opts === 'string') opts = { quantity: raw_opts }\n    else opts = Object.assign({}, raw_opts)\n\n    const entry = messages[translationKey]\n\n    if (!entry) {\n      log.error(`Missing translation for key '${translationKey}'`)\n      return translationKey\n    }\n\n    let message: string | undefined = entry.message\n    if (typeof opts.quantity !== 'undefined') {\n      if (typeof opts.quantity === 'string') {\n        message = entry[opts.quantity]\n      } else if (typeof opts.quantity === 'number') {\n        message =\n          entry[opts.quantity as unknown as keyof LocaleData['messages'][0]] ||\n          // TODO fix: simply using `pluralRules.select()` to index\n          // into the object is not quite right,\n          // because the string could be untranslated, and it'd fall back to\n          // English, with only 'one' and 'other' plural categories,\n          // in which case we must apply the English\n          // plural rules instead of the current locale's rules.\n          //\n          // Currently this is behaves incorrectly e.g. for untranslated\n          // Indonesian (id), which only has the 'other' plural category,\n          // so even when we have to use 'one' for English, we'd use 'other'.\n          //\n          // But currently we don't have a way to distinguish between translated\n          // and untranslated strings in this code.\n          // See https://github.com/deltachat/deltachat-desktop/blob/b342a1d47b505e68caaec71f79c381c3f304405a/src/main/load-translations.ts#L44-L64\n          entry[pluralRules.select(opts.quantity)] ||\n          // This also catches the case where we failed to construct\n          // `Intl.PluralRules` for the currentl locale, and fall back to\n          // English (see `try catch` above).\n          entry['other']\n      } else {\n        message = undefined\n      }\n      if (typeof message === 'undefined') {\n        log.error(\n          `Missing quantity '${opts.quantity}' for key '${translationKey}'`\n        )\n        return `${translationKey}:${opts.quantity}`\n      }\n    }\n\n    if (typeof message === 'undefined') {\n      log.error(\n        `Missing 'message' for key '${translationKey}', maybe you need to specify quantity`\n      )\n      return `${translationKey}:?`\n    }\n\n    if (substitutions) {\n      if (!Array.isArray(substitutions)) {\n        substitutions = [substitutions]\n      }\n\n      let counter = -1\n      return message.replace(/(?:%\\d\\$[\\w\\d])|(?:%[\\w\\d])/g, f => {\n        counter++\n        if (f.length > 2) {\n          const index = Number.parseInt(f[1]) - 1\n          if (\n            substitutions === undefined ||\n            typeof substitutions[index] === 'undefined'\n          ) {\n            log.error(`Missing ${index} argument for key %c'${translationKey}'`)\n            return ''\n          }\n          return substitutions[index].toString()\n        }\n        // TODO find out if there is a case with multiple substitutionsand quantity\n        if (\n          substitutions === undefined ||\n          typeof substitutions?.[counter] === 'undefined'\n        ) {\n          log.error(`Missing ${0} argument for key %c'${translationKey}'`)\n          return ''\n        }\n        return substitutions[counter].toString()\n      })\n    }\n\n    return message\n  }\n\n  return getMessage\n}\n", "import { BrowserWindow, Menu, shell } from 'electron'\nimport { readFileSync } from 'fs'\nimport { join } from 'path'\n\nimport {\n  gitHubIssuesUrl,\n  homePageUrl,\n  appWindowTitle,\n} from '../../shared/constants.js'\nimport { getLogger } from '../../shared/logger.js'\nimport { getLogsPath } from './application-constants.js'\nimport { LogHandler } from './log-handler.js'\nimport * as mainWindow from './windows/main.js'\nimport { DesktopSettings } from './desktop_settings.js'\nimport { getCurrentLocaleDate, tx } from './load-translations.js'\nimport { mapPackagePath } from './isAppx.js'\nimport { quitDeltaChat } from './tray.js'\nimport { getLocaleDirectoryPath } from './getLocaleDirectory.js'\n\nconst log = getLogger('main/menu')\n\nconst languages: {\n  locale: string\n  name: string\n}[] = (() => {\n  const languagesFile = join(getLocaleDirectoryPath(), '_languages.json')\n  const rawLanguageList: { [locale: string]: string } = JSON.parse(\n    readFileSync(languagesFile, 'utf8')\n  )\n\n  return Object.keys(rawLanguageList)\n    .map(locale => ({\n      locale: locale,\n      name: rawLanguageList[locale],\n    }))\n    .filter(({ name }) => name.indexOf('*') === -1)\n    .sort(({ name: name1 }, { name: name2 }) => (name1 > name2 ? 1 : -1))\n})()\n\nlet logHandlerRef: LogHandler | null = null\n\nexport function refresh() {\n  log.info(`rebuilding menu with locale ${getCurrentLocaleDate().locale}`)\n  if (!logHandlerRef) {\n    log.critical('logHandlerRef not defined, could not build menu')\n    return\n  }\n  const template = getMenuTemplate(logHandlerRef)\n  const menu = Menu.buildFromTemplate(template)\n  const item = getMenuItem(menu, tx('global_menu_view_floatontop_desktop'))\n  if (item) item.checked = mainWindow.isAlwaysOnTop()\n  const isMac = process.platform === 'darwin'\n  if (isMac === true) {\n    Menu.setApplicationMenu(menu)\n    return\n  }\n  mainWindow.window?.setMenu(menu)\n}\n\nexport function init(logHandler: LogHandler) {\n  logHandlerRef = logHandler\n  refresh()\n}\n\ninterface rawMenuItem extends Electron.MenuItemConstructorOptions {\n  translate?: string\n  submenu?: (rawMenuItem | Electron.MenuItemConstructorOptions)[]\n}\n\nfunction getAvailableLanguages(): Electron.MenuItemConstructorOptions[] {\n  const { locale: currentLocale } = getCurrentLocaleDate()\n  return languages.map(({ locale, name }) => {\n    return {\n      label: name,\n      type: 'radio',\n      checked: locale === currentLocale,\n      click: () => {\n        DesktopSettings.update({ locale })\n        mainWindow.chooseLanguage(locale)\n      },\n    }\n  })\n}\n\nfunction getZoomFactors(): Electron.MenuItemConstructorOptions[] {\n  // for now this solution is electron specific\n  const zoomFactors = [\n    { scale: 0.6, key: 'extra_small' },\n    { scale: 0.8, key: 'small' },\n    { scale: 1.0, key: 'normal' },\n    { scale: 1.2, key: 'large' },\n    { scale: 1.4, key: 'extra_large' },\n  ]\n\n  const currentZoomFactor = DesktopSettings.state.zoomFactor\n\n  if (zoomFactors.map(({ scale }) => scale).indexOf(currentZoomFactor) === -1)\n    zoomFactors.push({\n      scale: currentZoomFactor,\n      key: 'custom',\n    })\n\n  return zoomFactors.map(({ key, scale }) => {\n    return {\n      label: !(scale === 1 && key === 'custom')\n        ? `${scale}x ${tx(key)}`\n        : tx('custom'),\n      type: 'radio',\n      checked:\n        scale === DesktopSettings.state.zoomFactor &&\n        !(scale === 1 && key === 'custom'),\n      click: () => {\n        if (key !== 'custom') {\n          DesktopSettings.update({ zoomFactor: scale })\n          mainWindow.setZoomFactor(scale)\n        } else {\n          // todo? currently it is a no-op and the 'option' is only shown\n          // when the config value was changed by the user\n        }\n      },\n    }\n  })\n}\n\nexport function getAppMenu(\n  window: BrowserWindow | null\n): Electron.MenuItemConstructorOptions {\n  const isMainWindow = window === mainWindow.window\n  const extraItemsForMainWindow: rawMenuItem[] = [\n    {\n      label: tx('global_menu_help_about_desktop'),\n      click: () => {\n        mainWindow.send('showAboutDialog')\n      },\n    },\n    { type: 'separator' },\n    {\n      label: tx('menu_settings'),\n      click: () => {\n        mainWindow.send('showSettingsDialog')\n      },\n      accelerator: 'Cmd+,',\n    },\n    { type: 'separator' },\n  ]\n\n  return {\n    label: appWindowTitle,\n    submenu: [\n      ...(isMainWindow ? extraItemsForMainWindow : []),\n      { role: 'hide' },\n      { role: 'hideOthers' },\n      { role: 'unhide' },\n      { type: 'separator' },\n      ...(isMainWindow\n        ? [\n            {\n              // because menubar stays when it's closed and apple wants that the user can reopen it via the menu bar\n              label: tx('show_window'),\n              click: () => {\n                mainWindow.show()\n              },\n            },\n          ]\n        : []),\n      {\n        label: tx('global_menu_file_quit_desktop'),\n        role: 'quit',\n        accelerator: 'Cmd+q',\n      },\n    ],\n  }\n}\n\nexport function getFileMenu(\n  window: BrowserWindow | null,\n  isMac: boolean\n): Electron.MenuItemConstructorOptions {\n  const fileMenuNonMac: Electron.MenuItemConstructorOptions = {\n    label: tx('global_menu_file_desktop'),\n    submenu: (() => {\n      if (window === mainWindow.window) {\n        return [\n          {\n            label: tx('menu_settings'),\n            click: () => {\n              mainWindow.send('showSettingsDialog')\n            },\n            accelerator: 'Ctrl+,',\n          },\n          {\n            label: tx('global_menu_file_quit_desktop'),\n            click: quitDeltaChat,\n            accelerator: 'Ctrl+q',\n          },\n        ]\n      } else {\n        return [\n          {\n            label: tx('close_window'),\n            click: () => window?.close(),\n            accelerator: 'Ctrl+q',\n          },\n        ]\n      }\n    })(),\n  }\n  const fileMenuMac: Electron.MenuItemConstructorOptions = {\n    label: tx('global_menu_file_desktop'),\n    submenu: [\n      {\n        label: tx('close_window'),\n        click: () => {\n          window?.close()\n          if (isMac) {\n            // change back to main-window menu\n            refresh()\n          }\n        },\n        accelerator: 'Cmd+w',\n      },\n    ],\n  }\n\n  return isMac ? fileMenuMac : fileMenuNonMac\n}\n\nexport function getEditMenu(): Electron.MenuItemConstructorOptions {\n  return {\n    label: tx('global_menu_edit_desktop'),\n    submenu: [\n      {\n        label: tx('global_menu_edit_undo_desktop'),\n        role: 'undo',\n      },\n      {\n        label: tx('global_menu_edit_redo_desktop'),\n        role: 'redo',\n      },\n      {\n        type: 'separator',\n      },\n      {\n        label: tx('global_menu_edit_cut_desktop'),\n        role: 'cut',\n      },\n      {\n        label: tx('global_menu_edit_copy_desktop'),\n        role: 'copy',\n      },\n      {\n        label: tx('global_menu_edit_paste_desktop'),\n        role: 'paste',\n      },\n      {\n        label: tx('delete'),\n        role: 'delete',\n      },\n      {\n        label: tx('menu_select_all'),\n        role: 'selectAll',\n      },\n    ],\n  }\n}\n\nexport function getHelpMenu(\n  isMac: boolean\n): Electron.MenuItemConstructorOptions {\n  return {\n    label: tx('global_menu_help_desktop'),\n    role: 'help',\n    submenu: [\n      {\n        label: tx('menu_help'),\n        click: () => {\n          mainWindow.send('showHelpDialog')\n        },\n        accelerator: 'F1',\n      },\n      {\n        label: tx('keybindings'),\n        click: () => {\n          mainWindow.window?.show()\n          mainWindow.window?.focus()\n          mainWindow.send('showKeybindingsDialog')\n        },\n        accelerator: isMac ? 'Cmd+/' : 'Ctrl+/',\n      },\n      {\n        type: 'separator',\n      },\n      {\n        label: tx('delta_chat_homepage'),\n        click: () => {\n          shell.openExternal(homePageUrl)\n        },\n      },\n      {\n        label: tx('contribute'),\n        click: () => {\n          shell.openExternal('https://delta.chat/contribute')\n        },\n      },\n      {\n        label: tx('global_menu_help_report_desktop'),\n        click: () => {\n          shell.openExternal(gitHubIssuesUrl)\n        },\n      },\n      {\n        type: 'separator',\n      },\n      {\n        label: tx('global_menu_help_about_desktop'),\n        click: () => {\n          mainWindow.window?.show()\n          mainWindow.window?.focus()\n          mainWindow.send('showAboutDialog')\n        },\n      },\n    ],\n  }\n}\n\nfunction getMenuTemplate(\n  logHandler: LogHandler\n): Electron.MenuItemConstructorOptions[] {\n  const isMac = process.platform === 'darwin'\n  return [\n    ...(isMac ? [getAppMenu(mainWindow.window)] : []),\n    getFileMenu(mainWindow.window, isMac),\n    getEditMenu(),\n    {\n      label: tx('global_menu_view_desktop'),\n      submenu: [\n        {\n          label: tx('global_menu_view_floatontop_desktop'),\n          type: 'checkbox',\n          click: () => mainWindow.toggleAlwaysOnTop(),\n        },\n        {\n          label: tx('zoom'),\n          submenu: getZoomFactors(),\n        },\n        {\n          label: tx('pref_language'),\n          submenu: getAvailableLanguages(),\n        },\n        {\n          type: 'separator',\n        },\n        {\n          label: tx('global_menu_view_developer_desktop'),\n          submenu: [\n            {\n              label: tx('global_menu_view_developer_tools_desktop'),\n              accelerator:\n                process.platform === 'darwin'\n                  ? 'Alt+Command+I'\n                  : 'Ctrl+Shift+I',\n              click: () => mainWindow.toggleDevTools(),\n            },\n            {\n              label: tx('menu.view.developer.open.log.folder'),\n              click: () => {\n                shell.openPath(mapPackagePath(getLogsPath()))\n              },\n            },\n            {\n              label: tx('menu.view.developer.open.current.log.file'),\n              click: () => {\n                shell.openPath(mapPackagePath(logHandler.logFilePath()))\n              },\n            },\n          ],\n        },\n      ],\n    },\n    getHelpMenu(isMac),\n  ]\n}\n\nfunction getMenuItem(menu: Menu, label: string) {\n  for (let i = 0; i < menu.items.length; i++) {\n    const menuItem = menu.items[i].submenu?.items.find(function (item) {\n      return item.label === label\n    })\n    if (menuItem) return menuItem\n  }\n}\n", "export const appName = 'Delta Chat'\nexport const homePageUrl = 'https://delta.chat'\nexport const gitHubUrl = 'https://github.com/deltachat/deltachat-desktop'\nexport const gitHubIssuesUrl = gitHubUrl + '/issues'\nexport const gitHubLicenseUrl = gitHubUrl + '/blob/main/LICENSE'\nexport const donationUrl = 'https://delta.chat/donate'\n\nexport const appWindowTitle = appName\n\nexport const enum Timespans {\n  ZERO_SECONDS = 0,\n  ONE_SECOND = 1,\n  ONE_MINUTE_IN_SECONDS = 60,\n  ONE_HOUR_IN_SECONDS = 60 * 60,\n  ONE_DAY_IN_SECONDS = 60 * 60 * 24,\n  ONE_WEEK_IN_SECONDS = 60 * 60 * 24 * 7,\n  ONE_YEAR_IN_SECONDS = 60 * 60 * 24 * 365,\n}\n\nexport const enum AutodeleteDuration {\n  NEVER = Timespans.ZERO_SECONDS,\n  AT_ONCE = Timespans.ONE_SECOND,\n  ONE_MINUTE = Timespans.ONE_MINUTE_IN_SECONDS,\n  ONE_HOUR = Timespans.ONE_HOUR_IN_SECONDS,\n  ONE_DAY = Timespans.ONE_DAY_IN_SECONDS,\n  ONE_WEEK = Timespans.ONE_WEEK_IN_SECONDS,\n  FIVE_WEEKS = Timespans.ONE_WEEK_IN_SECONDS * 5,\n  ONE_YEAR = Timespans.ONE_YEAR_IN_SECONDS,\n}\n\nexport const IMAGE_EXTENSIONS = ['jpg', 'jpeg', 'png', 'apng', 'gif', 'webp']\n\n// Videochat Server URLs\nexport const VIDEO_CHAT_INSTANCE_SYSTEMLI = 'https://meet.systemli.org/$ROOM'\nexport const VIDEO_CHAT_INSTANCE_AUTISTICI = 'https://vc.autistici.org/$ROOM'\n\nexport const enum NOTIFICATION_TYPE {\n  MESSAGE,\n  REACTION,\n  WEBXDC_INFO,\n}\n", "import appConfig from './application-config.js'\nimport { dirname, join } from 'path'\nimport { app, screen } from 'electron'\nimport { fileURLToPath } from 'url'\n\nconst __dirname = dirname(fileURLToPath(import.meta.url))\n\nconst AppFilesDir = join(__dirname, '..')\n\nexport function appIcon() {\n  const iconFormat = process.platform === 'win32' ? '.ico' : '.png'\n  return `${join(htmlDistDir(), 'images', 'deltachat' + iconFormat)}`\n}\n\nexport function htmlDistDir() {\n  return join(AppFilesDir, 'html-dist')\n}\n\nexport function windowDefaults() {\n  let targetFile = 'main.html'\n  let defaultWidth = 1000\n  if (process.env.NODE_ENV === 'test') {\n    targetFile = 'test.html'\n    defaultWidth = 1100\n  }\n  const { height: screenHeight, width: screenWidth } =\n    screen.getPrimaryDisplay().workAreaSize\n  const headerHeight = 38\n  // NOTE(maxph): we have a padding of 66px on the left of the buttons\n  const defaultHeight = Math.min(802 + headerHeight, screenHeight)\n\n  const x = (screenWidth - defaultWidth) / 2\n  const y = (screenHeight - defaultHeight) / 2\n\n  return {\n    bounds: {\n      height: defaultHeight,\n      width: defaultWidth,\n      x,\n      y,\n    },\n    headerHeight,\n    // On 0.6x zoom Delta Chat and 200x window size it's still somewhat usable,\n    // not much is overflowing.\n    minWidth: 225,\n    minHeight: 125,\n    main: targetFile,\n    preload: join(htmlDistDir(), 'preload.js'),\n  }\n}\n\nexport function getConfigPath() {\n  return dirname(appConfig.filePath)\n}\n\nexport function getLogsPath() {\n  return join(getConfigPath(), 'logs')\n}\n\nexport function getAccountsPath() {\n  return join(getConfigPath(), 'accounts')\n}\n\nexport function getCustomThemesPath() {\n  return join(getConfigPath(), 'custom-themes')\n}\n\n// this is used for temporary files (because core expects file paths, can not accept blobs directly yet)\n// used when sending file from webxdc and when pasting a file from clipboard\nexport function getDraftTempDir() {\n  return join(app.getPath('temp'), 'chat.delta.desktop-draft')\n}\n\nexport const supportedURISchemes = [\n  'OPENPGP4FPR:',\n  'MAILTO:',\n  'DCACCOUNT:',\n  'DCLOGIN:',\n]\n\n/// Files that the main window is allowed access over the file protocol\n\n// folders the renderer need to load resources from\nconst ALLOWED_RESOURCE_FOLDERS = ['images', 'node_modules', 'html-dist']\n// folders the renderer wants to load source files from (when using the devtools)\nconst ALLOWED_SOURCE_FOLDERS = ['src', 'scss', 'node_modules']\n\nconst ALLOWED_CONFIG_FOLDERS = ['background']\n\nexport const ALLOWED_STATIC_FOLDERS = [\n  ...[...ALLOWED_RESOURCE_FOLDERS, ...ALLOWED_SOURCE_FOLDERS].map(folder =>\n    join(AppFilesDir, folder)\n  ),\n  ...ALLOWED_CONFIG_FOLDERS.map(folder => join(getConfigPath(), folder)),\n  getDraftTempDir(),\n]\n\nexport const ALLOWED_ACCOUNT_FOLDERS = [\n  'db.sqlite-blobs' /* can this old name still exist? */,\n  'dc.db-blobs',\n  'stickers',\n]\n\n// folder inside account dir to store files\n// temporary when opened in another application\n// cleared on app start\nexport const INTERNAL_TMP_DIR_NAME = 'tmp'\n", "// @ts-ignore\nimport applicationConfig from 'application-config'\nif (process.env.NODE_ENV !== 'production') {\n  try {\n    const { config } = await import('dotenv')\n    config()\n  } catch (e) {\n    /* ignore-console-log */\n    console.error('Failed to load .env file', e)\n  }\n}\n\nconst appConfig = applicationConfig('DeltaChat')\n\nimport { join } from 'path'\n\nif (process.env.DC_TEST_DIR) {\n  appConfig.filePath = join(process.env.DC_TEST_DIR, 'config.json')\n} else if (process.env.PORTABLE_EXECUTABLE_DIR) {\n  /* ignore-console-log */\n  console.log('Running in Portable Mode', process.env.PORTABLE_EXECUTABLE_DIR)\n  appConfig.filePath = join(\n    process.env.PORTABLE_EXECUTABLE_DIR,\n    'DeltaChatData',\n    'config.json'\n  )\n}\n\nexport default Object.freeze(appConfig)\n", "import debounce from 'debounce'\nimport electron, { BrowserWindow, Rectangle, session } from 'electron'\nimport { isAbsolute, join, sep } from 'path'\nimport { platform } from 'os'\nimport { fileURLToPath } from 'url'\nimport { Session } from 'electron/main'\n\nimport { appWindowTitle } from '../../../shared/constants.js'\nimport { getLogger } from '../../../shared/logger.js'\nimport {\n  appIcon,\n  windowDefaults,\n  htmlDistDir,\n  ALLOWED_STATIC_FOLDERS,\n  getAccountsPath,\n  ALLOWED_ACCOUNT_FOLDERS,\n} from '../application-constants.js'\nimport { refreshTrayContextMenu } from '../tray.js'\nimport { DesktopSettings } from '../desktop_settings.js'\nimport { refresh as refreshTitleMenu } from '../menu.js'\nimport { initMinWinDimensionHandling } from './helpers.js'\nimport { setContentProtection } from '../content-protection.js'\n\nconst log = getLogger('/mainWindow')\n\ntype ExtendedBrowserWindow = BrowserWindow & {\n  hidden?: boolean\n  /**\n   * whitelist of file paths that user selected that the UI should be able to also load via the file:/// scheme\n   * example: when changing avatar, we need to display the selected image before it is uploaded to core\n   */\n  filePathWhiteList: string[]\n}\n\nexport let window: ExtendedBrowserWindow | null = null\n\nexport function init(options: { hidden: boolean }) {\n  if (window) {\n    return window.show()\n  }\n\n  const defaults = windowDefaults()\n  const initialBounds = Object.assign(\n    defaults.bounds,\n    DesktopSettings.state.bounds\n  )\n\n  const isMac = platform() === 'darwin'\n\n  const mainWindow = (window = <ExtendedBrowserWindow>(\n    new electron.BrowserWindow({\n      backgroundColor: '#282828',\n      // backgroundThrottling: false, // do not throttle animations/timers when page is background\n      darkTheme: true, // Forces dark theme (GTK+3)\n      icon: appIcon(),\n      show: false,\n      title: appWindowTitle,\n      height: initialBounds.height,\n      width: initialBounds.width,\n      x: initialBounds.x,\n      y: initialBounds.y,\n      webPreferences: {\n        nodeIntegration: false,\n        preload: defaults.preload,\n        spellcheck: false, // until we can load a local dictionary, see https://github.com/electron/electron/issues/22995\n        webSecurity: true,\n        allowRunningInsecureContent: false,\n        contextIsolation: false,\n      },\n      titleBarStyle: isMac ? 'hidden' : 'default',\n      titleBarOverlay: true,\n    })\n  ))\n  mainWindow.filePathWhiteList = []\n\n  initMinWinDimensionHandling(mainWindow, defaults.minWidth, defaults.minHeight)\n\n  setContentProtection(window)\n\n  // disable network request to fetch dictionary\n  // issue: https://github.com/electron/electron/issues/22995\n  // feature request for local dictionary: https://github.com/electron/electron/issues/22995\n  session.defaultSession.setSpellCheckerDictionaryDownloadURL('https://00.00/')\n\n  window.loadFile(join(htmlDistDir(), defaults.main))\n\n  window.once('ready-to-show', () => {\n    if (!options.hidden) mainWindow.show()\n    if (process.env.NODE_ENV === 'test') {\n      mainWindow.maximize()\n    }\n  })\n\n  if (window.setSheetOffset) {\n    window.setSheetOffset(defaults.headerHeight)\n  }\n\n  window.webContents.on('will-navigate', (e: electron.Event, _url: string) => {\n    // Prevent drag-and-drop from navigating the Electron window, which can happen\n    // before our drag-and-drop handlers have been initialized.\n    e.preventDefault()\n  })\n\n  const saveBounds = debounce(() => {\n    const bounds = window?.getBounds()\n    if (bounds) {\n      DesktopSettings.update({ bounds })\n    }\n  }, 1000)\n\n  window.on('move', saveBounds)\n\n  window.on('resize', saveBounds)\n\n  window.once('show', () => {\n    mainWindow.webContents.setZoomFactor(DesktopSettings.state.zoomFactor)\n  })\n  window.on('close', () => {})\n  window.on('blur', () => {\n    mainWindow.hidden = true\n    refreshTrayContextMenu()\n  })\n  window.on('focus', () => {\n    mainWindow.hidden = false\n    refreshTrayContextMenu()\n    refreshTitleMenu()\n  })\n\n  const allowed_web_permissions = [\n    'notifications',\n    'pointerLock',\n    'fullscreen',\n    'clipboard-read',\n    'media',\n    'mediaKeySystem',\n    'accessibility-events',\n    'clipboard-sanitized-write',\n    // not used:\n    //  \"display-capture\", - not used\n    //  \"geolocation\", - not used\n    //  \"midi\" - not used\n    //  \"midiSysex\" - not used\n    // what is this about?\n    //  \"openExternal\"\n    //  \"window-placement\"\n  ]\n  type permission_arg = Parameters<\n    Exclude<Parameters<Session['setPermissionRequestHandler']>[0], null>\n  >[1]\n  const permission_handler = (permission: permission_arg) => {\n    log.info('preq', permission)\n    if (!allowed_web_permissions.includes(permission)) {\n      log.info(\n        `main window requested \"${permission}\" permission, but we denied it, because it is not in the list of allowed permissions.`\n      )\n      return false\n    } else {\n      return true\n    }\n  }\n  window.webContents.session.setPermissionCheckHandler((_wc, permission) => {\n    return permission_handler(permission as any)\n  })\n  window.webContents.session.setPermissionRequestHandler(\n    (_wc, permission, callback) => {\n      callback(permission_handler(permission))\n    }\n  )\n\n  window.webContents.session.webRequest.onBeforeRequest(\n    { urls: ['file://*'] },\n    (details, callback) => {\n      const pathname = fileURLToPath(\n        decodeURIComponent(new URL(details.url).href)\n      )\n\n      if (!isAbsolute(pathname) || pathname.includes('..')) {\n        log.errorWithoutStackTrace('tried to access relative path', pathname)\n        return callback({ cancel: true })\n      }\n      if (pathname.startsWith(getAccountsPath())) {\n        const relativePathInAccounts = pathname.replace(getAccountsPath(), '')\n        const relativePathInAccount = relativePathInAccounts.slice(\n          relativePathInAccounts.indexOf(sep, 1) + 1\n        )\n        if (\n          ALLOWED_ACCOUNT_FOLDERS.find(allowedPath =>\n            relativePathInAccount.startsWith(allowedPath)\n          )\n        ) {\n          return callback({ cancel: false })\n        }\n      }\n\n      if (\n        ALLOWED_STATIC_FOLDERS.find(allowedPath =>\n          pathname.startsWith(allowedPath)\n        )\n      ) {\n        return callback({ cancel: false })\n      }\n\n      if (window?.filePathWhiteList.includes(pathname)) {\n        return callback({ cancel: false })\n      }\n\n      log.errorWithoutStackTrace(\n        'tried to access path that is not whitelisted',\n        pathname\n      )\n      return callback({ cancel: true })\n    }\n  )\n}\n\nexport function hide() {\n  window?.hide()\n}\n\nexport function send(channel: string, ...args: any[]) {\n  if (!window) {\n    log.warn(\"window not defined, can't send ipc to renderer\")\n    return\n  }\n  if (window.isDestroyed()) {\n    log.info('window is destroyed. not sending message', args)\n    return\n  }\n  try {\n    window.webContents.send(channel, ...args)\n  } catch (error) {\n    log.error('can not send message to window, error:', error)\n  }\n}\n\n/**\n * Enforce window aspect ratio. Remove with 0. (Mac)\n */\n// export function setAspectRatio(aspectRatio) {\n//   window?.setAspectRatio(aspectRatio)\n// }\n\nexport function setBounds(\n  bounds: Rectangle & { contentBounds: boolean },\n  maximize: boolean\n) {\n  if (!window) {\n    throw new Error('window does not exist, this should never happen')\n  }\n  // Maximize or minimize, if the second argument is present\n  if (maximize === true && !window.isMaximized()) {\n    log.debug('setBounds: maximizing')\n    window.maximize()\n  } else if (maximize === false && window.isMaximized()) {\n    log.debug('setBounds: unmaximizing')\n    window.unmaximize()\n  }\n\n  const willBeMaximized =\n    typeof maximize === 'boolean' ? maximize : window.isMaximized()\n  // Assuming we're not maximized or maximizing, set the window size\n  if (!willBeMaximized) {\n    log.debug(`setBounds: setting bounds to ${JSON.stringify(bounds)}`)\n    if (bounds.x === null && bounds.y === null) {\n      // X and Y not specified? By default, center on current screen\n      const scr = electron.screen.getDisplayMatching(window.getBounds())\n      bounds.x = Math.round(\n        scr.bounds.x + scr.bounds.width / 2 - bounds.width / 2\n      )\n      bounds.y = Math.round(\n        scr.bounds.y + scr.bounds.height / 2 - bounds.height / 2\n      )\n      log.debug(`setBounds: centered to ${JSON.stringify(bounds)}`)\n    }\n    // Resize the window's content area (so window border doesn't need to be taken\n    // into account)\n    if (bounds.contentBounds) {\n      window.setContentBounds(bounds, true)\n    } else {\n      window.setBounds(bounds, true)\n    }\n  } else {\n    log.debug('setBounds: not setting bounds because of window maximization')\n  }\n}\n\n/**\n * Set progress bar to [0, 1]. Indeterminate when > 1. Remove with < 0.\n */\nexport function setProgress(progress: number) {\n  window?.setProgressBar(progress)\n}\n\nexport function setTitle(title?: string) {\n  if (title) {\n    window?.setTitle(`${appWindowTitle} - ${title}`)\n  } else {\n    window?.setTitle(appWindowTitle)\n  }\n}\n\nexport function show() {\n  window?.show()\n}\n\nexport function toggleAlwaysOnTop() {\n  if (!window) return\n  const flag = !window.isAlwaysOnTop()\n  log.info(`toggleAlwaysOnTop ${flag}`)\n  window.setAlwaysOnTop(flag)\n}\n\nexport function isAlwaysOnTop() {\n  return window ? window.isAlwaysOnTop() : false\n}\n\nexport function toggleDevTools() {\n  if (!window) return\n  log.info('toggleDevTools')\n  if (window.webContents.isDevToolsOpened()) {\n    window.webContents.closeDevTools()\n  } else {\n    window.webContents.openDevTools({ mode: 'detach' })\n  }\n}\n\nexport function chooseLanguage(locale: string) {\n  window?.webContents.send('chooseLanguage', locale)\n}\n\nexport function setZoomFactor(factor: number) {\n  log.info('setZoomFactor', factor)\n  window?.webContents.setZoomFactor(factor)\n}\n", "import { app as rawApp, Menu, Tray, nativeImage, NativeImage } from 'electron'\nimport { globalShortcut } from 'electron'\nimport { join, dirname } from 'path'\nimport { fileURLToPath } from 'url'\n\nimport * as mainWindow from './windows/main.js'\nimport { ExtendedAppMainProcess } from './types.js'\nimport { getLogger } from '../../shared/logger.js'\nimport { DesktopSettings } from './desktop_settings.js'\nimport { tx } from './load-translations.js'\nimport { htmlDistDir } from './application-constants.js'\n\nconst __dirname = dirname(fileURLToPath(import.meta.url))\n\nlet tray: Tray | null = null\nlet contextMenu: Menu | null = null\n\nconst app = rawApp as ExtendedAppMainProcess\nconst log = getLogger('main/tray')\n\nlet has_unread = false\n\nexport function set_has_unread(new_has_unread: boolean) {\n  has_unread = new_has_unread\n  if (tray) {\n    tray.setImage(TrayImage())\n  }\n}\n\nfunction TrayImage(): string | NativeImage {\n  const trayIconFolder = join(htmlDistDir(), 'images/tray')\n  if (process.platform === 'darwin') {\n    const image = nativeImage\n      .createFromPath(join(trayIconFolder, 'tray-icon-mac.png'))\n      .resize({ width: 24 })\n    image.setTemplateImage(true)\n    return image\n  } else {\n    const iconFormat = process.platform === 'win32' ? '.ico' : '.png'\n\n    return `${join(\n      trayIconFolder,\n      (has_unread ? 'deltachat-unread' : 'deltachat') + iconFormat\n    )}`\n  }\n}\n\nfunction mainWindowIsVisible() {\n  if (!mainWindow.window) {\n    throw new Error('window does not exist, this should never happen')\n  }\n  if (process.platform === 'darwin' || process.platform === 'win32') {\n    return mainWindow.window.isVisible()\n  }\n  return mainWindow.window.isVisible() && mainWindow.window.isFocused()\n}\n\nexport function hideDeltaChat(minimize?: boolean) {\n  if (!mainWindow.window) {\n    throw new Error('window does not exist, this should never happen')\n  }\n  if (minimize === true) {\n    mainWindow.window.minimize()\n  }\n  mainWindow.window.hide()\n  if (process.platform === 'linux') tray?.setContextMenu(getTrayMenu() as Menu)\n}\n\nexport function showDeltaChat() {\n  if (!mainWindow.window) {\n    throw new Error('window does not exist, this should never happen')\n  }\n  mainWindow.window.show()\n}\n\nfunction hideOrShowDeltaChat() {\n  mainWindowIsVisible() ? hideDeltaChat(true) : showDeltaChat()\n}\n\nexport function quitDeltaChat() {\n  globalShortcut.unregisterAll()\n  app.quit()\n}\n\nexport function updateTrayIcon() {\n  // User doesn't want tray icon => destroy it\n  if (!app.rc['minimized'] && DesktopSettings.state.minimizeToTray !== true) {\n    if (tray != null) destroyTrayIcon()\n    return\n  }\n\n  renderTrayIcon()\n}\n\nfunction destroyTrayIcon() {\n  log.info('destroy icon tray')\n  tray?.destroy()\n  tray = null\n}\n\nfunction getTrayMenu() {\n  if (tray === null) return\n  if (process.platform === 'darwin') {\n    contextMenu = Menu.buildFromTemplate([\n      mainWindowIsVisible()\n        ? {\n            id: 'reduce_window',\n            label: tx('hide'),\n            type: 'normal',\n            click() {\n              hideDeltaChat()\n              // fix #3041\n              refreshTrayContextMenu()\n            },\n          }\n        : {\n            id: 'open_windows',\n            label: tx('activate'),\n            type: 'normal',\n            click() {\n              showDeltaChat()\n              // fix #3041\n              refreshTrayContextMenu()\n            },\n          },\n\n      {\n        id: 'quit_app',\n        label: tx('global_menu_file_quit_desktop'),\n        type: 'normal',\n        click() {\n          quitDeltaChat()\n        },\n      },\n    ])\n  } else {\n    // is windows/linux\n    contextMenu = Menu.buildFromTemplate([\n      {\n        id: 'open_windows',\n        label: tx('global_menu_file_open_desktop'),\n        type: 'normal',\n        click() {\n          showDeltaChat()\n        },\n      },\n      {\n        id: 'reduce_window',\n        label: tx('global_menu_minimize_to_tray'),\n        type: 'normal',\n        enabled: mainWindowIsVisible(),\n        click() {\n          hideDeltaChat()\n        },\n      },\n      {\n        id: 'quit_app',\n        label: tx('global_menu_file_quit_desktop'),\n        type: 'normal',\n        click() {\n          quitDeltaChat()\n        },\n      },\n    ])\n  }\n\n  return contextMenu\n}\n\nfunction TrayIcon() {\n  return new Tray(TrayImage())\n}\n\nfunction renderTrayIcon() {\n  if (tray != null) {\n    log.warn('Tray icon not destroyed before render?')\n    destroyTrayIcon()\n  }\n\n  // Add tray icon\n  log.info('add icon tray')\n  tray = TrayIcon()\n\n  tray.setToolTip('Delta Chat')\n\n  if (process.platform === 'darwin') {\n    tray.on('click', () => tray?.popUpContextMenu(getTrayMenu()))\n    tray.on('right-click', () => tray?.popUpContextMenu(getTrayMenu()))\n  } else if (process.platform === 'win32') {\n    tray.on('click', hideOrShowDeltaChat)\n    tray.on('right-click', () => tray?.popUpContextMenu(getTrayMenu()))\n  } else {\n    tray.on('click', hideOrShowDeltaChat)\n    tray.on('double-click', hideOrShowDeltaChat)\n\n    refreshTrayContextMenu()\n  }\n}\n\nexport function refreshTrayContextMenu() {\n  tray?.setContextMenu(getTrayMenu() as Menu)\n}\n", "import { EventEmitter } from 'events'\nimport { promisify } from 'util'\nimport { getLogger } from '../../shared/logger.js'\nimport { DesktopSettingsType } from '../../shared/shared-types.js'\nimport { getDefaultState } from '../../shared/state.js'\nimport appConfig from './application-config.js'\nimport debounce from 'debounce'\nconst log = getLogger('main/state')\n\nconst SAVE_DEBOUNCE_INTERVAL = 1000\n\nclass PersistentState extends EventEmitter {\n  constructor() {\n    super()\n  }\n\n  private inner_state: null | DesktopSettingsType = null\n\n  get state(): Readonly<DesktopSettingsType> {\n    if (this.inner_state == null) {\n      throw new Error('Can not access persistent state before initialisation')\n    }\n    return this.inner_state\n  }\n\n  async load() {\n    const default_state = getDefaultState()\n    let saved: Partial<DesktopSettingsType> = {}\n    try {\n      saved = (await promisify(cb =>\n        appConfig.read(cb)\n      )()) as DesktopSettingsType\n      // validate&fix saved state\n      if (typeof saved.lastAccount !== 'number' || saved.lastAccount < 0) {\n        saved.lastAccount = undefined\n      }\n    } catch (error) {\n      log.debug(error)\n      log.info('Missing configuration file. Using default values.')\n    }\n    this.inner_state = Object.assign(default_state, saved)\n  }\n\n  update(state: Partial<DesktopSettingsType>) {\n    this.inner_state = { ...this.inner_state, ...state } as DesktopSettingsType\n    this.save()\n  }\n\n  /** state.save() calls are rate-limited. Use `PersistentState.saveImmediate()` to skip limit. */\n  save() {\n    // After first State.save() invocation, future calls go straight to the\n    // debounced function\n    this.save = debounce(this.saveImmediate, SAVE_DEBOUNCE_INTERVAL)\n    this.saveImmediate()\n  }\n\n  saveImmediate(): Promise<void> {\n    log.info(`Saving state to ${appConfig.filePath}`)\n    const copy = Object.assign({}, this.inner_state)\n    return new Promise((res, rej) => {\n      appConfig.write(copy, (err: any) => {\n        if (err) {\n          log.error('State save failed', err)\n          rej(err)\n        }\n        res(err)\n      })\n    })\n  }\n}\n\n// State singleton\nexport const DesktopSettings = new PersistentState()\n", "import { DesktopSettingsType } from './shared-types.js'\n\nexport function getDefaultState(): DesktopSettingsType {\n  /**\n   * Persisted state. Must be JSON.\n   */\n  return {\n    bounds: {},\n    HTMLEmailWindowBounds: undefined,\n    enterKeySends: false,\n    notifications: true,\n    showNotificationContent: true,\n    locale: null, // if this is null, the system chooses the system language that electron reports\n    credentials: undefined,\n    lastAccount: undefined,\n    enableAVCalls: false,\n    enableBroadcastLists: false,\n    enableChatAuditLog: false,\n    enableOnDemandLocationStreaming: false,\n    chatViewBgImg: undefined,\n    lastChats: {},\n    zoomFactor: 1,\n    activeTheme: 'system',\n    minimizeToTray: true,\n    syncAllAccounts: true,\n    lastSaveDialogLocation: undefined,\n    experimentalEnableMarkdownInMessages: false,\n    enableWebxdcDevTools: false,\n    HTMLEmailAskForRemoteLoadingConfirmation: true,\n    HTMLEmailAlwaysLoadRemoteContent: false,\n    enableRelatedChats: false,\n    galleryImageKeepAspectRatio: false,\n    useSystemUIFont: false,\n    contentProtectionEnabled: false,\n    isMentionsEnabled: true,\n    autostart: true,\n  }\n}\n", "import { BrowserWindow, screen } from 'electron'\n\n/** set min window dimensions, or turns them off on screens smaller than the min dimensions\n *\n * @returns function to remove the listeners again\n */\nexport function initMinWinDimensionHandling(\n  main_window: BrowserWindow,\n  minWidth: number,\n  minHeight: number\n): () => void {\n  const update_min_size = () => {\n    const { workAreaSize } = screen.getPrimaryDisplay()\n    if (\n      // A multiplier to make space for the taskbar and the window header.\n      // Remember that the taskbar could also be placed vertically.\n      workAreaSize.width * 0.75 < minWidth ||\n      workAreaSize.height * 0.75 < minHeight\n    ) {\n      main_window.setMinimumSize(0, 0)\n    } else {\n      main_window.setMinimumSize(minWidth, minHeight)\n    }\n  }\n  screen.addListener('display-added', update_min_size)\n  screen.addListener('display-metrics-changed', update_min_size)\n  screen.addListener('display-removed', update_min_size)\n  update_min_size()\n  return () => {\n    screen.removeListener('display-added', update_min_size)\n    screen.removeListener('display-metrics-changed', update_min_size)\n    screen.removeListener('display-removed', update_min_size)\n  }\n}\n", "import { BrowserWindow } from 'electron'\nimport { DesktopSettings } from './desktop_settings'\nimport { platform } from 'os'\nimport { getLogger } from '@deltachat-desktop/shared/logger'\n\nconst log = getLogger('contentProtection')\n\nfunction updateContentProtection(window: BrowserWindow, enabled: boolean) {\n  window.setContentProtection(enabled)\n  if (enabled && platform() !== 'darwin' && platform() !== 'win32') {\n    log.warn('setContentProtection not available on your platform', platform())\n  }\n}\n\nexport function setContentProtection(window: BrowserWindow) {\n  updateContentProtection(\n    window,\n    DesktopSettings.state.contentProtectionEnabled\n  )\n}\n\nexport function updateContentProtectionOnAllActiveWindows(enabled: boolean) {\n  for (const win of BrowserWindow.getAllWindows()) {\n    updateContentProtection(win, enabled)\n  }\n}\n", "import { platform } from 'os'\nimport { join } from 'path'\nimport { app } from 'electron'\nimport { readFile } from 'fs/promises'\nimport { existsSync } from 'fs'\n\nexport let appx = false\n\nexport async function isWindowsStorePackage() {\n  if (platform() === 'win32') {\n    const app_path = app.getAppPath()\n    try {\n      const info = JSON.parse(\n        await readFile(\n          join(app_path, '../../', 'windows_build_info.json'),\n          'utf-8'\n        )\n      )\n      if (info.isAPPX) {\n        /* ignore-console-log */\n        console.info('App is probably running as appx')\n        appx = info.isAPPX\n      }\n    } catch (error) {\n      /* ignore-console-log */\n      console.warn(\n        'Could not fetch windows build info, this is normal in dev mode'\n      )\n    }\n  }\n}\n\n/**\n * if installed as an appx package the config folder\n * core sees only the relative part as path\n * without the Packages/package_id/LocalCache part\n * but that path is needed if client tries to open\n * such a folder\n */\nexport function mapPackagePath(path: string) {\n  const basePath = 'AppData\\\\Local\\\\DeltaChat'\n  const packagePath =\n    'AppData\\\\Local\\\\Packages\\\\merlinux.DeltaChat_v2ry5hvxhdhyy\\\\LocalCache\\\\Local\\\\DeltaChat'\n  if (appx && path.indexOf(basePath) > -1) {\n    // only test for packagePath is reliable here, for basePath\n    // existsSync might return true even if it not exists!\n    const transformedPath = path.replace(basePath, packagePath)\n    if (existsSync(transformedPath)) {\n      return transformedPath\n    }\n  }\n  return path\n}\n\nexport function getAppxPath(app_folder: string) {\n  return join(\n    app_folder,\n    '../Packages/merlinux.DeltaChat_v2ry5hvxhdhyy/LocalCache/Local/DeltaChat'\n  )\n}\n", "import { existsSync } from 'fs'\nimport { join, dirname } from 'path'\nimport { fileURLToPath } from 'url'\n\nconst __dirname = dirname(fileURLToPath(import.meta.url))\n\nconst alternativeDirectory = process.env['DELTACHAT_LOCALE_DIR']\n\nlet cachedResult: string | null = null\n\n// Idea: there could be instead a `resolveLocaleDirectoryPath(file)`\n// function that looks in the other folders as fallback if it can't find a file\n// this could make the `DELTACHAT_LOCALE_DIR` env var more useful in\n// also allowing partial locale directories.\n\nexport function getLocaleDirectoryPath() {\n  if (cachedResult) {\n    return cachedResult\n  }\n\n  const places = [\n    alternativeDirectory,\n    join(__dirname, '../_locales'), // packaged\n    join(__dirname, '../../../_locales'), // development\n  ]\n\n  if (alternativeDirectory && !isValidLocaleDirectory(alternativeDirectory)) {\n    throw new Error(\n      `Custom locale directory specified in \\`DELTACHAT_LOCALE_DIR\\` env var is not a valid locale directory.\n      Make sure it exists and contains atleast the following files:\n      - _languages.json        // index of what languages exist\n      - _untranslated_en.json  // for untranslated strings\n      - en.json                // for fallback\n      \n      Path to the invalid directory: ${alternativeDirectory}`\n    )\n  }\n\n  const directory = places.find(isValidLocaleDirectory)\n  if (!directory) {\n    throw new Error('Failed to find locale data')\n  }\n  cachedResult = directory\n  return directory\n}\n\nfunction isValidLocaleDirectory(path: string | undefined): boolean {\n  // console.log(\"isValidLocaleDirectory\", path);\n\n  return (\n    path !== undefined &&\n    existsSync(path) &&\n    existsSync(join(path, '_languages.json')) &&\n    existsSync(join(path, '_untranslated_en.json')) &&\n    existsSync(join(path, 'en.json'))\n  )\n}\n", "export function getHelpMenu() {\n  /* ignore-console-log */\n  console.info(`Options:\n\nFlag\n--                              indicates the end of DeltaChat options\n-h, --help                      Print DeltaChat command line options (currently set).\n--minimized                     Start deltachat in minimized mode with trayicon (trayicon will be activated\n                                for this session regardless whether it's disabled)\n-v, --version                   Prints DeltaChat version.\n\nDevelopment Options\n--translation-watch             enable auto-reload for _locales/_untranslated_en.json\n--dev-mode                      opens electron devtools and activates --log-debug & --log-to-console\n\nTheme\n--theme <theme-id>              set a specific theme (see THEMES.md)\n--theme-watch                   enable auto-reload for the active theme\n\nLogging\n--log-debug                     Log debug messages\n--log-to-console                Output the log to stdout / Chrome dev console\n--machine-readable-stack        Enable JSON stack trace\n--no-color                      Disable colors in the output of main process\n\nFor more info on logging see LOGGING.md.)`)\n}\n", "import { powerMonitor } from 'electron'\n\nimport { window } from './windows/main.js'\n\nfunction onResumeFromSleep() {\n  window?.webContents.send('onResumeFromSleep')\n}\n\nexport function initialisePowerMonitor() {\n  powerMonitor.on('resume', onResumeFromSleep)\n  powerMonitor.on('unlock-screen', onResumeFromSleep)\n  powerMonitor.on('user-did-become-active', onResumeFromSleep)\n}\n", "import { createWriteStream } from 'fs'\nimport { join } from 'path'\nimport { getLogsPath } from './application-constants.js'\nimport { stdout, stderr } from 'process'\n\nstdout.on('error', () => {})\nstderr.on('error', () => {})\n// ^ Without this, the app will run into infinite exceptions\n// when it can't write to stdout or stderr\n\nfunction logName() {\n  const dir = getLogsPath()\n  const d = new Date()\n  function pad(number: number) {\n    return number < 10 ? '0' + number : number\n  }\n  const fileName = [\n    `${d.getFullYear()}-`,\n    `${pad(d.getMonth() + 1)}-`,\n    `${pad(d.getDate())}-`,\n    `${pad(d.getHours())}-`,\n    `${pad(d.getMinutes())}-`,\n    `${pad(d.getSeconds())}`,\n    '.log',\n  ].join('')\n  return join(dir, fileName)\n}\n\nexport function createLogHandler() {\n  const fileName = logName()\n  const stream = createWriteStream(fileName, { flags: 'w' })\n  /* ignore-console-log */\n  console.log(`Logfile: ${fileName}`)\n  return {\n    /**\n     * Internal log handler. Do not call directly!\n     * @param channel The part/module where the message was logged from, e.g. 'main/deltachat'\n     * @param level DEBUG, INFO, WARNING, ERROR or CRITICAL\n     * @param stacktrace Stack trace if WARNING, ERROR or CRITICAL\n     * @param ...args Variadic parameters. Stringified before logged to file\n     */\n    log: ((\n      channel: string,\n      level: string,\n      stacktrace: any[],\n      ...args: any[]\n    ) => {\n      const timestamp = new Date().toISOString()\n      let line = [timestamp, fillString(channel, 22), level]\n      line = line.concat(\n        [stacktrace, ...args].map(value => JSON.stringify(value))\n      )\n      if (stream.writable) {\n        stream.write(`${line.join('\\t')}\\n`)\n      } else {\n        /* ignore-console-log */\n        console.warn('tried to log something after logger shut down', {\n          channel,\n          level,\n          args,\n          stacktrace,\n        })\n      }\n    }) as LogHandlerFunction,\n    end: () => stream.end(),\n    logFilePath: () => fileName,\n  }\n}\nexport type LogHandler = ReturnType<typeof createLogHandler>\n\nimport { readdir, lstat, unlink } from 'fs/promises'\nimport { getLogger, LogHandlerFunction } from '../../shared/logger.js'\n\nexport async function cleanupLogFolder() {\n  const log = getLogger('logger/log-cleanup')\n  const logDir = getLogsPath()\n\n  const logDirContent = await readdir(logDir)\n  const filesWithDates = await Promise.all(\n    logDirContent.map(async logFileName => ({\n      filename: logFileName,\n      mtime: (await lstat(join(logDir, logFileName))).mtime.getTime(),\n    }))\n  )\n\n  const sortedFiles = filesWithDates.sort((a, b) => a.mtime - b.mtime)\n\n  if (sortedFiles.length > 10) {\n    // remove latest 10 logs from list\n    sortedFiles.splice(sortedFiles.length - 11)\n\n    const fileCount = await Promise.all(\n      sortedFiles.map(({ filename }) => unlink(join(logDir, filename)))\n    )\n\n    log.info(`Successfuly deleted ${fileCount.length} old logfiles`)\n  } else {\n    log.debug('Nothing to do (not more than 10 logfiles to delete)')\n  }\n}\n\nfunction fillString(string: string, n: number) {\n  if (string.length < n) {\n    return string + ' '.repeat(n - string.length)\n  }\n  return string\n}\n", "import { copyFile, writeFile, mkdir, rm } from 'fs/promises'\nimport {\n  app as rawApp,\n  clipboard,\n  dialog,\n  ipcMain,\n  nativeImage,\n  shell,\n  NativeImage,\n  systemPreferences,\n} from 'electron'\nimport path, {\n  basename,\n  extname,\n  join,\n  posix,\n  sep,\n  dirname,\n  normalize,\n} from 'path'\nimport { inspect } from 'util'\nimport { platform } from 'os'\nimport { existsSync } from 'fs'\nimport { versions } from 'process'\nimport { fileURLToPath } from 'url'\n\nimport { getLogger } from '../../shared/logger.js'\nimport {\n  getDraftTempDir,\n  getLogsPath,\n  htmlDistDir,\n  INTERNAL_TMP_DIR_NAME,\n} from './application-constants.js'\nimport { LogHandler } from './log-handler.js'\nimport { ExtendedAppMainProcess } from './types.js'\nimport * as mainWindow from './windows/main.js'\nimport { openHelpWindow } from './windows/help.js'\nimport { DesktopSettings } from './desktop_settings.js'\nimport { getConfigPath } from './application-constants.js'\nimport { DesktopSettingsType, RuntimeInfo } from '../../shared/shared-types.js'\nimport { set_has_unread, updateTrayIcon } from './tray.js'\nimport { openHtmlEmailWindow } from './windows/html_email.js'\nimport { appx, mapPackagePath } from './isAppx.js'\nimport DeltaChatController from './deltachat/controller.js'\nimport { BuildInfo } from './get-build-info.js'\nimport { updateContentProtectionOnAllActiveWindows } from './content-protection.js'\nimport { MediaType } from '@deltachat-desktop/runtime-interface'\n\nconst __dirname = dirname(fileURLToPath(import.meta.url))\n\nconst log = getLogger('main/ipc')\n\nconst app = rawApp as ExtendedAppMainProcess\n\nlet dcController: typeof DeltaChatController.prototype\nexport function getDCJsonrpcClient() {\n  return dcController.jsonrpcRemote.rpc\n}\n\n/** returns shutdown function */\nexport async function init(cwd: string, logHandler: LogHandler) {\n  const main = mainWindow\n  dcController = new DeltaChatController(cwd)\n\n  try {\n    await dcController.init()\n  } catch (error) {\n    log.critical(\n      \"Fatal: The DeltaChat Module couldn't be loaded. Please check if all dependencies for deltachat-core are installed!\",\n      error,\n      dcController.rpcServerPath\n    )\n    /* ignore-console-log */\n    console.error(\n      \"Fatal: The DeltaChat Module couldn't be loaded. Please check if all dependencies for deltachat-core are installed!\",\n      error,\n      dcController.rpcServerPath\n    )\n\n    dialog.showErrorBox(\n      'Fatal Error',\n      `The DeltaChat Module couldn't be loaded.\n  Please check if all dependencies for deltachat-core are installed!\n  The Log file is located in this folder: ${getLogsPath()}\\n\n  ${dcController.rpcServerPath}\\n\n  ${error instanceof Error ? error.message : inspect(error, { depth: null })}`\n    )\n\n    rawApp.exit(1)\n  }\n\n  ipcMain.once('ipcReady', _e => {\n    app.ipcReady = true\n    app.emit('ipcReady')\n  })\n\n  ipcMain.on('show', () => main.show())\n  // ipcMain.on('setAllowNav', (e, ...args) => menu.setAllowNav(...args))\n\n  ipcMain.on('handleLogMessage', (_e, channel, level, stacktrace, ...args) =>\n    logHandler.log(channel, level, stacktrace, ...args)\n  )\n\n  ipcMain.on('ondragstart', (event, filePath) => {\n    let icon: NativeImage\n    try {\n      icon = nativeImage.createFromPath(\n        join(htmlDistDir(), 'images/electron-file-drag-out.png')\n      )\n      if (icon.isEmpty()) {\n        throw new Error('load failed')\n      }\n    } catch (error) {\n      log.warn('drag out icon could not be loaded', error)\n      // create dummy black image\n      const size = 64 ** 2 * 4\n      const buffer = Buffer.alloc(size)\n      for (let i = 0; i < size; i += 4) {\n        buffer[i] = 0\n        buffer[i + 1] = 0\n        buffer[i + 2] = 0\n        buffer[i + 3] = 255\n      }\n      icon = nativeImage.createFromBitmap(buffer, { height: 64, width: 64 })\n    }\n\n    event.sender.startDrag({\n      file: filePath,\n      icon,\n    })\n  })\n\n  ipcMain.on('help', async (_ev, locale, anchor?: string) => {\n    await openHelpWindow(locale, anchor)\n  })\n\n  ipcMain.on('reload-main-window', () => {\n    if (!mainWindow.window) {\n      throw new Error('window does not exist, this should never happen')\n    }\n    mainWindow.window.webContents.reload()\n  })\n\n  ipcMain.on('get-log-path', ev => {\n    ev.returnValue = logHandler.logFilePath()\n  })\n\n  ipcMain.on('get-config-path', ev => {\n    ev.returnValue = getConfigPath().split(sep).join(posix.sep)\n  })\n\n  ipcMain.on('get-rc-config', ev => {\n    ev.returnValue = app.rc\n  })\n\n  ipcMain.on('get-runtime-info', ev => {\n    const info: RuntimeInfo = {\n      isMac: platform() === 'darwin',\n      isAppx: appx,\n      target: 'electron',\n      versions: [\n        { label: 'electron', value: versions.electron },\n        { label: 'node', value: versions.node },\n      ],\n      runningUnderARM64Translation: app.runningUnderARM64Translation,\n      rpcServerPath: dcController.rpcServerPath,\n      buildInfo: BuildInfo,\n      isContentProtectionSupported:\n        platform() === 'darwin' || platform() === 'win32',\n    }\n    ev.returnValue = info\n  })\n\n  ipcMain.on('app-get-path', (ev, arg) => {\n    ev.returnValue = app.getPath(arg)\n  })\n\n  /**\n   * https://www.electronjs.org/docs/latest/api/system-preferences#systempreferencesgetmediaaccessstatusmediatype-windows-macos\n   */\n  ipcMain.handle('checkMediaAccess', (_ev, mediaType: MediaType) => {\n    if (!systemPreferences.getMediaAccessStatus) {\n      return new Promise(resolve => {\n        resolve('unknown')\n      })\n    }\n    if (mediaType === 'camera') {\n      return systemPreferences.getMediaAccessStatus('camera')\n    } else if (mediaType === 'microphone') {\n      return systemPreferences.getMediaAccessStatus('microphone')\n    } else {\n      throw new Error('checkMediaAccess: unsupported media type')\n    }\n  })\n\n  /**\n   * https://www.electronjs.org/docs/latest/api/system-preferences#systempreferencesaskformediaaccessmediatype-macos\n   */\n  ipcMain.handle(\n    'askForMediaAccess',\n    (_ev, mediaType: MediaType): Promise<boolean | undefined> => {\n      if (systemPreferences.askForMediaAccess) {\n        if (mediaType === 'camera') {\n          return systemPreferences.askForMediaAccess('camera')\n        } else if (mediaType === 'microphone') {\n          return systemPreferences.askForMediaAccess('microphone')\n        }\n      }\n      return new Promise(resolve => {\n        resolve(undefined)\n      })\n    }\n  )\n\n  ipcMain.handle('fileChooser', async (_ev, options) => {\n    if (!mainWindow.window) {\n      throw new Error('window does not exist, this should never happen')\n    }\n    const returnValue = await dialog.showOpenDialog(mainWindow.window, options)\n    mainWindow.window.filePathWhiteList.push(...returnValue.filePaths)\n    return returnValue\n  })\n\n  let lastSaveDialogLocation: string | undefined = undefined\n  ipcMain.handle(\n    'saveFile',\n    async (_ev, pathToSource: string, filename: string) => {\n      if (!mainWindow.window) {\n        throw new Error('window does not exist, this should never happen')\n      }\n\n      let base_path = lastSaveDialogLocation || app.getPath('downloads')\n\n      if (!existsSync(base_path)) {\n        base_path = app.getPath('downloads')\n      }\n\n      const { canceled, filePath } = await dialog.showSaveDialog(\n        mainWindow.window,\n        {\n          defaultPath: join(base_path, filename),\n        }\n      )\n\n      if (!canceled && filePath) {\n        try {\n          await copyFile(pathToSource, filePath)\n        } catch (error: any) {\n          if (error.code == 'EACCES') {\n            dialog.showErrorBox(\n              'Permission Error',\n              `Cannot write in this folder. You don't have write permission`\n            )\n          } else {\n            dialog.showErrorBox(\n              'Unhandled Error',\n              `Cannot copy file. Error: ${error}`\n            )\n          }\n        }\n        lastSaveDialogLocation = path.dirname(filePath)\n      }\n    }\n  )\n\n  ipcMain.handle('get-desktop-settings', async _ev => {\n    return DesktopSettings.state\n  })\n\n  ipcMain.handle(\n    'set-desktop-setting',\n    (\n      _ev,\n      key: keyof DesktopSettingsType,\n      value: string | number | boolean | undefined\n    ) => {\n      DesktopSettings.update({ [key]: value })\n\n      if (key === 'minimizeToTray') {\n        updateTrayIcon()\n      } else if (key === 'contentProtectionEnabled') {\n        updateContentProtectionOnAllActiveWindows(Boolean(value))\n      }\n\n      return true\n    }\n  )\n\n  ipcMain.handle(\n    'app.setBadgeCountAndTrayIconIndicator',\n    (_, count: number) => {\n      app.setBadgeCount(count)\n      set_has_unread(count !== 0)\n    }\n  )\n\n  ipcMain.handle('app.writeTempFileFromBase64', (_ev, name, content) =>\n    writeTempFileFromBase64(name, content)\n  )\n  ipcMain.handle('app.writeTempFile', (_ev, name, content) =>\n    writeTempFile(name, content)\n  )\n  ipcMain.handle('app.copyFileToInternalTmpDir', (_ev, name, pathToFile) => {\n    return copyFileToInternalTmpDir(name, pathToFile)\n  })\n  ipcMain.handle('app.removeTempFile', (_ev, path) => removeTempFile(path))\n\n  ipcMain.handle('electron.shell.openExternal', (_ev, url) =>\n    shell.openExternal(url)\n  )\n  ipcMain.handle('electron.shell.openPath', (_ev, path) => {\n    // map sandbox path if on Windows\n    return shell.openPath(mapPackagePath(path))\n  })\n  ipcMain.handle('electron.clipboard.readText', () => {\n    return clipboard.readText()\n  })\n  ipcMain.handle('electron.clipboard.readImage', () => {\n    const image = clipboard.readImage()\n\n    // Electron just returns an empty base64 string (for example\n    // 'data:image/png;base64,' when no image was in the clipboard),\n    // we check that here and more conveniently return null instead\n    if (image.isEmpty()) {\n      return null\n    }\n\n    return image.toDataURL()\n  })\n  ipcMain.handle('electron.clipboard.writeText', (_ev, text) => {\n    return clipboard.writeText(text)\n  })\n  ipcMain.handle('electron.clipboard.writeImage', (_ev, path) => {\n    return clipboard.writeImage(nativeImage.createFromPath(path))\n  })\n\n  ipcMain.handle(\n    'saveBackgroundImage',\n    async (_ev, file: string, isDefaultPicture: boolean) => {\n      const originalFilePath = !isDefaultPicture\n        ? file\n        : join(htmlDistDir(), 'images/backgrounds/', file)\n\n      const bgDir = join(getConfigPath(), 'background')\n      await rm(bgDir, { recursive: true, force: true })\n      await mkdir(bgDir, { recursive: true })\n      const fileName = `background_${Date.now()}` + extname(originalFilePath)\n      const newPath = join(getConfigPath(), 'background', fileName)\n      try {\n        await copyFile(originalFilePath, newPath)\n      } catch (error) {\n        log.error('BG-IMG Copy Failed', error)\n        throw error\n      }\n      return `img: ${fileName.replace(/\\\\/g, '/')}`\n    }\n  )\n\n  ipcMain.handle(\n    'openMessageHTML',\n    async (\n      _ev,\n      accountId: number,\n      messageId: number,\n      isContactRequest: boolean,\n      subject: string,\n      sender: string,\n      receiveTime: string,\n      content: string\n    ) => {\n      openHtmlEmailWindow(\n        accountId,\n        messageId,\n        isContactRequest,\n        subject,\n        sender,\n        receiveTime,\n        content\n      )\n    }\n  )\n\n  return () => {\n    // the shutdown function\n    dcController.jsonrpcRemote.rpc.stopIoForAllAccounts()\n  }\n}\n\nexport async function writeTempFileFromBase64(\n  name: string,\n  content: string\n): Promise<string> {\n  await mkdir(getDraftTempDir(), { recursive: true })\n  const pathToFile = join(getDraftTempDir(), basename(name))\n  log.debug(`Writing base64 encoded file ${pathToFile}`)\n  await writeFile(pathToFile, Buffer.from(content, 'base64'), 'binary')\n  return pathToFile\n}\n\n/**\n * this function is only needed to temporarily\n * save a VCard to attach it to a draft message\n * should be removed once composer uses draft\n * message id and set_draft_vcard can be used\n * see https://github.com/deltachat/deltachat-core-rust/pull/5677\n */\nexport async function writeTempFile(\n  name: string,\n  content: string\n): Promise<string> {\n  await mkdir(getDraftTempDir(), { recursive: true })\n  const pathToFile = join(getDraftTempDir(), basename(name))\n  log.debug(`Writing tmp file ${pathToFile}`)\n  await writeFile(pathToFile, Buffer.from(content, 'utf8'), 'binary')\n  return pathToFile\n}\n\nexport async function copyFileToInternalTmpDir(\n  fileName: string,\n  sourcePath: string\n): Promise<string> {\n  const sourceFileName = basename(sourcePath)\n  const sourceDir = dirname(sourcePath)\n  // make sure fileName includes only a file name, no path or whatever\n  fileName = basename(normalize(fileName))\n  let destinationDir = join(sourceDir, '..', INTERNAL_TMP_DIR_NAME)\n  if (sourceFileName !== fileName) {\n    // this is the case, when we copy a file that has an identifier\n    //  as name (given during the file deduplications process)\n    destinationDir = join(destinationDir, sourceFileName)\n  }\n  await mkdir(destinationDir, { recursive: true })\n  const targetPath = join(destinationDir, fileName)\n  await copyFile(sourcePath, targetPath)\n  return targetPath\n}\n\nasync function removeTempFile(path: string) {\n  if (\n    path.indexOf(rawApp.getPath('temp')) === -1 ||\n    path.indexOf('..') !== -1\n  ) {\n    log.error(\n      'removeTempFile was called with a path that is outside of the temp dir: ',\n      path\n    )\n    throw new Error('Path is outside of the temp folder')\n  }\n  await rm(path)\n}\n", "import { BrowserWindow, Menu, shell } from 'electron'\nimport { join } from 'path'\nimport { stat } from 'fs/promises'\nimport { platform } from 'os'\n\nimport { appIcon, htmlDistDir } from '../application-constants.js'\nimport { getLogger } from '../../../shared/logger.js'\nimport { appWindowTitle } from '../../../shared/constants.js'\nimport { tx } from '../load-translations.js'\nimport { window as main_window } from './main.js'\nimport {\n  getAppMenu,\n  getFileMenu,\n  getHelpMenu,\n  refresh as refreshTitleMenu,\n} from '../menu.js'\nimport { initMinWinDimensionHandling } from './helpers.js'\nimport { setContentProtection } from '../content-protection.js'\n\nconst log = getLogger('main/help')\n\nasync function getHelpFileForLang(locale: string) {\n  const contentFilePath = join(htmlDistDir(), `help/${locale}/help.html`)\n  try {\n    if (!(await stat(join(contentFilePath))).isFile()) {\n      log.warn('contentFilePath not a file')\n      throw new Error('contentFilePath not a file')\n    }\n    return contentFilePath\n  } catch (error) {\n    log.warn(\n      `Did not find help file for language ${locale}, falling back to english`\n    )\n    return join(htmlDistDir(), `help/en/help.html`)\n  }\n}\n\nlet win: BrowserWindow | null = null\n\nexport async function openHelpWindow(locale: string, anchor?: string) {\n  if (win) {\n    win.focus()\n    if (anchor) {\n      win.webContents.executeJavaScript(`\n        document.getElementById(atob(\"${btoa(\n          anchor\n        )}\"))?.scrollIntoView({\"behavior\":\"smooth\"})\n      `)\n    }\n    return\n  }\n\n  log.debug('open help', locale)\n  const defaults = {\n    bounds: {\n      width: 500,\n      height: 638,\n    },\n    headerHeight: 36,\n    minWidth: 450,\n    minHeight: 450,\n  }\n  const help_window = (win = new BrowserWindow({\n    backgroundColor: '#282828',\n    darkTheme: true, // Forces dark theme (GTK+3)\n\n    icon: appIcon(),\n    show: false,\n    title: appWindowTitle + ' - ' + tx('menu_help'),\n    useContentSize: true, // Specify web page size without OS chrome\n\n    webPreferences: {\n      contextIsolation: true,\n      sandbox: true,\n      spellcheck: false,\n    },\n    alwaysOnTop: main_window?.isAlwaysOnTop(),\n  }))\n\n  setContentProtection(help_window)\n\n  const removeScreenChangeListeners = initMinWinDimensionHandling(\n    help_window,\n    defaults.minWidth,\n    defaults.minHeight\n  )\n\n  const url = await getHelpFileForLang(locale)\n\n  log.debug(url)\n\n  win.loadFile(url)\n\n  win.once('ready-to-show', async () => {\n    if (anchor) {\n      await help_window.webContents.executeJavaScript(`\n      document.getElementById(atob(\"${btoa(\n        anchor\n      )}\"))?.scrollIntoView({\"behavior\":\"instant\"})\n      `)\n    }\n    help_window.show()\n  })\n\n  if (win.setSheetOffset) {\n    win.setSheetOffset(defaults.headerHeight)\n  }\n\n  win.webContents.on('will-navigate', (_ev, url) => {\n    log.debug('open ', url)\n    shell.openExternal(url)\n  })\n\n  win.on('close', _e => {\n    win = null\n    removeScreenChangeListeners()\n  })\n\n  win.setMenu(Menu.buildFromTemplate([{ role: 'viewMenu' }]))\n\n  win.webContents.executeJavaScript(`\n    const body = document.getElementsByTagName('body')[0];\n    const back_btn = document.createElement('button');\n    back_btn.className = 'back-btn';\n    back_btn.onclick = (ev) => {document.body.scrollTop = 0; document.documentElement.scrollTop = 0;};\n    back_btn.innerText = '\u2191 ${tx('menu_scroll_to_top')}';\n    body.append(back_btn);\n  `)\n\n  // help does not need web permissions so deny all\n  win.webContents.session.setPermissionCheckHandler((_wc, _permission) => false)\n  win.webContents.session.setPermissionRequestHandler(\n    (_wc, _permission, callback) => callback(false)\n  )\n\n  const isMac = platform() === 'darwin'\n\n  // copied and adapted from webxdc menu\n  // TODO: would make sense to refactor these menus at some point\n  const makeMenu = () => {\n    return Menu.buildFromTemplate([\n      ...(isMac ? [getAppMenu(help_window)] : []),\n      getFileMenu(win, isMac),\n      {\n        label: tx('global_menu_edit_desktop'),\n        submenu: [\n          {\n            label: tx('global_menu_edit_copy_desktop'),\n            role: 'copy',\n          },\n          {\n            label: tx('menu_select_all'),\n            role: 'selectAll',\n          },\n        ],\n      },\n      {\n        label: tx('global_menu_view_desktop'),\n        submenu: [\n          { role: 'resetZoom' },\n          { role: 'zoomIn' },\n          { role: 'zoomOut' },\n          { type: 'separator' },\n          {\n            label: tx('global_menu_view_floatontop_desktop'),\n            type: 'checkbox',\n            checked: win?.isAlwaysOnTop(),\n            click: () => {\n              win?.setAlwaysOnTop(!win.isAlwaysOnTop())\n              if (isMac) {\n                win?.setMenu(makeMenu())\n              } else {\n                // change to window menu\n                Menu.setApplicationMenu(makeMenu())\n              }\n            },\n          },\n          { role: 'togglefullscreen' },\n        ],\n      },\n      getHelpMenu(isMac),\n    ])\n  }\n\n  if (!isMac) {\n    win.setMenu(makeMenu())\n  }\n\n  win.on('focus', () => {\n    if (isMac) {\n      // change to help menu\n      Menu.setApplicationMenu(makeMenu())\n    }\n  })\n  win.on('blur', () => {\n    if (isMac) {\n      // change back to main-window menu\n      refreshTitleMenu()\n    }\n  })\n}\n", "import electron, {\n  BrowserWindow,\n  dialog,\n  Menu,\n  MenuItem,\n  MenuItemConstructorOptions,\n  nativeTheme,\n  session,\n  shell,\n  WebContents,\n  WebContentsView,\n} from 'electron'\nimport { clipboard } from 'electron/common'\nimport { join } from 'path'\nimport { platform } from 'os'\n\nimport { appIcon, htmlDistDir } from '../application-constants.js'\nimport { DesktopSettings } from '../desktop_settings.js'\nimport { isInviteLink, truncateText } from '@deltachat-desktop/shared/util.js'\nimport { tx } from '../load-translations.js'\nimport { open_url } from '../open_url.js'\nimport { loadTheme } from '../themes.js'\nimport { getDCJsonrpcClient } from '../ipc.js'\nimport { getLogger } from '../../../shared/logger.js'\n\nimport * as mainWindow from './main.js'\nimport {\n  getAppMenu,\n  getFileMenu,\n  getHelpMenu,\n  refresh as refreshTitleMenu,\n} from '../menu.js'\nimport { initMinWinDimensionHandling } from './helpers.js'\nimport { setContentProtection } from '../content-protection.js'\n\nconst log = getLogger('html_email')\n\nconst open_windows: { [window_id: string]: BrowserWindow } = {}\n\n/**\n *\n * @param window_id that we know if it's already open, should be accountid+\"-\"+msgid\n * @param isContactRequest\n * @param subject\n * @param from\n * @param receiveTime\n * @param htmlEmail\n */\nexport function openHtmlEmailWindow(\n  account_id: number,\n  message_id: number,\n  isContactRequest: boolean,\n  subject: string,\n  from: string,\n  receiveTime: string,\n  htmlEmail: string\n) {\n  const window_id = `${account_id}.${message_id}`\n  if (open_windows[window_id]) {\n    // window already exists, focus it\n    open_windows[window_id].focus()\n    return\n  }\n  const initialBounds = DesktopSettings.state.HTMLEmailWindowBounds || {\n    height: 621,\n    width: 800,\n    x: undefined,\n    y: undefined,\n  }\n\n  const window = (open_windows[window_id] = new electron.BrowserWindow({\n    backgroundColor: '#282828',\n    // backgroundThrottling: false, // do not throttle animations/timers when page is background\n    darkTheme: true, // Forces dark theme (GTK+3)\n    icon: appIcon(),\n    show: false,\n    title: `${truncateText(subject, 42)} \u2013 ${truncateText(from, 40)}`,\n    height: initialBounds.height,\n    width: initialBounds.width,\n    x: initialBounds.x,\n    y: initialBounds.y,\n    webPreferences: {\n      nodeIntegration: false,\n      preload: join(\n        htmlDistDir(),\n        'electron_html_email_view/electron_html_email_view_preload.js'\n      ),\n      spellcheck: false,\n      webSecurity: true,\n      allowRunningInsecureContent: false,\n      contextIsolation: true,\n    },\n    alwaysOnTop: mainWindow?.isAlwaysOnTop(),\n  }))\n  window.webContents.setZoomFactor(DesktopSettings.state.zoomFactor)\n\n  setContentProtection(window)\n\n  const removeScreenChangeListeners = initMinWinDimensionHandling(\n    window,\n    400,\n    300\n  )\n\n  const loadRemoteContentAtStart =\n    DesktopSettings.state.HTMLEmailAlwaysLoadRemoteContent && !isContactRequest\n\n  window.webContents.ipc.handle('html_email:get_info', _ => ({\n    subject,\n    from,\n    receiveTime,\n    networkButtonLabelText: tx('load_remote_content'),\n    toggle_network: loadRemoteContentAtStart,\n  }))\n\n  nativeTheme.on('updated', () => {\n    try {\n      window.webContents.ipc.emit('theme-update')\n    } catch (error) {\n      /* ignore error */\n    }\n  })\n\n  window.webContents.ipc.handle(\n    'get-theme',\n    async () => (await loadTheme(DesktopSettings.state.activeTheme)).data\n  )\n\n  window.webContents.on('will-navigate', (e: electron.Event, _url: string) => {\n    // Prevent drag-and-drop from navigating the Electron window, which can happen\n    // before our drag-and-drop handlers have been initialized.\n    e.preventDefault()\n  })\n\n  window.once('ready-to-show', () => {\n    window.show()\n  })\n\n  window.on('close', () => {\n    context_menu_handle?.()\n    delete open_windows[window_id]\n    removeScreenChangeListeners()\n  })\n\n  const isMac = platform() === 'darwin'\n\n  // copied and adapted from webxdc menu\n  // TODO: would make sense to refactor these menus at some point\n  const makeMenu = () => {\n    return Menu.buildFromTemplate([\n      ...(isMac ? [getAppMenu(window)] : []),\n      getFileMenu(window, isMac),\n      {\n        label: tx('global_menu_edit_desktop'),\n        submenu: [\n          {\n            label: tx('global_menu_edit_copy_desktop'),\n            role: 'copy',\n          },\n          {\n            label: tx('menu_select_all'),\n            click: () => {\n              sandboxedView.webContents.focus()\n              sandboxedView.webContents.selectAll()\n            },\n            accelerator: isMac ? 'Cmd+A' : 'Ctrl+A',\n          },\n        ],\n      },\n      {\n        label: tx('global_menu_view_desktop'),\n        submenu: [\n          { role: 'resetZoom' },\n          { role: 'zoomIn' },\n          { role: 'zoomOut' },\n          { type: 'separator' },\n          {\n            label: tx('global_menu_view_floatontop_desktop'),\n            type: 'checkbox',\n            checked: window.isAlwaysOnTop(),\n            click: () => {\n              window.setAlwaysOnTop(!window.isAlwaysOnTop())\n              if (platform() !== 'darwin') {\n                window.setMenu(makeMenu())\n              } else {\n                // change to window menu\n                Menu.setApplicationMenu(makeMenu())\n              }\n            },\n          },\n          { role: 'togglefullscreen' },\n        ],\n      },\n      getHelpMenu(isMac),\n    ])\n  }\n\n  if (!isMac) {\n    window.setMenu(makeMenu())\n  }\n\n  window.on('focus', () => {\n    if (isMac) {\n      // change to email menu\n      Menu.setApplicationMenu(makeMenu())\n    }\n  })\n  window.on('blur', () => {\n    if (isMac) {\n      // change back to main-window menu\n      refreshTitleMenu()\n    }\n  })\n\n  let sandboxedView: WebContentsView = makeBrowserView(\n    account_id,\n    loadRemoteContentAtStart,\n    htmlEmail,\n    window\n  )\n  window.contentView.addChildView(sandboxedView)\n  sandboxedView.webContents.setZoomFactor(\n    DesktopSettings.state.zoomFactor *\n      Math.pow(1.2, window.webContents.getZoomLevel())\n  )\n  let context_menu_handle = createContextMenu(window, sandboxedView.webContents)\n\n  window.webContents.ipc.handle('html-view:more-menu', (_ev, { x, y }) => {\n    const menuItems: {\n      [key: string]: () => MenuItemConstructorOptions\n    } = {\n      separator: () => ({ type: 'separator' }),\n      always_show: () => ({\n        id: 'always_show',\n        type: 'checkbox',\n        label: tx('always_load_remote_images'),\n        checked: DesktopSettings.state.HTMLEmailAlwaysLoadRemoteContent,\n        click() {\n          const newValue =\n            !DesktopSettings.state.HTMLEmailAlwaysLoadRemoteContent\n          DesktopSettings.update({\n            HTMLEmailAlwaysLoadRemoteContent: newValue,\n          })\n          // apply change\n          update_restrictions(null, newValue, true)\n          window.webContents.executeJavaScript(\n            `document.getElementById('toggle_network').checked = window.network_enabled= ${Boolean(\n              newValue\n            )}`\n          )\n        },\n      }),\n      dont_ask: () => ({\n        id: 'show_warning',\n        type: 'checkbox',\n        label: tx('show_warning'),\n        checked: DesktopSettings.state.HTMLEmailAskForRemoteLoadingConfirmation,\n        click() {\n          DesktopSettings.update({\n            HTMLEmailAskForRemoteLoadingConfirmation:\n              !DesktopSettings.state.HTMLEmailAskForRemoteLoadingConfirmation,\n          })\n        },\n      }),\n    }\n    let menu: Electron.Menu\n    if (isContactRequest) {\n      menu = electron.Menu.buildFromTemplate([menuItems.dont_ask()])\n    } else {\n      menu = electron.Menu.buildFromTemplate([\n        menuItems.always_show(),\n        menuItems.dont_ask(),\n      ])\n    }\n    menu.popup({ window, x, y })\n  })\n\n  window.webContents.ipc.handle(\n    'html-view:resize-content',\n    (_ev, bounds: Electron.Rectangle) => {\n      const contentZoomFactor =\n        DesktopSettings.state.zoomFactor *\n        Math.pow(1.2, window.webContents.getZoomLevel())\n      const windowZoomFactor = window.webContents.getZoomFactor()\n\n      const window_bounds = window.getBounds()\n      const content_size = window.getContentSize()\n      const new_w = bounds.width * windowZoomFactor\n      const new_h = bounds.height * windowZoomFactor\n      const new_y = content_size[1] - new_h\n\n      sandboxedView?.setBounds({\n        x: bounds.x,\n        y: new_y,\n        width: new_w,\n        height: new_h,\n      })\n      sandboxedView?.webContents.setZoomFactor(contentZoomFactor)\n      DesktopSettings.update({ HTMLEmailWindowBounds: window_bounds })\n    }\n  )\n\n  window.on('moved', () => {\n    const window_bounds = window.getBounds()\n    DesktopSettings.update({ HTMLEmailWindowBounds: window_bounds })\n  })\n\n  const update_restrictions = async (\n    _ev: any,\n    allow_network: boolean,\n    skip_sideeffects = false\n  ) => {\n    if (\n      !skip_sideeffects &&\n      !isContactRequest &&\n      !allow_network &&\n      DesktopSettings.state.HTMLEmailAlwaysLoadRemoteContent\n    ) {\n      // revert always loading when turning the toggle switch\n      DesktopSettings.update({\n        HTMLEmailAlwaysLoadRemoteContent: false,\n      })\n    }\n\n    if (\n      !skip_sideeffects &&\n      allow_network &&\n      DesktopSettings.state.HTMLEmailAskForRemoteLoadingConfirmation\n    ) {\n      const buttons = [\n        {\n          label: tx('no'),\n          action: () => {\n            throw new Error('user denied')\n          },\n        },\n        { label: tx('yes'), action: () => {} },\n        // isContactRequest || {\n        //   label: tx('pref_html_always_load_remote_content'),\n        //   action: () => {\n        //     DesktopSettings.update({\n        //       HTMLEmailAlwaysLoadRemoteContent: true,\n        //     })\n        //   },\n        // },\n      ].filter(item => typeof item === 'object') as {\n        label: string\n        action: () => void\n      }[]\n\n      const result = await dialog.showMessageBox(window, {\n        message: tx('load_remote_content_ask'),\n        buttons: buttons.map(b => b.label),\n        type: 'none',\n        icon: '',\n        defaultId: 0,\n        cancelId: 0,\n      })\n      buttons[result.response].action()\n    }\n\n    const bounds = sandboxedView?.getBounds()\n    window.contentView.removeChildView(sandboxedView)\n    context_menu_handle()\n    sandboxedView.webContents.close()\n    sandboxedView = makeBrowserView(\n      account_id,\n      allow_network,\n      htmlEmail,\n      window\n    )\n    window.contentView.addChildView(sandboxedView)\n    context_menu_handle = createContextMenu(window, sandboxedView.webContents)\n    if (bounds) sandboxedView.setBounds(bounds)\n\n    // for debugging email\n    // sandboxedView.webContents.openDevTools({ mode: 'detach' })\n  }\n\n  window.webContents.ipc.handle('html-view:change-network', update_restrictions)\n\n  window.loadFile(\n    join(\n      htmlDistDir(),\n      'electron_html_email_view/electron_html_email_view.html'\n    )\n  )\n\n  // for debugging wrapper\n  // window.webContents.openDevTools({ mode: 'detach' })\n}\n\nconst CSP_DENY = `default-src 'none';\nfont-src 'self' data:;\nframe-src 'none';\nimg-src 'self' data:;\nmedia-src 'self' data:;\nstyle-src 'self' data: 'unsafe-inline';\nform-action 'none';\nscript-src 'none';`.replace(/\\n/g, '')\nconst CSP_ALLOW = `\ndefault-src 'none';\nfont-src 'self' data: http: https:;\nframe-src 'none';\nimg-src 'self' blob: data: https: http:;\nmedia-src 'self' data: http: https:;\nstyle-src 'self' 'unsafe-inline';\nform-action 'none';\nscript-src 'none';\n`.replace(/\\n/g, '')\n\nfunction makeBrowserView(\n  account_id: number,\n  allow_remote_content: boolean,\n  html_content: string,\n  window: BrowserWindow\n) {\n  const ses = session.fromPartition(`${Date.now()}`, { cache: false })\n\n  ses.setProxy({ mode: 'fixed_servers', proxyRules: 'not-existing-proxy:80' })\n  if (!allow_remote_content) {\n    // block network access\n    ses.protocol.handle('http', () => {\n      return new Response('', { status: 404 })\n    })\n    ses.protocol.handle('https', () => {\n      return new Response('', { status: 404 })\n    })\n  }\n\n  ses.protocol.handle('email', () => {\n    return new Response(Buffer.from(html_content), {\n      status: 200,\n      headers: {\n        'content-type': 'text/html; charset=utf-8',\n        'Content-Security-Policy': allow_remote_content ? CSP_ALLOW : CSP_DENY,\n      },\n    })\n  })\n\n  if (allow_remote_content) {\n    const callback = async (req: Request) => {\n      try {\n        const response = await getDCJsonrpcClient().getHttpResponse(\n          account_id,\n          req.url\n        )\n        const blob = Buffer.from(response.blob, 'base64')\n        return new Response(blob, {\n          status: 200,\n          headers: {\n            'Content-Security-Policy': CSP_ALLOW,\n            'Content-Type': `${response.mimetype}; ${response.encoding}`,\n          },\n        })\n      } catch (error) {\n        log.info('remote content failed to load', req.url, error)\n        return new Response(Buffer.from((error as any)?.message), {\n          status: 400,\n          headers: {\n            mimeType: 'text/plain',\n          },\n        })\n      }\n    }\n\n    ses.protocol.handle('http', callback)\n    ses.protocol.handle('https', callback)\n  }\n\n  const sandboxedView = new WebContentsView({\n    webPreferences: {\n      accessibleTitle: 'email content',\n      contextIsolation: true,\n      javascript: false,\n\n      disableDialogs: true,\n      webgl: false,\n      sandbox: true,\n      spellcheck: false,\n      session: ses,\n    },\n  })\n\n  sandboxedView.webContents.loadURL('email://index.html')\n  sandboxedView.webContents.insertCSS(`:root {\n      color: black;\n      background-color: white;\n    }`)\n\n  const openLink = (url: string) => {\n    if (url.startsWith('mailto:') || isInviteLink(url)) {\n      open_url(url)\n      mainWindow.window?.show()\n    } else {\n      if (url.startsWith('http:') || url.startsWith('https:')) {\n        shell.openExternal(url)\n      } else {\n        dialog\n          .showMessageBox(window, {\n            buttons: [tx('no'), tx('menu_copy_link_to_clipboard')],\n            message: tx('ask_copy_unopenable_link_to_clipboard', url),\n          })\n          .then(({ response }) => {\n            if (response == 1) {\n              clipboard.writeText(url)\n            }\n          })\n      }\n    }\n  }\n\n  sandboxedView.webContents.on(\n    'will-navigate',\n    (e: electron.Event, url: string) => {\n      // Prevent drag-and-drop from navigating the Electron window, which can happen\n      // before our drag-and-drop handlers have been initialized.\n      // Also handle clicking links inside of the message.\n      e.preventDefault()\n      const prefix = 'email://index.html'\n      if (url.startsWith(prefix)) {\n        let urlWithoutPrefix = url.slice(prefix.length)\n        if (url.slice(prefix.length)[0] == '/') {\n          urlWithoutPrefix = urlWithoutPrefix.slice(1)\n        }\n        if (urlWithoutPrefix.startsWith('#')) {\n          // double fragment issue workaround\n          // the issue is that when clicking on the same anchor multiple times,\n          // only the first time it jumps to it - the times after it just appends it to the url without jumping,\n          // might be an issue in electopn/chromium\n          // like this `email://index.html#anchor#anchor`\n          const lastFragment = urlWithoutPrefix.split('#').reverse()[0]\n          sandboxedView.webContents\n            .loadURL(`email://index.html/${Math.random()}/#${lastFragment}`)\n            .catch(log.error.bind(log, 'error'))\n          return\n        } else {\n          // assume it is a https weblink\n          return openLink('https://' + urlWithoutPrefix)\n        }\n      }\n      openLink(url)\n    }\n  )\n\n  sandboxedView.webContents.setWindowOpenHandler(details => {\n    openLink(details.url)\n    return { action: 'deny' }\n  })\n\n  return sandboxedView\n}\n\nconst createContextMenu = (win: BrowserWindow, webContents: WebContents) => {\n  const handleContextMenu = (\n    _event: any,\n    props: Electron.ContextMenuParams\n  ) => {\n    const { editFlags } = props\n    const hasText = props.selectionText.trim().length > 0\n\n    const menuItems = []\n\n    if (props.isEditable || hasText) {\n      menuItems.push(\n        new MenuItem({\n          id: 'copy',\n          label: tx('global_menu_edit_copy_desktop'),\n          enabled: editFlags.canCopy && hasText,\n          click() {\n            if (webContents) {\n              webContents.copy()\n            } else {\n              electron.clipboard.writeText(props.selectionText)\n            }\n          },\n        })\n      )\n    }\n\n    if (props.mediaType === 'image') {\n      if (menuItems.length) {\n        menuItems.push(new MenuItem({ type: 'separator' }))\n      }\n\n      menuItems.push(\n        new MenuItem({\n          id: 'copyImage',\n          label: tx('menu_copy_image_to_clipboard'),\n          click() {\n            webContents.copyImageAt(props.x, props.y)\n          },\n        })\n      )\n    }\n\n    if (props.linkURL.length !== 0 && props.mediaType === 'none') {\n      if (menuItems.length) {\n        menuItems.push(new MenuItem({ type: 'separator' }))\n      }\n\n      menuItems.push(\n        new MenuItem({\n          id: 'copyLink',\n          label: tx('menu_copy_link_to_clipboard'),\n          click() {\n            electron.clipboard.write({\n              bookmark: props.linkText,\n              text: props.linkURL,\n            })\n          },\n        })\n      )\n    }\n\n    if (menuItems.length) {\n      const menu = electron.Menu.buildFromTemplate(menuItems)\n\n      menu.popup({ window: win })\n    }\n  }\n  webContents.on('context-menu', handleContextMenu)\n  return () => {\n    if (win.isDestroyed()) {\n      return\n    }\n    webContents.removeListener('context-menu', handleContextMenu)\n  }\n}\n", "export function truncateText(text: string, max_len: number) {\n  if (text.length > max_len) {\n    return text.slice(0, max_len) + '\u2026'\n  } else {\n    return text\n  }\n}\n\n/**\n * @returns Whether the `url` is an invite link (for contact or a group).\n * - https://github.com/deltachat/invite\n * - https://github.com/deltachat/interface/blob/main/uri-schemes.md#invite-links-httpsideltachat-\n */\nexport function isInviteLink(url: string) {\n  return url.startsWith('https://i.delta.chat/') && url.includes('#')\n}\n\nexport function throttle<R, A extends any[]>(\n  fn: (...args: A) => R,\n  wait: number\n) {\n  let inThrottle: boolean,\n    timeout: ReturnType<typeof setTimeout>,\n    lastTime: number\n  const ret = (...args: A) => {\n    if (!inThrottle) {\n      fn(...args)\n      lastTime = performance.now()\n      inThrottle = true\n    } else {\n      clearTimeout(timeout)\n      timeout = setTimeout(\n        () => {\n          fn(...args)\n          lastTime = performance.now()\n        },\n        Math.max(wait - (performance.now() - lastTime), 0)\n      )\n    }\n  }\n  ret.cancel = () => {\n    clearTimeout(timeout)\n  }\n  return ret\n}\n", "import { app as rawApp, ipcMain } from 'electron'\nimport type { EventEmitter } from 'events'\nimport { readFile } from 'fs/promises'\nimport { basename } from 'path'\nimport { getLogger } from '../../shared/logger.js'\nimport { supportedURISchemes } from './application-constants.js'\nimport { showDeltaChat } from './tray.js'\nimport { ExtendedAppMainProcess } from './types.js'\nimport { send, window } from './windows/main.js'\nimport { platform } from 'os'\n\nconst log = getLogger('main/open_url')\nconst app = rawApp as ExtendedAppMainProcess\n\n// Define custom protocol handler. Deep linking works on packaged versions of the application!\n// These calls are for mac and windows, on linux it uses the desktop file.\nif (platform() !== 'linux') {\n  app.setAsDefaultProtocolClient('openpgp4fpr')\n  app.setAsDefaultProtocolClient('OPENPGP4FPR')\n  app.setAsDefaultProtocolClient('dcaccount')\n  app.setAsDefaultProtocolClient('DCACCOUNT')\n  app.setAsDefaultProtocolClient('dclogin')\n  app.setAsDefaultProtocolClient('DCLOGIN')\n  // do not forcefully set DC as standard email handler to not annoy users\n}\n\nlet frontend_ready = false\nipcMain.once('frontendReady', () => {\n  frontend_ready = true\n})\n\nfunction sendToFrontend(url: string) {\n  if (url.toUpperCase().startsWith('OPENPGP4FPR') && url.indexOf('#') === -1) {\n    // workaround until core can also work with it: https://github.com/deltachat/deltachat-core-rust/issues/1969\n    send('open-url', url.replace('%23', '#'))\n  } else {\n    send('open-url', url)\n  }\n}\n\nexport const open_url = function (url: string) {\n  log.info('open_url was called')\n  const sendOpenUrlEvent = () => {\n    log.info('open-url: Sending url to frontend.')\n    if (frontend_ready) {\n      sendToFrontend(url)\n    } else {\n      ipcMain.once('frontendReady', () => {\n        sendToFrontend(url)\n      })\n    }\n  }\n  log.debug('open-url: sending to frontend:', url)\n  if (app.ipcReady) return sendOpenUrlEvent()\n\n  log.debug('open-url: Waiting for ipc to be ready before opening url.')\n  ;(app as EventEmitter).once('ipcReady', () => {\n    log.debug('open-url: IPC ready.')\n    sendOpenUrlEvent()\n  })\n}\n\napp.on('open-url', (event, url) => {\n  log.info('open url event')\n  if (event) {\n    event.preventDefault()\n    app.focus()\n    window?.focus()\n  }\n  open_url(url)\n})\n\nasync function handleWebxdcFileOpen(path: string) {\n  log.info('open file', path)\n  if (!path.endsWith('.xdc')) {\n    log.info('handleWebxdcFileOpen, path does not contain .xdc', path)\n    return\n  }\n  app.focus()\n  window?.focus()\n\n  // hacky code - abuses webxdc sendToChat\n  // todo make this code nicer and maybe show even a custom dialog that shows what is being sent?\n  const buffer = await readFile(path)\n  if (!app.ipcReady) {\n    await new Promise(res => (app as any).once('ipcReady', res))\n  }\n  if (!frontend_ready) {\n    await new Promise(res => ipcMain.once('frontendReady', res))\n  }\n  window?.webContents.send(\n    'webxdc.sendToChat',\n    { file_name: basename(path), file_content: buffer.toString('base64') },\n    null\n  )\n}\n\napp.on('open-file', async (event, path) => {\n  if (event) {\n    event.preventDefault()\n  }\n  handleWebxdcFileOpen(path)\n})\n\n// Iterate over arguments and look out for uris and webxdc file paths\nexport function openUrlsAndFilesFromArgv(argv: string[]) {\n  args_loop: for (let i = 1; i < argv.length; i++) {\n    const arg = argv[i]\n\n    if (arg.endsWith('.xdc')) {\n      log.debug(\n        'open-url: process something that looks like it could be a webxc file:',\n        arg\n      )\n      handleWebxdcFileOpen(arg)\n      continue\n    }\n\n    if (!arg.includes(':')) {\n      continue\n    }\n\n    log.debug(\n      'open-url: process something that looks like it could be a scheme:',\n      arg\n    )\n    for (const expectedScheme of supportedURISchemes) {\n      if (\n        arg.startsWith(expectedScheme.toUpperCase()) ||\n        arg.startsWith(expectedScheme.toLowerCase())\n      ) {\n        log.debug('open-url: Detected URI: ', arg)\n        open_url(arg)\n        continue args_loop\n      }\n    }\n  }\n}\n\napp.on('second-instance', (_event, argv) => {\n  log.debug('Someone tried to run a second instance')\n  openUrlsAndFilesFromArgv(argv)\n  // open file from argv\n  if (window) {\n    showDeltaChat()\n  }\n})\n", "import { existsSync, watchFile } from 'fs'\nimport { readFile, readdir } from 'fs/promises'\nimport { join, basename } from 'path'\nimport { app as rawApp, ipcMain, nativeTheme } from 'electron'\n\nimport { getCustomThemesPath, htmlDistDir } from './application-constants.js'\nimport { ExtendedAppMainProcess } from './types.js'\nimport * as mainWindow from './windows/main.js'\nimport { getLogger } from '../../shared/logger.js'\nimport { DesktopSettings } from './desktop_settings.js'\n\nimport { Theme } from '@deltachat-desktop/shared/shared-types.js'\nimport {\n  HIDDEN_THEME_PREFIX,\n  parseThemeMetaData,\n} from '@deltachat-desktop/shared/themes'\n\nconst app = rawApp as ExtendedAppMainProcess\n\nconst log = getLogger('main/themes')\n\nconst dc_theme_dir = join(htmlDistDir(), 'themes')\n\nasync function readThemeDir(path: string, prefix: string): Promise<Theme[]> {\n  const files = await readdir(path)\n  return Promise.all(\n    files\n      .filter(f => f.endsWith('.css') && f.charAt(0) !== '_')\n      .map(async f => {\n        const address = prefix + ':' + basename(f, '.css')\n        const file_content = await readFile(join(path, f), 'utf-8')\n        try {\n          const theme_meta = parseThemeMetaData(file_content)\n          return {\n            name: theme_meta.name,\n            description: theme_meta.description,\n            address,\n            is_prototype: f.startsWith(HIDDEN_THEME_PREFIX),\n          }\n        } catch (error) {\n          log.error('Error while parsing theme ${address}: ', error)\n          return {\n            name: address + ' [Invalid Meta]',\n            description: '[missing description]',\n            address: prefix + ':' + basename(f, '.css'),\n            is_prototype: f.startsWith(HIDDEN_THEME_PREFIX),\n          }\n        }\n      })\n  )\n}\n\nexport async function getAvailableThemes(): Promise<Theme[]> {\n  // look at the common places for themes\n  return [\n    ...(await readThemeDir(dc_theme_dir, 'dc')),\n    ...(await readThemeDir(getCustomThemesPath(), 'custom')),\n  ]\n}\n\nexport async function loadTheme(\n  theme_address: string\n): Promise<{ theme: Theme; data: string }> {\n  // load theme file\n  const effective_path = resolveThemeAddress(theme_address)\n  log.debug('load theme file', theme_address, effective_path)\n  const themedata = await readFile(effective_path, 'utf-8')\n\n  log.debug('render theme data')\n  const theme_meta = parseThemeMetaData(themedata)\n  log.debug('render theme data for theme:', theme_meta)\n  return {\n    theme: {\n      name: theme_meta.name,\n      description: theme_meta.description,\n      address: theme_address,\n      is_prototype: basename(effective_path).startsWith(HIDDEN_THEME_PREFIX),\n    },\n    data: themedata,\n  }\n}\n\nfunction systemDefault() {\n  if (nativeTheme.shouldUseDarkColors) {\n    return ['dc', 'dark']\n  } else {\n    return ['dc', 'light']\n  }\n}\n\nexport function resolveThemeAddress(address: string): string {\n  const addressParts =\n    address != 'system' ? address.split(':') : systemDefault()\n  let realPath = ''\n  if (addressParts.length != 2)\n    throw 'not an theme address, must have the format [location]:[themename]'\n  if (addressParts[0] == 'dc') {\n    realPath = `${dc_theme_dir}`\n  } else if (addressParts[0] == 'custom') {\n    realPath = getCustomThemesPath()\n  } else {\n    throw 'unknown \"location\", valid locations are dc or custom'\n  }\n  const result = join(\n    realPath,\n    addressParts[1].replace(/\\/|\\\\|\\.\\./g, '') + '.css'\n  )\n\n  if (existsSync(result)) {\n    return result\n  } else {\n    throw 'theme ' + address + ' not found at: ' + result\n  }\n}\n\nexport function acceptThemeCLI() {\n  if (app.rc['theme']) {\n    log.info(`trying to load theme from '${app.rc['theme']}'`)\n    try {\n      resolveThemeAddress(app.rc['theme'])\n    } catch (error) {\n      log.error('THEME NOT FOUND', { error, path: app.rc['theme'] })\n      throw new Error(\n        `THEME \"${app.rc['theme']}\" NOT FOUND,\nthis is fatal because the user specified it via cli argument.\nIf you did not specify this, ask the person which installed deltachat for you to remove the cli argument again.\n\nIf they are not available find the shortcut/.desktop file yourself and edit it to not contain the \"--theme\" argument.\nUsing --theme is for developers and theme creators ONLY and should not be used by normal users\nIf you have question or need help, feel free to ask in our forum https://support.delta.chat.`\n      )\n    }\n    DesktopSettings.update({ activeTheme: app.rc['theme'] })\n    log.info(`set theme`)\n    if (app.rc['theme-watch']) {\n      log.info('theme-watch: activated', app.rc['theme-watch'])\n      watchFile(resolveThemeAddress(app.rc['theme']), (curr, prev) => {\n        if (curr.mtime !== prev.mtime) {\n          log.info(\n            'theme-watch: File changed reminding frontend to reload theme'\n          )\n          app.ipcReady && mainWindow.send('theme-update')\n        }\n      })\n    }\n  }\n  nativeTheme.on('updated', () => {\n    mainWindow.send('theme-update')\n  })\n}\n\nipcMain.handle('themes.getActiveTheme', async () => {\n  try {\n    log.debug('theme', DesktopSettings.state.activeTheme)\n    return await loadTheme(DesktopSettings.state.activeTheme)\n  } catch (error) {\n    log.error('loading theme failed:', error)\n    return null\n  }\n})\n\nipcMain.handle('themes.getAvailableThemes', getAvailableThemes)\n", "export function parseThemeMetaData(rawTheme: string): {\n  name: string\n  description: string\n} {\n  const meta_data_block =\n    /.theme-meta ?{([^]*)}/gm.exec(rawTheme)?.[1].trim() || ''\n\n  const regex = /--(\\w*): ?['\"]([^]*?)['\"];?/gi\n\n  const meta: { [key: string]: string } = {}\n\n  let last_result: any = true\n\n  while (last_result) {\n    last_result = regex.exec(meta_data_block)\n    if (last_result) {\n      meta[last_result[1]] = last_result[2]\n    }\n  }\n\n  // check if name and description are defined\n  if (!meta.name || !meta.description) {\n    throw new Error(\n      'The meta variables meta.name and meta.description must be defined'\n    )\n  }\n\n  return <any>meta\n}\n\nexport const HIDDEN_THEME_PREFIX = 'dev_'\n", "import { app as rawApp, ipcMain } from 'electron'\nimport { EventEmitter } from 'events'\nimport { yerpc, BaseDeltaChat } from '@deltachat/jsonrpc-client'\nimport { getRPCServerPath } from '@deltachat/stdio-rpc-server'\n\nimport { getLogger } from '../../../shared/logger.js'\nimport * as mainWindow from '../windows/main.js'\nimport { ExtendedAppMainProcess } from '../types.js'\nimport DCWebxdc from './webxdc.js'\nimport { DesktopSettings } from '../desktop_settings.js'\nimport { StdioServer } from './stdio_server.js'\nimport rc_config from '../rc.js'\nimport { migrateAccountsIfNeeded } from './migration.js'\n\nconst app = rawApp as ExtendedAppMainProcess\nconst log = getLogger('main/deltachat')\nconst logCoreEvent = getLogger('core/event')\n\nclass ElectronMainTransport extends yerpc.BaseTransport {\n  constructor(private sender: (message: yerpc.Message) => void) {\n    super()\n  }\n\n  onMessage(message: yerpc.Message): void {\n    this._onmessage(message)\n  }\n\n  _send(message: yerpc.Message): void {\n    this.sender(message)\n  }\n}\n\nexport class JRPCDeltaChat extends BaseDeltaChat<ElectronMainTransport> {}\n\n/**\n * DeltaChatController\n *\n * - proxy for a deltachat instance\n * - sends events to renderer\n * - handles events from renderer\n */\nexport default class DeltaChatController extends EventEmitter {\n  /**\n   * Created and owned by ipc on the backend\n   */\n\n  _inner_account_manager: StdioServer | null = null\n  get account_manager(): Readonly<StdioServer> {\n    if (!this._inner_account_manager) {\n      throw new Error('account manager is not defined (yet?)')\n    }\n    return this._inner_account_manager\n  }\n  /** for runtime info */\n  rpcServerPath?: string\n\n  constructor(public cwd: string) {\n    super()\n  }\n\n  _jsonrpcRemote: JRPCDeltaChat | null = null\n  get jsonrpcRemote(): Readonly<JRPCDeltaChat> {\n    if (!this._jsonrpcRemote) {\n      throw new Error('_jsonrpcRemote is not defined (yet?)')\n    }\n    return this._jsonrpcRemote\n  }\n\n  async init() {\n    log.debug('Check if legacy accounts need migration')\n    if (await migrateAccountsIfNeeded(this.cwd, getLogger('migration'))) {\n      // Clear some settings that we can't migrate\n      DesktopSettings.update({\n        lastAccount: undefined,\n        lastChats: {},\n        lastSaveDialogLocation: undefined,\n      })\n    }\n\n    log.debug('Initiating DeltaChatNode')\n    let serverPath = await getRPCServerPath({\n      // desktop should only use prebuilds normally\n      disableEnvPath: !rc_config['allow-unsafe-core-replacement'],\n    })\n    if (serverPath.includes('app.asar')) {\n      // probably inside of electron build\n      serverPath = serverPath.replace('app.asar', 'app.asar.unpacked')\n    }\n\n    this.rpcServerPath = serverPath\n    log.info('using deltachat-rpc-server at', { serverPath })\n\n    this._inner_account_manager = new StdioServer(\n      response => {\n        try {\n          if (response.indexOf('\"id\":\"main-') !== -1) {\n            const message = JSON.parse(response)\n            if (message.id.startsWith('main-')) {\n              message.id = Number(message.id.replace('main-', ''))\n              mainProcessTransport.onMessage(message)\n              return\n            }\n          }\n        } catch (error) {\n          log.error('jsonrpc-decode', error)\n        }\n        mainWindow.send('json-rpc-message', response)\n        if (response.indexOf('event') !== -1)\n          try {\n            const { result } = JSON.parse(response)\n            const { contextId, event } = result\n            if (\n              contextId !== undefined &&\n              typeof event === 'object' &&\n              event.kind\n            ) {\n              if (event.kind === 'WebxdcRealtimeData') {\n                return\n              }\n              if (event.kind === 'Warning') {\n                logCoreEvent.warn(contextId, event.msg)\n              } else if (event.kind === 'Info') {\n                logCoreEvent.info(contextId, event.msg)\n              } else if (event.kind.startsWith('Error')) {\n                logCoreEvent.error(contextId, event.msg)\n              } else if (app.rc['log-debug']) {\n                // in debug mode log all core events\n                const event_clone = Object.assign({}, event) as Partial<\n                  typeof event\n                >\n                delete event_clone.kind\n                logCoreEvent.debug(contextId, event.kind, event)\n              }\n            }\n          } catch (error) {\n            // ignore json parse errors\n            return\n          }\n      },\n      this.cwd,\n      serverPath\n    )\n\n    this.account_manager.start()\n    log.info('HI')\n\n    //todo? multiple instances, accounts is always writable\n\n    const mainProcessTransport = new ElectronMainTransport(message => {\n      message.id = `main-${message.id}`\n      this.account_manager.send(JSON.stringify(message))\n    })\n\n    ipcMain.handle('json-rpc-request', (_ev, message) => {\n      this.account_manager.send(message)\n    })\n\n    this._jsonrpcRemote = new JRPCDeltaChat(mainProcessTransport, false)\n\n    if (DesktopSettings.state.syncAllAccounts) {\n      log.info('Ready, starting accounts io...')\n      this.jsonrpcRemote.rpc.startIoForAllAccounts()\n      log.info('Started accounts io.')\n    }\n    for (const account of await this.jsonrpcRemote.rpc.getAllAccountIds()) {\n      this.jsonrpcRemote.rpc.setConfig(\n        account,\n        'verified_one_on_one_chats',\n        '1'\n      )\n    }\n  }\n\n  readonly webxdc = new DCWebxdc(this)\n}\n", "import {\n  app,\n  BrowserWindow,\n  protocol,\n  ipcMain,\n  session,\n  screen,\n} from 'electron/main'\nimport Mime from 'mime-types'\nimport {\n  Menu,\n  nativeImage,\n  shell,\n  MenuItemConstructorOptions,\n  dialog,\n  clipboard,\n  IpcMainInvokeEvent,\n} from 'electron'\nimport { join, dirname } from 'path'\nimport { fileURLToPath } from 'url'\nimport { platform } from 'os'\nimport { readdir, stat, rmdir, writeFile, readFile } from 'fs/promises'\nimport { existsSync } from 'fs'\nimport type DeltaChatController from './controller.js'\nimport { getLogger } from '../../../shared/logger.js'\nimport { getConfigPath, htmlDistDir } from '../application-constants.js'\nimport { truncateText } from '@deltachat-desktop/shared/util.js'\nimport { tx } from '../load-translations.js'\nimport { Bounds, DcOpenWebxdcParameters } from '../../../shared/shared-types.js'\nimport { DesktopSettings } from '../desktop_settings.js'\nimport { window as main_window } from '../windows/main.js'\nimport { writeTempFileFromBase64 } from '../ipc.js'\nimport {\n  getAppMenu,\n  getEditMenu,\n  getFileMenu,\n  refresh as refreshTitleMenu,\n} from '../menu.js'\nimport { T } from '@deltachat/jsonrpc-client'\nimport type * as Jsonrpc from '@deltachat/jsonrpc-client'\nimport { setContentProtection } from '../content-protection.js'\n\nconst __dirname = dirname(fileURLToPath(import.meta.url))\n\nconst log = getLogger('main/deltachat/webxdc')\n\ntype AppInstance = {\n  win: BrowserWindow\n  msgId: number\n  accountId: number\n  internet_access: boolean\n  selfAddr: string\n  displayName: string\n  sendUpdateInterval: number\n  sendUpdateMaxSize: number\n}\nconst open_apps: {\n  [instanceId: string]: AppInstance\n} = {}\n\n// holds all accounts which have a session with webxdc scheme registered\nconst accounts_sessions: number[] = []\n\n// TODO:\n// 2. on message deletion close webxdc if open and remove its DOMStorage data\n\nconst CSP =\n  \"default-src 'self';\\\n  style-src 'self' 'unsafe-inline' blob: ;\\\n  font-src 'self' data: blob: ;\\\n  script-src 'self' 'unsafe-inline' 'unsafe-eval' blob: ;\\\n  connect-src 'self' data: blob: ;\\\n  img-src 'self' data: blob: ;\\\n  media-src 'self' data: blob: ;\\\n  webrtc 'block'\"\n\n/**\n * Allowed permissions for webxdc applications.\n * https://www.electronjs.org/docs/latest/api/session#sessetpermissioncheckhandlerhandler\n * https://www.electronjs.org/docs/latest/api/session#sessetpermissionrequesthandlerhandler\n */\nconst ALLOWED_PERMISSIONS: string[] = [\n  // Games might lock the pointer\n  'pointerLock',\n  // Games might do that too\n  'fullscreen',\n]\n\nconst WRAPPER_PATH = 'webxdc-wrapper.45870014933640136498.html'\n\nconst BOUNDS_UI_CONFIG_PREFIX = 'ui.desktop.webxdcBounds'\n\ntype Size = { width: number; height: number }\n\nconst DEFAULT_SIZE_WEBXDC: Size = {\n  width: 375,\n  height: 667,\n}\nconst DEFAULT_SIZE_MAP: Size = {\n  width: 1000,\n  height: 800,\n}\n\nexport default class DCWebxdc {\n  constructor(private readonly controller: DeltaChatController) {\n    // icon protocol\n    app.whenReady().then(() => {\n      protocol.handle('webxdc-icon', async request => {\n        const [a, m] = request.url.substring(12).split('.')\n        const [accountId, messageId] = [Number(a), Number(m)]\n        try {\n          const { icon } = await this.rpc.getWebxdcInfo(accountId, messageId)\n          const blob = Buffer.from(\n            await this.rpc.getWebxdcBlob(accountId, messageId, icon),\n            'base64'\n          )\n          return new Response(blob, {\n            headers: { 'content-type': Mime.lookup(icon) || '' },\n          })\n        } catch (error) {\n          log.error('failed to load webxdc icon for:', error)\n          return new Response('', { status: 404 })\n        }\n      })\n    })\n\n    /**\n     * ipcMain handler for 'open-webxdc' event invoked by the renderer\n     */\n    const openWebxdc = async (\n      _ev: IpcMainInvokeEvent,\n      msg_id: number,\n      p: DcOpenWebxdcParameters,\n      defaultSize: Size = DEFAULT_SIZE_WEBXDC\n    ) => {\n      const { webxdcInfo, chatName, accountId, href } = p\n      let base64EncodedHref = ''\n      const appURL = `webxdc://${accountId}.${msg_id}.webxdc`\n      if (href && href !== '') {\n        // href is user provided content, so we want to be sure it's relative\n        // relative href needs a base to construct URL\n        const url = new URL(href, 'http://dummy')\n        const relativeUrl = url.pathname + url.search + url.hash\n        // make href eval safe\n        base64EncodedHref = Buffer.from(appURL + relativeUrl).toString('base64')\n      }\n      if (open_apps[`${accountId}.${msg_id}`]) {\n        log.warn(\n          'webxdc instance for this app is already open, trying to focus it',\n          { msg_id }\n        )\n        const window = open_apps[`${accountId}.${msg_id}`].win\n        if (window.isMinimized()) {\n          window.restore()\n        }\n        if (base64EncodedHref !== '') {\n          // passed from a WebxdcInfoMessage\n          window.webContents.executeJavaScript(\n            `window.webxdc_internal.setLocationUrl(\"${base64EncodedHref}\")`\n          )\n        }\n        window.focus()\n        return\n      }\n\n      log.info('opening new webxdc instance', { msg_id })\n\n      const icon = webxdcInfo.icon\n      const icon_blob = Buffer.from(\n        await this.rpc.getWebxdcBlob(accountId, msg_id, icon),\n        'base64'\n      )\n\n      // TODO intercept / deny network access - CSP should probably be disabled for testing\n\n      if (!accounts_sessions.includes(accountId)) {\n        const ses = sessionFromAccountId(accountId)\n        accounts_sessions.push(accountId)\n        ses.protocol.handle('webxdc', (...args) =>\n          webxdcProtocolHandler(this.rpc, ...args)\n        )\n      }\n\n      const app_icon = icon_blob && nativeImage?.createFromBuffer(icon_blob)\n\n      const webxdcWindow = new BrowserWindow({\n        webPreferences: {\n          partition: partitionFromAccountId(accountId),\n          sandbox: true,\n          contextIsolation: true,\n          webSecurity: true,\n          nodeIntegration: false,\n          navigateOnDragDrop: false,\n          devTools: DesktopSettings.state.enableWebxdcDevTools,\n          javascript: true,\n          preload: join(htmlDistDir(), 'webxdc-preload.js'),\n        },\n        title: makeTitle(webxdcInfo, chatName),\n        icon: app_icon || undefined,\n        alwaysOnTop: main_window?.isAlwaysOnTop(),\n        show: false,\n      })\n      setContentProtection(webxdcWindow)\n\n      // reposition the window to last position (or default)\n      const lastBounds: Bounds | null = await this.getLastBounds(\n        accountId,\n        msg_id\n      )\n      const size: Size = adjustSize(lastBounds || defaultSize)\n      const bounds: Partial<Bounds> = { ...(lastBounds || {}), ...size }\n      webxdcWindow.setBounds(bounds, true)\n\n      // show after repositioning to avoid blinking\n      webxdcWindow.show()\n      open_apps[`${accountId}.${msg_id}`] = {\n        win: webxdcWindow,\n        accountId,\n        msgId: msg_id,\n        internet_access: webxdcInfo['internetAccess'],\n        selfAddr: webxdcInfo.selfAddr || 'unknown@unknown',\n        displayName: p.displayname || webxdcInfo.selfAddr || 'unknown',\n        sendUpdateInterval: webxdcInfo.sendUpdateInterval,\n        sendUpdateMaxSize: webxdcInfo.sendUpdateMaxSize,\n      }\n\n      const isMac = platform() === 'darwin'\n\n      const makeMenu = () => {\n        return Menu.buildFromTemplate([\n          ...(isMac ? [getAppMenu(webxdcWindow)] : []),\n          getFileMenu(webxdcWindow, isMac),\n          getEditMenu(),\n          {\n            label: tx('global_menu_view_desktop'),\n            submenu: [\n              ...(DesktopSettings.state.enableWebxdcDevTools\n                ? [\n                    {\n                      label: tx('global_menu_view_developer_tools_desktop'),\n                      role: 'toggleDevTools',\n                    } as MenuItemConstructorOptions,\n                  ]\n                : []),\n              { type: 'separator' },\n              { role: 'resetZoom' },\n              { role: 'zoomIn' },\n              { role: 'zoomOut' },\n              { type: 'separator' },\n              {\n                label: tx('global_menu_view_floatontop_desktop'),\n                type: 'checkbox',\n                checked: webxdcWindow.isAlwaysOnTop(),\n                click: () => {\n                  webxdcWindow.setAlwaysOnTop(!webxdcWindow.isAlwaysOnTop())\n                  if (platform() !== 'darwin') {\n                    webxdcWindow.setMenu(makeMenu())\n                  } else {\n                    // change to webxdc menu\n                    Menu.setApplicationMenu(makeMenu())\n                  }\n                },\n              },\n              { role: 'togglefullscreen' },\n            ],\n          },\n          {\n            label: tx('menu_help'),\n            submenu: [\n              {\n                label: tx('source_code'),\n                enabled: !!webxdcInfo.sourceCodeUrl,\n                icon: app_icon?.resize({ width: 24 }) || undefined,\n                click: () => {\n                  if (\n                    webxdcInfo.sourceCodeUrl?.startsWith('https:') ||\n                    webxdcInfo.sourceCodeUrl?.startsWith('http:')\n                  ) {\n                    shell.openExternal(webxdcInfo.sourceCodeUrl)\n                  } else if (webxdcInfo.sourceCodeUrl) {\n                    const url = webxdcInfo.sourceCodeUrl\n                    dialog\n                      .showMessageBox(webxdcWindow, {\n                        buttons: [tx('no'), tx('menu_copy_link_to_clipboard')],\n                        message: tx(\n                          'ask_copy_unopenable_link_to_clipboard',\n                          url\n                        ),\n                      })\n                      .then(({ response }) => {\n                        if (response == 1) {\n                          clipboard.writeText(url)\n                        }\n                      })\n                  }\n                },\n              },\n              {\n                type: 'separator',\n              },\n              {\n                label: tx('what_is_webxdc'),\n                click: () => shell.openExternal('https://webxdc.org'),\n              },\n            ],\n          },\n        ])\n      }\n\n      if (!isMac) {\n        webxdcWindow.setMenu(makeMenu())\n      }\n\n      webxdcWindow.on('focus', () => {\n        if (isMac) {\n          // change to webxdc menu\n          Menu.setApplicationMenu(makeMenu())\n        }\n      })\n      webxdcWindow.on('blur', () => {\n        if (isMac) {\n          // change back to main-window menu\n          refreshTitleMenu()\n        }\n      })\n\n      webxdcWindow.once('closed', () => {\n        delete open_apps[`${accountId}.${msg_id}`]\n      })\n\n      webxdcWindow.once('close', () => {\n        const lastBounds = webxdcWindow.getBounds()\n        this.setLastBounds(accountId, msg_id, lastBounds)\n      })\n\n      webxdcWindow.once('ready-to-show', () => {\n        if (base64EncodedHref !== '') {\n          // passed from a WebxdcInfoMessage\n          webxdcWindow.webContents.executeJavaScript(\n            `window.webxdc_internal.setLocationUrl(\"${base64EncodedHref}\")`\n          )\n        }\n      })\n\n      webxdcWindow.webContents.loadURL(appURL + '/' + WRAPPER_PATH, {\n        extraHeaders: 'Content-Security-Policy: ' + CSP,\n      })\n\n      // prevent reload and navigation of wrapper page\n      webxdcWindow.webContents.on('will-navigate', ev => {\n        ev.preventDefault()\n      })\n\n      let denyPreventUnload = false\n      // Otherwise the app can make itself uncloseable.\n      // See https://github.com/deltachat/deltachat-desktop/issues/4726\n      // The code is taken from\n      // https://www.electronjs.org/docs/latest/api/web-contents#event-will-prevent-unload\n      webxdcWindow.webContents.on('will-prevent-unload', ev => {\n        if (denyPreventUnload) {\n          ev.preventDefault()\n        }\n        // This `setTimeout` is a workaround for the fact\n        // that some webxdc apps, as a result of\n        // https://github.com/deltachat/deltachat-desktop/issues/3321,\n        // came to rely on `beforeunload` in a not so nice way:\n        // They `preventDefault()` the `beforeunload` event,\n        // and `setTimeout(() => window.close())`,\n        // which is supposed to simply delay the closing of the window.\n        // See e.g. this code, which, in turn, is used by the Editor app.\n        // https://codeberg.org/webxdc/y-webxdc/src/commit/0b3cfe1196b1e4c1af4a14fc82b818310e4a67b3/index.mjs#L72-L96\n        // While that code used to work fine back in the day,\n        // with the introduction of this `will-prevent-unload` listener\n        // things changed: now Delta Chat works more similarly\n        // to actual browsers, i.e. it will pop up this \"confirm close\"\n        // dialog. But while the dialog is open,\n        // the app is not able to execute any code,\n        // thus it cannot close itself and the dialog, which results\n        // in the user always having to interact with the dialog.\n        //\n        // So, what we do with the `setTimeout` is we let the app\n        // close itself first, after it cancels the initial `beforeunload`.\n        //\n        // webxdc apps should stop using that hack, then we can remove\n        // this `setTimeout` (revert the commit that introduced it).\n        // Instead (besides us fixing the actual bug with `visibilitychange`),\n        // apps should `window.top.addEventListener('visibilitychange'...`\n        // (note the `.top`) instead of attaching the listener to just `window`.\n        // See\n        // https://github.com/deltachat/deltachat-desktop/issues/3321#issuecomment-1821024467.\n        setTimeout(() => {\n          if (webxdcWindow.isDestroyed()) {\n            return\n          }\n\n          // Note that this will block this (main!) thread\n          // until the user has closed the dialog.\n          // The main app will be unresponsive until then,\n          // which is probably not nice in case e.g. the user pressed \"close\"\n          // on the webxdc app, but then left their PC\n          // without interacting with the dialog.\n          // However, this is pretty much in line with what regular browsers do,\n          // except they also don't let you interact\n          // with the rest of the browser until you close the dialog.\n          //\n          // We could use the async version (`showMessageBox()`),\n          // but this would let the app execute its code.\n          // If the app is actually malicious, it could try to do nasty stuff,\n          // e.g. something like preventing the user from interacting\n          // with the dialog, by entering fullscreen or something.\n          // So, let's probably just stay in line with regular browsers.\n          const choice = dialog.showMessageBoxSync(webxdcWindow, {\n            type: 'question',\n            // Chromium shows \"Close\" and \"Cancel\",\n            // Gecko (Firefox) shows \"Leave page\" and \"Stay on page\".\n            buttons: [tx('close_window'), tx('cancel')],\n            title: tx('webxdc_beforeunload_dialog_title'),\n            message: tx('webxdc_beforeunload_dialog_message'),\n            defaultId: 0,\n            cancelId: 1,\n          })\n          const close = choice === 0\n          if (close) {\n            // `ev.preventDefault()` doesn't work here because\n            // here is not the top level of the event listener.\n\n            denyPreventUnload = true\n            // Yes, this will fire another `beforeunload` event\n            // inside the app. If this is a problem,\n            // consider `webxdcWindow.destroy()` instead.\n            // However, this shouldn't be too problematic,\n            // because this is practically equivalent\n            // to the user first picking \"Stay on page\",\n            // and then closing the app again and picking \"Leave\" this time.\n            webxdcWindow.close()\n          }\n        }, 150)\n      })\n\n      // we would like to make `mailto:`-links work,\n      // but https://github.com/electron/electron/pull/34418 is not merged yet.\n\n      // prevent webxdc content from setting the window title\n      webxdcWindow.on('page-title-updated', ev => {\n        ev.preventDefault()\n      })\n\n      const loggedPermissionRequests = new Set<string>()\n\n      const permission_handler = (permission: string) => {\n        const isAllowed: boolean = ALLOWED_PERMISSIONS.includes(permission)\n\n        // Prevent webxdcs from spamming the log\n        if (!loggedPermissionRequests.has(permission)) {\n          loggedPermissionRequests.add(permission)\n          if (isAllowed) {\n            log.info(\n              `ALLOWED permission '${permission}' to webxdc '${webxdcInfo.name}'`\n            )\n          } else {\n            log.info(\n              `DENIED permission '${permission}' to webxdc '${webxdcInfo.name}'. If you think that's a bug and you need that permission, then please open an issue on github.`\n            )\n          }\n        }\n\n        return isAllowed\n      }\n\n      webxdcWindow.webContents.session.setPermissionCheckHandler(\n        (_wc, permission) => {\n          return permission_handler(permission)\n        }\n      )\n      webxdcWindow.webContents.session.setPermissionRequestHandler(\n        (_wc, permission, callback) => {\n          callback(permission_handler(permission))\n        }\n      )\n\n      webxdcWindow.webContents.on('before-input-event', (event, input) => {\n        if (input.code === 'F12') {\n          if (DesktopSettings.state.enableWebxdcDevTools) {\n            webxdcWindow.webContents.toggleDevTools()\n            event.preventDefault()\n          }\n        }\n      })\n    }\n\n    // actual webxdc instances\n    ipcMain.handle('open-webxdc', openWebxdc)\n\n    ipcMain.handle('webxdc.exitFullscreen', async event => {\n      const app = lookupAppFromEvent(event)\n      // On Linux Electron hides the menu bar if we call\n      // `setFullScreen(false)` and we're not already in full-screen,\n      // so let's check for this.\n      if (app && app.win.isFullScreen()) {\n        app.win.setFullScreen(false)\n      }\n    })\n\n    ipcMain.handle('webxdc.exit', async event => {\n      const app = lookupAppFromEvent(event)\n      if (app) {\n        app.win.loadURL('about:blank')\n        app.win.close()\n      }\n    })\n\n    ipcMain.handle('webxdc.getAllUpdates', async (event, serial = 0) => {\n      const app = lookupAppFromEvent(event)\n      if (!app) {\n        log.error(\n          'webxdc.getAllUpdates failed, app not found in list of open ones'\n        )\n        return []\n      }\n\n      return await this.rpc.getWebxdcStatusUpdates(\n        app.accountId,\n        app.msgId,\n        serial\n      )\n    })\n\n    ipcMain.handle('webxdc.sendUpdate', async (event, update) => {\n      const app = lookupAppFromEvent(event)\n      if (!app) {\n        log.error(\n          'webxdc.sendUpdate failed, app not found in list of open ones'\n        )\n        return\n      }\n      try {\n        return await this.rpc.sendWebxdcStatusUpdate(\n          app.accountId,\n          app.msgId,\n          update,\n          ''\n        )\n      } catch (error) {\n        log.error('webxdc.sendUpdate failed:', error)\n        throw error\n      }\n    })\n\n    ipcMain.handle(\n      'webxdc.sendRealtimeData',\n      async (event, update: number[]) => {\n        const app = lookupAppFromEvent(event)\n        if (!app) {\n          log.error(\n            'webxdc.sendRealtimeData failed, app not found in list of open ones'\n          )\n          return\n        }\n        try {\n          return await this.rpc.sendWebxdcRealtimeData(\n            app.accountId,\n            app.msgId,\n            update\n          )\n        } catch (error) {\n          log.error('webxdc.sendWebxdcRealtimeData failed:', error)\n          throw error\n        }\n      }\n    )\n\n    ipcMain.handle('webxdc.sendRealtimeAdvertisement', async event => {\n      const app = lookupAppFromEvent(event)\n      if (!app) {\n        log.error(\n          'webxdc.sendRealtimeAdvertisement failed, app not found in list of open ones'\n        )\n        return\n      }\n      await this.rpc.sendWebxdcRealtimeAdvertisement(app.accountId, app.msgId)\n    })\n\n    ipcMain.handle('webxdc.leaveRealtimeChannel', async event => {\n      const app = lookupAppFromEvent(event)\n      if (!app) {\n        log.error(\n          'webxdc.leaveRealtimeChannel, app not found in list of open ones'\n        )\n        return\n      }\n      this.rpc.leaveWebxdcRealtime(app.accountId, app.msgId)\n    })\n\n    ipcMain.handle(\n      'webxdc.sendToChat',\n      (\n        event,\n        file: { file_name: string; file_content: string } | null,\n        text: string | null\n      ) => {\n        const app = lookupAppFromEvent(event)\n        if (!app) {\n          log.error(\n            'webxdc.sendToChat failed, app not found in list of open ones'\n          )\n          return\n        }\n        // forward to main window\n        main_window?.webContents.send(\n          'webxdc.sendToChat',\n          file,\n          text,\n          app.accountId\n        )\n        main_window?.focus()\n      }\n    )\n\n    ipcMain.handle('close-all-webxdc', () => {\n      this._closeAll()\n    })\n\n    ipcMain.handle(\n      'webxdc:custom:drag-file-out',\n      async (\n        event,\n        file_name: string,\n        base64_content: string,\n        icon_data_url?: string\n      ) => {\n        const path = await writeTempFileFromBase64(file_name, base64_content)\n        let icon: string | Electron.NativeImage = join(\n          htmlDistDir(),\n          'images/electron-file-drag-out.png'\n        )\n        if (icon_data_url) {\n          icon = nativeImage.createFromDataURL(icon_data_url)\n        }\n        // if xdc extract icon?\n        event.sender.startDrag({\n          file: path,\n          icon,\n        })\n      }\n    )\n\n    ipcMain.handle(\n      'webxdc:status-update',\n      (_ev, accountId: number, instanceId: number) => {\n        const instance = open_apps[`${accountId}.${instanceId}`]\n        if (instance) {\n          instance.win.webContents.send('webxdc.statusUpdate')\n        }\n      }\n    )\n\n    ipcMain.handle(\n      'webxdc:realtime-data',\n      async (_ev, accountId: number, instanceId: number, payload: number[]) => {\n        const instance = open_apps[`${accountId}.${instanceId}`]\n        if (instance) {\n          instance.win.webContents.send('webxdc.realtimeData', payload)\n        } else {\n          this.rpc.leaveWebxdcRealtime(accountId, instanceId)\n        }\n      }\n    )\n\n    ipcMain.handle(\n      'webxdc:message-changed',\n      async (_ev, accountId: number, instanceId: number) => {\n        const instance = open_apps[`${accountId}.${instanceId}`]\n        if (instance) {\n          const { chatId, webxdcInfo } = await this.rpc.getMessage(\n            accountId,\n            instanceId\n          )\n          const { name } = await this.rpc.getBasicChatInfo(accountId, chatId)\n          if (instance.win && webxdcInfo) {\n            instance.win.title = makeTitle(webxdcInfo, name)\n          }\n        }\n      }\n    )\n\n    ipcMain.handle(\n      'webxdc:instance-deleted',\n      (_ev, accountId: number, instanceId: number) => {\n        const webxdcId = `${accountId}.${instanceId}`\n        const instance = open_apps[webxdcId]\n        if (instance) {\n          instance.win.close()\n        }\n        this.removeLastBounds(accountId, instanceId)\n        const s = sessionFromAccountId(accountId)\n        const appURL = `webxdc://${webxdcId}.webxdc`\n        s.clearStorageData({ origin: appURL })\n        s.clearData({ origins: [appURL] })\n        s.clearCodeCaches({ urls: [appURL] })\n        s.clearCache()\n      }\n    )\n\n    ipcMain.handle(\n      'open-maps-webxdc',\n      async (evt, accountId: number, chatId?: number) => {\n        let msgId = await this.rpc.initWebxdcIntegration(\n          accountId,\n          chatId ?? null\n        )\n        if (!msgId) {\n          // after packaging all files are in asar dir\n          // core needs real path\n          const path = htmlDistDir().replace('app.asar', 'app.asar.unpacked')\n          await this.rpc.setWebxdcIntegration(\n            accountId,\n            join(path, '/xdcs/maps.xdc')\n          )\n          msgId = await this.rpc.initWebxdcIntegration(\n            accountId,\n            chatId ?? null\n          )\n        }\n        if (msgId) {\n          let chatName = tx('menu_show_global_map')\n          if (chatId) {\n            const relatedChatInfo = await this.rpc.getBasicChatInfo(\n              accountId,\n              chatId\n            )\n            chatName = tx('locations') + ' - ' + relatedChatInfo.name\n          } else {\n            const accountInfo = await this.rpc.getAccountInfo(accountId)\n            if (\n              'displayName' in accountInfo &&\n              accountInfo.displayName !== null\n            ) {\n              chatName =\n                tx('menu_show_global_map') + ' - ' + accountInfo.displayName\n            }\n          }\n          // if map is already (or still) open, close it\n          const key = `${accountId}.${msgId}`\n          if (open_apps[key] !== undefined) {\n            open_apps[key].win.loadURL('about:blank')\n            open_apps[key].win.close()\n          }\n          const messageWithMap = await this.rpc.getMessage(accountId, msgId)\n          if (messageWithMap && messageWithMap.webxdcInfo) {\n            openWebxdc(\n              evt,\n              msgId,\n              {\n                accountId,\n                displayname: '',\n                chatName,\n                webxdcInfo: messageWithMap.webxdcInfo,\n                href: '',\n              },\n              // special behaviour for the map dc integration,\n              // (in this case bigger landscape window)\n              DEFAULT_SIZE_MAP\n            )\n          }\n        }\n      }\n    )\n  } // end of DeltaChatController constructor\n\n  get rpc() {\n    return this.controller.jsonrpcRemote.rpc\n  }\n\n  async getLastBounds(\n    accountId: number,\n    msgId: number\n  ): Promise<Bounds | null> {\n    try {\n      const raw = await this.rpc.getConfig(\n        accountId,\n        `${BOUNDS_UI_CONFIG_PREFIX}.${msgId}`\n      )\n      if (raw) {\n        return JSON.parse(raw)\n      }\n    } catch (error) {\n      log.debug('failed to retrieve bounds for webxdc', error)\n    }\n    return null\n  }\n\n  setLastBounds(accountId: number, msgId: number, bounds: Bounds) {\n    return this.rpc.setConfig(\n      accountId,\n      `${BOUNDS_UI_CONFIG_PREFIX}.${msgId}`,\n      JSON.stringify(bounds)\n    )\n  }\n\n  removeLastBounds(accountId: number, msgId: number) {\n    return this.rpc.setConfig(\n      accountId,\n      `${BOUNDS_UI_CONFIG_PREFIX}.${msgId}`,\n      null\n    )\n  }\n\n  _closeAll() {\n    for (const open_app of Object.keys(open_apps)) {\n      open_apps[open_app].win.close()\n    }\n  }\n}\n\nasync function webxdcProtocolHandler(\n  rpc: Jsonrpc.RawClient,\n  request: GlobalRequest\n): Promise<GlobalResponse> {\n  /**\n   * Make sure to only `return makeResponse()` because it sets headers\n   * that are important for security, namely `Content-Security-Policy`.\n   * Failing to set CSP might result in the app being able to create\n   * an <iframe> with no CSP, e.g. `<iframe src=\"/no_such_file.lol\">`\n   * within which they can then do whatever\n   * through the parent frame, see\n   * \"XDC-01-002 WP1: Full CSP bypass via desktop app webxdc.js\"\n   * https://public.opentech.fund/documents/XDC-01-report_2_1.pdf\n   */\n  const makeResponse = (\n    body: BodyInit,\n    responseInit: Omit<ResponseInit, 'headers'>,\n    mime_type?: undefined | string\n  ) => {\n    const headers = new Headers()\n    if (!open_apps[id].internet_access) {\n      headers.append('Content-Security-Policy', CSP)\n    }\n    // Ensure that the client doesn't try to interpret a file as\n    // one with 'application/pdf' mime type and therefore open it\n    // in the PDF viewer, see\n    // \"XDC-01-005 WP1: Full CSP bypass via desktop app PDF embed\"\n    // https://public.opentech.fund/documents/XDC-01-report_2_1.pdf\n    headers.append('X-Content-Type-Options', 'nosniff')\n    if (mime_type) {\n      headers.append('content-type', mime_type)\n    }\n    return new Response(body, {\n      ...responseInit,\n      headers,\n    })\n  }\n\n  const url = new URL(request.url)\n  const [account, msg] = url.hostname.split('.')\n  const id = `${account}.${msg}`\n\n  if (!open_apps[id]) {\n    return makeResponse('', { status: 500 })\n  }\n\n  let filename = url.pathname\n  // remove leading / trailing \"/\"\n  if (filename.endsWith('/')) {\n    filename = filename.substring(0, filename.length - 1)\n  }\n  if (filename.startsWith('/')) {\n    filename = filename.substring(1)\n  }\n\n  let mimeType: string | undefined = Mime.lookup(filename) || ''\n  // Make sure that the browser doesn't open files in the PDF viewer.\n  // TODO is this the only mime type that opens the PDF viewer?\n  // TODO consider a mime type whitelist instead.\n  if (mimeType === 'application/pdf') {\n    // TODO make sure that `callback` won't internally set mime type back\n    // to 'application/pdf' (at the time of writing it's not the case).\n    // Otherwise consider explicitly setting it as a header.\n    mimeType = undefined\n  }\n\n  if (filename === WRAPPER_PATH) {\n    return makeResponse(\n      await readFile(join(htmlDistDir(), '/webxdc_wrapper.html')),\n      {},\n      mimeType\n    )\n  } else if (filename === 'webxdc.js') {\n    const displayName = Buffer.from(open_apps[id].displayName).toString(\n      'base64'\n    )\n    const selfAddr = Buffer.from(open_apps[id].selfAddr).toString('base64')\n    // initializes the preload script, the actual implementation of `window.webxdc` is found there: static/webxdc-preload.js\n    return makeResponse(\n      Buffer.from(\n        `window.parent.webxdc_internal.setup(\"${selfAddr}\",\"${displayName}\", ${Number(\n          open_apps[id].sendUpdateInterval\n        )}, ${Number(open_apps[id].sendUpdateMaxSize)})\n        window.webxdc = window.parent.webxdc\n        window.webxdc_custom = window.parent.webxdc_custom`\n      ),\n      {},\n      mimeType\n    )\n  } else {\n    try {\n      const blob = Buffer.from(\n        await rpc.getWebxdcBlob(\n          open_apps[id].accountId,\n          open_apps[id].msgId,\n          filename\n        ),\n        'base64'\n      )\n      return makeResponse(blob, {}, mimeType)\n    } catch (error) {\n      log.error('webxdc: load blob:', error)\n      return makeResponse('', { status: 404 })\n    }\n  }\n}\n\nfunction lookupAppFromEvent(event: IpcMainInvokeEvent): AppInstance | null {\n  for (const key of Object.keys(open_apps)) {\n    const app = open_apps[key]\n    if (app.win.webContents === event.sender) {\n      return app\n    }\n  }\n  return null\n}\n\nfunction makeTitle(webxdcInfo: T.WebxdcMessageInfo, chatName: string): string {\n  return `${\n    webxdcInfo.document ? truncateText(webxdcInfo.document, 32) + ' - ' : ''\n  }${truncateText(webxdcInfo.name, 42)} \u2013 ${chatName}`\n}\n\nfunction partitionFromAccountId(accountId: number) {\n  return `persist:webxdc_${accountId}`\n}\n\nfunction sessionFromAccountId(accountId: number) {\n  return session.fromPartition(partitionFromAccountId(accountId), {\n    cache: false,\n  })\n}\n\nipcMain.handle('webxdc.clearWebxdcDOMStorage', async (_, accountId: number) => {\n  const session = sessionFromAccountId(accountId)\n  await session.clearStorageData()\n  await session.clearData()\n})\n\nipcMain.handle('webxdc.getWebxdcDiskUsage', async (_, accountId: number) => {\n  const ses = sessionFromAccountId(accountId)\n  if (!ses.storagePath) {\n    throw new Error('session has no storagePath set')\n  }\n  const [cache_size, real_total_size] = await Promise.all([\n    ses.getCacheSize(),\n    get_recursive_folder_size(ses.storagePath, [\n      'GPUCache',\n      'QuotaManager',\n      'Code Cache',\n      'LOG',\n      'LOG.old',\n      'LOCK',\n      '.DS_Store',\n      'Cookies-journal',\n      'Databases.db-journal',\n      'Preferences',\n      'QuotaManager-journal',\n      '000003.log',\n      'MANIFEST-000001',\n    ]),\n  ])\n  const empty_size = 49 * 1024 // ~ size of an empty session/partition\n\n  let total_size = real_total_size - empty_size\n  let data_size = total_size - cache_size\n  if (total_size < 0) {\n    total_size = 0\n    data_size = 0\n  }\n  return {\n    cache_size,\n    total_size,\n    data_size,\n  }\n})\n\nasync function get_recursive_folder_size(\n  path: string,\n  exclude_list: string[] = []\n) {\n  let size = 0\n  for (const item of await readdir(path)) {\n    const item_path = join(path, item)\n    const stats = await stat(item_path)\n    if (exclude_list.includes(item)) {\n      continue\n    }\n    if (stats.isDirectory()) {\n      size += await get_recursive_folder_size(item_path, exclude_list)\n    } else {\n      size += stats.size\n    }\n  }\n  return size\n}\n\nexport async function webxdcStartUpCleanup() {\n  try {\n    const partitions_dir = join(getConfigPath(), 'Partitions')\n    if (!existsSync(partitions_dir)) {\n      return\n    }\n    const folders = await readdir(partitions_dir)\n    for (const folder of folders) {\n      if (!folder.startsWith('webxdc')) {\n        continue\n      }\n      try {\n        await stat(join(partitions_dir, folder, 'webxdc-cleanup'))\n        await rmdir(join(partitions_dir, folder), { recursive: true })\n        log.info('webxdc cleanup: deleted ', folder)\n      } catch (error: any) {\n        if (error.code !== 'ENOENT') {\n          throw error\n        }\n      }\n    }\n  } catch (error) {\n    log.warn('webxdc cleanup failed', error)\n  }\n}\n\n/**\n * Make sure a size doesn't extend the primary display work area.\n */\nfunction adjustSize(size: Size): Size {\n  const { height: screenHeight, width: screenWidth } =\n    screen.getPrimaryDisplay().workAreaSize\n  return {\n    width: Math.min(size.width, screenWidth),\n    height: Math.min(size.height, screenHeight),\n  }\n}\n\nipcMain.handle('delete_webxdc_account_data', async (_ev, accountId: number) => {\n  // we can not delete the directory as it might still be used and that would be a problem on windows\n  // so the second next best thing we can do is telling electron to clear the data, even though it won't delete everything\n  const s = session.fromPartition(`persist:webxdc_${accountId}`, {\n    cache: false,\n  })\n  await s.clearStorageData()\n  await s.clearData()\n\n  // mark the folder for deletion on next startup\n  if (s.storagePath) {\n    await writeFile(join(s.storagePath, 'webxdc-cleanup'), '-', 'utf-8')\n  } else {\n    throw new Error('session has no storagePath set')\n  }\n})\n", "import { getLogger } from '@deltachat-desktop/shared/logger'\nimport { ChildProcessWithoutNullStreams, spawn } from 'child_process'\nimport { app, dialog } from 'electron/main'\nimport { BuildInfo } from '../get-build-info'\nimport { arch, platform } from 'os'\nimport { getLogsPath } from '../application-constants'\n\nconst log = getLogger('DC-RPC')\n\nexport class StdioServer {\n  serverProcess: ChildProcessWithoutNullStreams | null\n  constructor(\n    public on_data: (reponse: string) => void,\n    public accounts_path: string,\n    private cmd_path: string\n  ) {\n    this.serverProcess = null\n  }\n\n  start() {\n    this.serverProcess = spawn(this.cmd_path, {\n      env: {\n        DC_ACCOUNTS_PATH: this.accounts_path,\n        RUST_LOG: process.env.RUST_LOG,\n        // remove color from errors, see https://github.com/deltachat/deltachat-desktop/issues/4832\n        NO_COLOR: '1',\n      },\n    })\n\n    this.serverProcess.on('error', err => {\n      // The 'error' event is emitted whenever:\n      // - The process could not be spawned.\n      // - The process could not be killed.\n      // - Sending a message to the child process failed.\n      // - The child process was aborted via the signal option.\n      // ~ https://nodejs.org/api/child_process.html#event-error\n\n      if (err.message.endsWith('ENOENT')) {\n        dialog.showErrorBox(\n          'Fatal Error: Core Library Missing',\n          `The DeltaChat Module is missing! This could be due to your antivirus program. Please check the quarantine to restore it and notify the developers about this issue.\nYou can reach us on delta@merlinux.eu or on github.com/deltachat/deltachat-desktop/issues.\n\nThe missing module should be located at \"${this.cmd_path}\".\n\nThe Log file is located in this folder: ${getLogsPath()}\n--------------------\nError: ${err.message}\n`\n        )\n      } else {\n        dialog.showErrorBox(\n          'Fatal Error',\n          `Error with core has been detected, please contact developers: You can reach us on delta@merlinux.eu or on github.com/deltachat/deltachat-desktop/issues .\n\n          ${err.name}: ${err.message}\n\n          The Log file is located in this folder: ${getLogsPath()}\\n\n          `\n        )\n      }\n      // I think we can exit in all the cases, because all errors here are serious\n      app.exit(1)\n    })\n\n    let buffer = ''\n    this.serverProcess.stdout.on('data', data => {\n      // console.log(`stdout: ${data}`)\n      buffer += data.toString()\n      while (buffer.includes('\\n')) {\n        const n = buffer.indexOf('\\n')\n        const message = buffer.substring(0, n)\n        this.on_data(message)\n        buffer = buffer.substring(n + 1)\n      }\n    })\n\n    // some kind of \"buffer\" that the text in the error dialog does not get too long\n    let errorLog = ''\n    const ERROR_LOG_LENGTH = 800\n    this.serverProcess.stderr.on('data', data => {\n      log.error(`stderr: ${data}`.trimEnd())\n      errorLog = (errorLog + data).slice(-ERROR_LOG_LENGTH)\n    })\n\n    this.serverProcess.on('close', (code, signal) => {\n      if (code !== null) {\n        log.info(`child process close all stdio with code ${code}`)\n      } else {\n        log.info(`child process close all stdio with signal ${signal}`)\n      }\n    })\n\n    this.serverProcess.on('exit', (code, signal) => {\n      if (code !== null) {\n        log.info(`child process exited with code ${code}`)\n        if (code !== 0) {\n          log.critical('Fatal: The Delta Chat Core exited unexpectedly', code)\n          dialog.showErrorBox(\n            'Fatal Error',\n            `[Version: ${\n              BuildInfo.VERSION\n            } | ${platform()} | ${arch()}]\\nThe Delta Chat Core exited unexpectedly with code ${code}\\n${errorLog}`\n          )\n          app.exit(1)\n        }\n      } else {\n        log.warn(`child process exited with signal ${signal}`)\n      }\n    })\n  }\n\n  send(message: string) {\n    this.serverProcess?.stdin.write(message + '\\n')\n  }\n}\n", "import type { BuildInfo as BuildInfoType } from '@deltachat-desktop/shared/shared-types'\n\n// `BUILD_INFO_JSON_STRING` is replaced by esbuild during bundling\n//@ts-ignore\nexport const BuildInfo: BuildInfoType = JSON.parse(BUILD_INFO_JSON_STRING)\n", "// When you change this file, then run `pnpm migration-test` afterwards\n// to ensure that it still works with all old formats\n\nimport { startDeltaChat } from '@deltachat/stdio-rpc-server'\nimport { existsSync, lstatSync } from 'fs'\nimport { join } from 'path'\nimport { Logger } from '../../../shared/logger.js'\nimport { mkdir, readdir, rename, rm, rmdir, stat } from 'fs/promises'\nimport { DcEvent } from '@deltachat/jsonrpc-client'\n\n/**\n *\n * @param cwd\n * @param log\n * @param treatFailedMigrationAsError used for the automated testing\n * @returns {Promise<boolean>} whether something was migrated\n */\nexport async function migrateAccountsIfNeeded(\n  cwd: string,\n  log: Logger,\n  treatFailedMigrationAsError: boolean = false\n): Promise<boolean> {\n  let tmpDC\n  const eventLogger = (accountId: number, event: DcEvent) =>\n    log.debug('core-event', { accountId, ...event })\n  try {\n    const new_accounts_format = existsSync(join(cwd, 'accounts.toml'))\n    if (new_accounts_format) {\n      log.debug('migration not needed: accounts.toml already exists')\n      return false\n    }\n\n    log.debug('accounts.toml not found, checking if there is previous data')\n\n    const configPath = join(cwd, '..')\n\n    const accountFoldersFormat1 = (await readdir(configPath)).filter(\n      folderName => {\n        const path = join(configPath, folderName)\n        // isDeltaAccountFolder\n        try {\n          const db_path = join(path, 'db.sqlite')\n          return (\n            lstatSync(path).isDirectory() &&\n            existsSync(db_path) &&\n            lstatSync(db_path).isFile() &&\n            !lstatSync(path).isSymbolicLink()\n          )\n        } catch (error) {\n          log.debug('error while testing if folder is account', error)\n          return false\n        }\n      }\n    )\n\n    const migrateFromFormat1 = accountFoldersFormat1.length !== 0\n    const migrateFromFormat2 = existsSync(cwd)\n\n    if (!migrateFromFormat1 && !migrateFromFormat2) {\n      log.info('migration not needed: nothing to migrate')\n      return false\n    }\n\n    // this is the same as cwd, but for clarity added ../accounts\n    const path_accounts = join(cwd, '..', 'accounts')\n    const pathAccountsOld = join(cwd, '..', 'accounts_old')\n\n    if (migrateFromFormat2) {\n      log.info(`found old some accounts (format 2), we need to migrate...`)\n\n      // First, rename accounts folder to accounts_old\n      await rename(path_accounts, pathAccountsOld)\n    }\n\n    // Next, create temporary account manager to migrate accounts\n    tmpDC = await startDeltaChat(path_accounts, {\n      muteStdErr: false,\n    })\n    tmpDC.on('ALL', eventLogger)\n\n    const oldFoldersToDelete = []\n\n    if (migrateFromFormat1) {\n      log.info(\n        `found old ${accountFoldersFormat1.length} legacy accounts (1), we need to migrate...`\n      )\n\n      // Next, iterate over all folders in accounts_old\n      for (const folder of accountFoldersFormat1) {\n        log.debug(`migrating legacy account \"${folder}\"`)\n        const pathDBFile = join(configPath, folder, 'db.sqlite')\n\n        // fix import account without blobs folder (not all of them are unconfigured it seems)\n        const blobsFolder = join(configPath, folder, 'db.sqlite-blobs')\n        if (!existsSync(blobsFolder)) {\n          await mkdir(blobsFolder, { recursive: true })\n        }\n\n        try {\n          await tmpDC.rpc.migrateAccount(pathDBFile)\n          oldFoldersToDelete.push(folder)\n        } catch (error) {\n          log.error(`Failed to migrate account at path \"${pathDBFile}\"`, error)\n          if (treatFailedMigrationAsError) {\n            throw error\n          }\n        }\n      }\n    }\n\n    if (migrateFromFormat2) {\n      // Next, iterate over all folders in accounts_old\n      for (const entry of await readdir(pathAccountsOld)) {\n        const stat_result = await stat(join(pathAccountsOld, entry))\n        if (!stat_result.isDirectory()) continue\n        log.debug(`migrating account \"${join(pathAccountsOld, entry)}\"`)\n        const path_dbfile = join(pathAccountsOld, entry, 'db.sqlite')\n        if (!existsSync(path_dbfile)) {\n          log.warn(\n            'found an old accounts folder without a db.sqlite file, skipping'\n          )\n          continue\n        }\n\n        // fix import account without blobs folder (not all of them are unconfigured)\n        const blobsFolder = join(pathAccountsOld, entry, 'db.sqlite-blobs')\n        if (!existsSync(blobsFolder)) {\n          await mkdir(blobsFolder, { recursive: true })\n        }\n        try {\n          const account_id = await tmpDC.rpc.migrateAccount(path_dbfile)\n          // check if there are stickers\n          const old_sticker_folder = join(pathAccountsOld, entry, 'stickers')\n          if (existsSync(old_sticker_folder)) {\n            log.debug('found stickers, migrating them', old_sticker_folder)\n            try {\n              const blobdir = await tmpDC.rpc.getBlobDir(account_id)\n              if (!blobdir) {\n                throw new Error('blobdir is undefined')\n              }\n              const new_sticker_folder = join(blobdir, '../stickers')\n              await rename(old_sticker_folder, new_sticker_folder)\n            } catch (error) {\n              log.error('stickers migration failed', old_sticker_folder, error)\n              if (treatFailedMigrationAsError) {\n                throw error\n              }\n            }\n          }\n          // if successful remove old account folder too\n          oldFoldersToDelete.push(join(pathAccountsOld, entry))\n        } catch (error) {\n          log.error(\n            `Failed to migrate account at path \"${path_dbfile}\":`,\n            error\n          )\n        }\n      }\n    }\n    // cleanup\n    tmpDC.off('ALL', eventLogger)\n    tmpDC.close()\n    for (const oldFolder of oldFoldersToDelete.map(f => join(configPath, f))) {\n      try {\n        try {\n          await rm(join(oldFolder, '.DS_Store'))\n        } catch (error) {\n          /* ignore */\n        }\n        await rmdir(oldFolder)\n      } catch (error) {\n        log.error('Failed to cleanup old folder:', oldFolder, error)\n      }\n    }\n    log.info('migration completed')\n\n    return true\n  } catch (err) {\n    tmpDC?.off('ALL', eventLogger)\n    tmpDC?.close()\n    throw err\n  }\n}\n", "import { platform } from 'os'\nimport { app, Notification, nativeImage, ipcMain } from 'electron'\n\nimport * as mainWindow from './windows/main.js'\nimport { appIcon } from './application-constants.js'\nimport type { DcNotification } from '../../shared/shared-types.js'\nimport { getLogger } from '../../shared/logger.js'\n\nimport type { NativeImage, IpcMainInvokeEvent } from 'electron'\n\n/**\n * Notification related functions to:\n * - show notifications in operating system\n * - handle click on notification\n *\n * is triggered from renderer process (!)\n * by handling events (ipcMain.handle)\n *\n * see: frontend/src/system-integration/notifications.ts\n */\n\nconst log = getLogger('main/notifications')\n\nconst isMac = platform() === 'darwin'\n\nif (Notification.isSupported()) {\n  ipcMain.handle('notifications.show', showNotification)\n  ipcMain.handle('notifications.clear', clearNotificationsForChat)\n  ipcMain.handle('notifications.clearAll', clearAll)\n  process.on('beforeExit', clearAll)\n} else {\n  // Register no-op handlers for notifications to silently fail when\n  // no notifications are supported\n  ipcMain.handle('notifications.show', () => {})\n  ipcMain.handle('notifications.clear', () => {})\n  ipcMain.handle('notifications.clearAll', () => {})\n}\n\nfunction createNotification(data: DcNotification): Notification {\n  let icon: NativeImage | undefined = data.icon\n    ? data.icon.startsWith('data:')\n      ? nativeImage.createFromDataURL(data.icon)\n      : nativeImage.createFromPath(data.icon)\n    : undefined\n\n  if (!icon || icon.isEmpty()) {\n    // fallback: show app icon instead (if not on mac, because mac already shows the app icon)\n    if (!isMac) {\n      icon = nativeImage.createFromPath(appIcon())\n    }\n  }\n\n  const notificationOptions: Electron.NotificationConstructorOptions = {\n    title: data.title,\n    // https://www.electronjs.org/docs/latest/tutorial/notifications#linux\n    // says\n    // > Notifications are sent using libnotify, which can show notifications\n    // > on any desktop environment that follows\n    // > [Desktop Notifications Specification](https://web.archive.org/web/20240428012536/https://specifications.freedesktop.org/notification-spec/notification-spec-latest.html)\n    // Which says that the body supports limited markup\n    // So let's escape it.\n    body:\n      platform() === 'linux' ? filterNotificationText(data.body) : data.body,\n    icon,\n    timeoutType: 'default',\n  }\n\n  if (process.platform === 'win32') {\n    // Workaround for disabling close button on windows. Undefined electron behaviour. Yey.\n    notificationOptions.closeButtonText = undefined\n  }\n\n  return new Notification(notificationOptions)\n}\n\nfunction onClickNotification(\n  accountId: number,\n  chatId: number,\n  msgId: number,\n  _ev: Electron.Event\n) {\n  mainWindow.send('ClickOnNotification', {\n    accountId,\n    chatId,\n    msgId,\n  })\n  mainWindow.show()\n  app.focus()\n  mainWindow.window?.focus()\n}\n\nconst notifications: {\n  [accountId: number]: { [chatId: number]: Notification[] }\n} = {}\n\n/**\n * triggers creation of a notification, adds appropriate\n * callbacks and shows it via electron Notification API\n *\n * @param data is passed from renderer process\n */\nfunction showNotification(_event: IpcMainInvokeEvent, data: DcNotification) {\n  const { chatId, accountId } = data\n\n  log.debug(\n    'Creating notification:',\n    Object.assign({}, data, { body: undefined, title: undefined })\n  )\n\n  try {\n    const notify = createNotification(data)\n\n    notify.on('click', Event => {\n      onClickNotification(data.accountId, chatId, data.messageId, Event)\n      notifications[accountId][chatId] =\n        notifications[accountId]?.[chatId]?.filter(n => n !== notify) || []\n      notify.close()\n    })\n    notify.on('close', () => {\n      // on Window and Linux this can be triggered by system time out\n      // when the message is moved to notification center so only close\n      // the notification on this event on Mac\n      if (isMac) {\n        notifications[accountId][chatId] =\n          notifications[accountId]?.[chatId]?.filter(n => n !== notify) || []\n      }\n      /* ignore-console-log */\n      console.log('Notification close event triggered', notify)\n    })\n\n    if (!notifications[accountId]) {\n      notifications[accountId] = {}\n    }\n\n    if (notifications[accountId][chatId]) {\n      notifications[accountId][chatId].push(notify)\n    } else {\n      notifications[accountId][chatId] = [notify]\n    }\n\n    notify.show()\n  } catch (error) {\n    log.warn('could not create notification:', error)\n  }\n}\n\nfunction clearNotificationsForChat(\n  _: unknown,\n  accountId: number,\n  chatId: number\n) {\n  log.debug('clearNotificationsForChat', { accountId, chatId, notifications })\n  if (notifications[accountId]?.[chatId]) {\n    for (const notify of notifications[accountId]?.[chatId] || []) {\n      notify.close()\n    }\n    delete notifications[accountId][chatId]\n  }\n  log.debug('after cleared Notifications', { accountId, chatId, notifications })\n}\n\nfunction clearAll() {\n  for (const accountId of Object.keys(notifications)) {\n    if (!Number.isNaN(Number(accountId))) {\n      for (const chatId of Object.keys(notifications[Number(accountId)])) {\n        if (!Number.isNaN(Number(chatId))) {\n          clearNotificationsForChat(null, Number(accountId), Number(chatId))\n        }\n      }\n    }\n  }\n}\n\n// Thanks to Signal for this function\n// https://github.com/signalapp/Signal-Desktop/blob/ae9181a4b26264ce553c7d8379a3ee5a07de018b/ts/services/notifications.ts#L485\n// it is licensed AGPL-3.0-only\nfunction filterNotificationText(text: string) {\n  return (text || '')\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n}\n", "import { app } from 'electron'\nimport { mkdir, readdir, rm, rmdir } from 'fs/promises'\nimport { join } from 'path'\nimport { getLogger } from '../../shared/logger.js'\nimport {\n  getDraftTempDir,\n  getAccountsPath,\n  INTERNAL_TMP_DIR_NAME,\n} from './application-constants.js'\nimport { readdirSync } from 'fs'\n\nconst log = getLogger('main/cleanup_temp_dir')\n\nexport async function cleanupDraftTempDir() {\n  try {\n    // ensure dir exists\n    const path = getDraftTempDir()\n    await mkdir(path, { recursive: true })\n    if (path.indexOf(app.getPath('temp')) === -1 || path.indexOf('..') !== -1) {\n      log.error(\n        'removeTempFile was called with a path that is outside of the temp dir: ',\n        path\n      )\n      throw new Error('Path is outside of the temp folder')\n    }\n\n    const files = await readdir(path)\n    if (files.length !== 0) {\n      log.debug(\n        `found old ${files.length} temporary draft files, trying to delete them now`\n      )\n      const promises = []\n      for (const file of files) {\n        log.debug('delete', join(path, file))\n        promises.push(rm(join(path, file)))\n      }\n\n      await Promise.all(promises)\n    }\n\n    // delete dir at the end\n    await rmdir(path)\n  } catch (error) {\n    log.error('Cleanup of old temp files failed: ', error)\n  }\n}\n\n/**\n * clean tmp directory in all accounts\n */\nexport async function cleanupInternalTempDirs() {\n  try {\n    let deletedTmpDirs = 0\n    const tmpDirents = readdirSync(getAccountsPath(), {\n      withFileTypes: true,\n    })\n      .filter(dirent => dirent.isDirectory())\n      .flatMap(accountDir => {\n        return readdirSync(join(accountDir.parentPath, accountDir.name), {\n          withFileTypes: true,\n        }).filter(\n          tmpDir =>\n            tmpDir.isDirectory() && tmpDir.name === INTERNAL_TMP_DIR_NAME\n        )\n      })\n    if (tmpDirents.length > 0) {\n      deletedTmpDirs = (\n        await Promise.all(\n          tmpDirents.map(tmpDir =>\n            rm(join(tmpDir.parentPath, tmpDir.name), {\n              recursive: true,\n              force: true,\n            })\n          )\n        )\n      ).length\n    }\n    log.info(`Deleted ${deletedTmpDirs} internal tmp directories`)\n  } catch (error) {\n    log.error('Cleanup of internal temp dirs failed: ', error)\n  }\n}\n"],
  "mappings": "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",
  "names": ["createRequire", "path", "url", "init_cjs_shim", "__esmMin", "require_ini", "__commonJSMin", "exports", "init_cjs_shim", "decode", "encode", "safe", "unsafe", "eol", "obj", "opt", "children", "out", "separator", "k", "_", "__", "val", "item", "nk", "dotSplit", "section", "child", "str", "part", "p", "re", "lines", "line", "match", "key", "value", "parts", "l", "nl", "del", "isQuoted", "doUnesc", "esc", "unesc", "i", "c", "require_strip_json_comments", "__commonJSMin", "exports", "module", "init_cjs_shim", "singleComment", "multiComment", "stripWithoutWhitespace", "stripWithWhitespace", "str", "start", "end", "opts", "currentChar", "nextChar", "insideString", "insideComment", "offset", "ret", "strip", "i", "escaped", "require_utils", "__commonJSMin", "exports", "init_cjs_shim", "fs", "ini", "path", "stripJsonComments", "parse", "content", "file", "args", "arg", "i", "json", "env", "prefix", "obj", "l", "k", "keypath", "_emptyStringIndex", "cursor", "_subkey", "find", "rel", "start", "require_deep_extend", "__commonJSMin", "exports", "module", "init_cjs_shim", "isSpecificValue", "val", "cloneSpecificValue", "x", "deepCloneArray", "arr", "clone", "item", "index", "deepExtend", "safeGetProperty", "object", "property", "target", "args", "src", "obj", "key", "require_minimist", "__commonJSMin", "exports", "module", "init_cjs_shim", "args", "opts", "flags", "key", "aliases", "x", "y", "defaults", "argv", "setArg", "notFlags", "argDefined", "arg", "val", "value", "isNumber", "setKey", "obj", "keys", "o", "i", "isConstructorOrProto", "aliasIsBoolean", "m", "next", "letters", "broken", "j", "hasKey", "require_rc", "__commonJSMin", "exports", "module", "init_cjs_shim", "cc", "join", "deepExtend", "etc", "win", "home", "name", "defaults", "argv", "parse", "env", "configs", "configFiles", "addConfigFile", "file", "fileConfig", "require_stackframe", "__commonJSMin", "exports", "module", "init_cjs_shim", "root", "factory", "_isNumber", "n", "_capitalize", "str", "_getter", "p", "booleanProps", "numericProps", "stringProps", "arrayProps", "objectProps", "props", "StackFrame", "obj", "i", "v", "fileName", "lineNumber", "columnNumber", "functionName", "argsStartIndex", "argsEndIndex", "args", "locationString", "parts", "j", "k", "require_error_stack_parser", "__commonJSMin", "exports", "module", "init_cjs_shim", "root", "factory", "StackFrame", "FIREFOX_SAFARI_STACK_REGEXP", "CHROME_IE_STACK_REGEXP", "SAFARI_NATIVE_CODE_REGEXP", "error", "urlLike", "regExp", "parts", "filtered", "line", "sanitizedLine", "location", "locationParts", "functionName", "fileName", "functionNameRegex", "matches", "e", "lineRE", "lines", "result", "i", "len", "match", "tokens", "functionCall", "argsRaw", "args", "require_package", "__commonJSMin", "exports", "module", "require_main", "__commonJSMin", "exports", "module", "init_cjs_shim", "fs", "path", "os", "crypto", "packageJson", "version", "LINE", "parse", "src", "obj", "lines", "match", "key", "value", "maybeQuote", "_parseVault", "options", "vaultPath", "_vaultPath", "result", "DotenvModule", "err", "keys", "_dotenvKey", "length", "decrypted", "i", "attrs", "_instructions", "error", "_log", "message", "_warn", "_debug", "dotenvKey", "uri", "environment", "environmentKey", "ciphertext", "possibleVaultPath", "filepath", "_resolveHome", "envPath", "_configVault", "parsed", "processEnv", "configDotenv", "dotenvPath", "encoding", "debug", "optionPaths", "lastError", "parsedAll", "e", "config", "decrypt", "encrypted", "keyStr", "nonce", "authTag", "aesgcm", "isRange", "invalidKeyLength", "decryptionFailed", "populate", "override", "require_application_config_path", "__commonJSMin", "exports", "module", "init_cjs_shim", "os", "path", "darwin", "name", "linux", "win32", "applicationConfigPath", "require_mkdirp", "__commonJSMin", "exports", "module", "init_cjs_shim", "path", "fs", "_0777", "mkdirP", "p", "opts", "f", "made", "mode", "xfs", "cb", "er", "er2", "stat", "sync", "err0", "require_application_config", "__commonJSMin", "exports", "module", "init_cjs_shim", "fs", "path", "applicationConfigPath", "ApplicationConfig", "name", "cb", "self", "err", "raw", "data", "mkdirp", "directoryPath", "tempFilePath", "require_debounce", "__commonJSMin", "exports", "module", "init_cjs_shim", "debounce", "func", "wait", "immediate", "timeout", "args", "context", "timestamp", "result", "later", "last", "debounced", "callNow", "init_cjs_shim", "init_cjs_shim", "import_rc", "defaults", "config", "rc", "rc_config", "rc_default", "init_cjs_shim", "init_cjs_shim", "init_cjs_shim", "import_error_stack_parser", "startTime", "colorize", "light", "code", "str", "blue", "red", "yellow", "grey", "green", "cyan", "emojiFontCss", "LogLevelString", "LoggerVariants", "printProcessLogLevelInfo", "v", "handler", "rc", "setLogHandler", "LogHandler", "rcObject", "log", "channel", "isMainProcess", "level", "stacktrace", "args", "variant", "beginning", "prefix", "prefixStyle", "getStackTrace", "rawStack", "errorStackParser", "stack", "s", "Logger", "getLogger", "alt", "key", "init_cjs_shim", "log", "getLogger", "translate", "locale", "messages", "localeBCP47", "pluralRules", "err", "getMessage", "key", "substitutions", "raw_opts", "translationKey", "opts", "entry", "message", "counter", "f", "index", "init_cjs_shim", "init_cjs_shim", "appName", "homePageUrl", "gitHubUrl", "gitHubIssuesUrl", "gitHubLicenseUrl", "donationUrl", "appWindowTitle", "Timespans", "AutodeleteDuration", "IMAGE_EXTENSIONS", "VIDEO_CHAT_INSTANCE_SYSTEMLI", "VIDEO_CHAT_INSTANCE_AUTISTICI", "NOTIFICATION_TYPE", "init_cjs_shim", "init_cjs_shim", "import_application_config", "config", "appConfig", "applicationConfig", "join", "application_config_default", "dirname", "join", "app", "screen", "fileURLToPath", "__dirname", "AppFilesDir", "appIcon", "iconFormat", "htmlDistDir", "windowDefaults", "targetFile", "defaultWidth", "screenHeight", "screenWidth", "headerHeight", "defaultHeight", "x", "y", "getConfigPath", "application_config_default", "getLogsPath", "getAccountsPath", "getCustomThemesPath", "getDraftTempDir", "supportedURISchemes", "ALLOWED_RESOURCE_FOLDERS", "ALLOWED_SOURCE_FOLDERS", "ALLOWED_CONFIG_FOLDERS", "ALLOWED_STATIC_FOLDERS", "folder", "ALLOWED_ACCOUNT_FOLDERS", "INTERNAL_TMP_DIR_NAME", "main_exports", "__export", "chooseLanguage", "hide", "init", "isAlwaysOnTop", "send", "setBounds", "setProgress", "setTitle", "setZoomFactor", "show", "toggleAlwaysOnTop", "toggleDevTools", "window", "init_cjs_shim", "init_cjs_shim", "init_cjs_shim", "init_cjs_shim", "getDefaultState", "import_debounce", "EventEmitter", "promisify", "log", "getLogger", "SAVE_DEBOUNCE_INTERVAL", "PersistentState", "default_state", "getDefaultState", "saved", "cb", "application_config_default", "error", "state", "debounce", "copy", "res", "rej", "err", "DesktopSettings", "rawApp", "Menu", "Tray", "nativeImage", "globalShortcut", "join", "dirname", "fileURLToPath", "__dirname", "tray", "contextMenu", "app", "log", "getLogger", "has_unread", "set_has_unread", "new_has_unread", "TrayImage", "trayIconFolder", "htmlDistDir", "image", "iconFormat", "mainWindowIsVisible", "window", "hideDeltaChat", "minimize", "getTrayMenu", "showDeltaChat", "hideOrShowDeltaChat", "quitDeltaChat", "updateTrayIcon", "DesktopSettings", "destroyTrayIcon", "renderTrayIcon", "tx", "refreshTrayContextMenu", "TrayIcon", "init_cjs_shim", "screen", "initMinWinDimensionHandling", "main_window", "minWidth", "minHeight", "update_min_size", "workAreaSize", "init_cjs_shim", "BrowserWindow", "platform", "log", "getLogger", "updateContentProtection", "window", "enabled", "setContentProtection", "DesktopSettings", "updateContentProtectionOnAllActiveWindows", "win", "import_debounce", "electron", "session", "isAbsolute", "join", "sep", "platform", "fileURLToPath", "log", "getLogger", "window", "init", "options", "defaults", "windowDefaults", "initialBounds", "DesktopSettings", "isMac", "mainWindow", "appIcon", "appWindowTitle", "initMinWinDimensionHandling", "setContentProtection", "htmlDistDir", "e", "_url", "saveBounds", "debounce", "bounds", "refreshTrayContextMenu", "refresh", "allowed_web_permissions", "permission_handler", "permission", "_wc", "callback", "details", "pathname", "getAccountsPath", "relativePathInAccounts", "relativePathInAccount", "ALLOWED_ACCOUNT_FOLDERS", "allowedPath", "ALLOWED_STATIC_FOLDERS", "hide", "send", "channel", "args", "error", "setBounds", "maximize", "scr", "setProgress", "progress", "setTitle", "title", "show", "toggleAlwaysOnTop", "flag", "isAlwaysOnTop", "toggleDevTools", "chooseLanguage", "locale", "setZoomFactor", "factor", "init_cjs_shim", "platform", "join", "app", "readFile", "existsSync", "appx", "isWindowsStorePackage", "app_path", "info", "mapPackagePath", "path", "basePath", "packagePath", "transformedPath", "getAppxPath", "app_folder", "init_cjs_shim", "existsSync", "join", "dirname", "fileURLToPath", "__dirname", "alternativeDirectory", "cachedResult", "getLocaleDirectoryPath", "places", "isValidLocaleDirectory", "directory", "path", "Menu", "shell", "readFileSync", "join", "log", "getLogger", "languages", "languagesFile", "getLocaleDirectoryPath", "rawLanguageList", "locale", "name", "name1", "name2", "logHandlerRef", "refresh", "getCurrentLocaleDate", "template", "getMenuTemplate", "menu", "item", "getMenuItem", "tx", "isAlwaysOnTop", "window", "init", "logHandler", "getAvailableLanguages", "currentLocale", "DesktopSettings", "chooseLanguage", "getZoomFactors", "zoomFactors", "currentZoomFactor", "scale", "key", "setZoomFactor", "getAppMenu", "isMainWindow", "extraItemsForMainWindow", "send", "appWindowTitle", "show", "getFileMenu", "isMac", "fileMenuNonMac", "quitDeltaChat", "fileMenuMac", "getEditMenu", "getHelpMenu", "homePageUrl", "gitHubIssuesUrl", "toggleAlwaysOnTop", "toggleDevTools", "mapPackagePath", "getLogsPath", "label", "i", "menuItem", "path", "fs", "ipcMain", "log", "getLogger", "currentlocaleData", "getCurrentLocaleDate", "translateFunction", "tx", "key", "substitutions", "raw_opts", "setLanguage", "locale", "localeData", "loadTranslations", "translate", "messagesEnglish", "getLocaleMessages", "retrieveLocaleFile", "messages", "localeFile", "localeMessages", "experimentalFile", "experimentalMessages", "onDiskLocale", "getLocaleDirectoryPath", "file", "err", "_ev", "refresh", "electron", "webContents", "win", "removeUnusedMenuItems", "menuTemplate", "notDeletedPreviousElement", "menuItem", "item", "index", "array", "items", "toDelete", "create", "handleContextMenu", "_event", "props", "editFlags", "hasText", "can", "type", "defaultActions", "tx", "_menuItem", "target", "word", "suggestion", "dictionarySuggestions", "ContextMenu", "isDisposed", "disposables", "init", "disposeMenu", "removeDisposable", "dispose", "app", "onWindowCreated", "electron_context_menu_default", "init_cjs_shim", "getHelpMenu", "init_cjs_shim", "powerMonitor", "onResumeFromSleep", "window", "initialisePowerMonitor", "init_cjs_shim", "createWriteStream", "join", "stdout", "stderr", "logName", "dir", "getLogsPath", "d", "pad", "number", "fileName", "createLogHandler", "stream", "channel", "level", "stacktrace", "args", "line", "fillString", "value", "readdir", "lstat", "unlink", "cleanupLogFolder", "log", "getLogger", "logDir", "logDirContent", "sortedFiles", "logFileName", "a", "b", "fileCount", "filename", "string", "n", "init_cjs_shim", "init_cjs_shim", "BrowserWindow", "Menu", "shell", "join", "stat", "platform", "log", "getLogger", "getHelpFileForLang", "locale", "contentFilePath", "htmlDistDir", "win", "openHelpWindow", "anchor", "defaults", "help_window", "appIcon", "appWindowTitle", "tx", "window", "setContentProtection", "removeScreenChangeListeners", "initMinWinDimensionHandling", "url", "_ev", "_e", "_wc", "_permission", "callback", "isMac", "makeMenu", "getAppMenu", "getFileMenu", "getHelpMenu", "refresh", "init_cjs_shim", "init_cjs_shim", "truncateText", "text", "max_len", "isInviteLink", "url", "throttle", "fn", "wait", "inThrottle", "timeout", "lastTime", "ret", "args", "init_cjs_shim", "rawApp", "ipcMain", "readFile", "basename", "platform", "log", "getLogger", "app", "frontend_ready", "sendToFrontend", "url", "send", "open_url", "sendOpenUrlEvent", "event", "window", "handleWebxdcFileOpen", "path", "buffer", "res", "openUrlsAndFilesFromArgv", "argv", "args_loop", "i", "arg", "expectedScheme", "supportedURISchemes", "_event", "showDeltaChat", "init_cjs_shim", "init_cjs_shim", "parseThemeMetaData", "rawTheme", "meta_data_block", "regex", "meta", "last_result", "HIDDEN_THEME_PREFIX", "existsSync", "watchFile", "readFile", "readdir", "join", "basename", "rawApp", "ipcMain", "nativeTheme", "app", "log", "getLogger", "dc_theme_dir", "htmlDistDir", "readThemeDir", "path", "prefix", "files", "f", "address", "file_content", "theme_meta", "parseThemeMetaData", "HIDDEN_THEME_PREFIX", "error", "getAvailableThemes", "getCustomThemesPath", "loadTheme", "theme_address", "effective_path", "resolveThemeAddress", "themedata", "systemDefault", "addressParts", "realPath", "result", "acceptThemeCLI", "DesktopSettings", "curr", "prev", "send", "electron", "dialog", "Menu", "MenuItem", "nativeTheme", "session", "shell", "WebContentsView", "clipboard", "join", "platform", "log", "getLogger", "open_windows", "openHtmlEmailWindow", "account_id", "message_id", "isContactRequest", "subject", "from", "receiveTime", "htmlEmail", "window_id", "initialBounds", "DesktopSettings", "window", "appIcon", "truncateText", "htmlDistDir", "main_exports", "setContentProtection", "removeScreenChangeListeners", "initMinWinDimensionHandling", "loadRemoteContentAtStart", "_", "tx", "loadTheme", "e", "_url", "context_menu_handle", "isMac", "makeMenu", "getAppMenu", "getFileMenu", "sandboxedView", "getHelpMenu", "refresh", "makeBrowserView", "createContextMenu", "_ev", "x", "y", "menuItems", "newValue", "update_restrictions", "menu", "bounds", "contentZoomFactor", "windowZoomFactor", "window_bounds", "content_size", "new_w", "new_h", "new_y", "allow_network", "skip_sideeffects", "buttons", "item", "result", "b", "CSP_DENY", "CSP_ALLOW", "allow_remote_content", "html_content", "ses", "callback", "req", "response", "getDCJsonrpcClient", "blob", "error", "openLink", "url", "isInviteLink", "open_url", "prefix", "urlWithoutPrefix", "lastFragment", "details", "win", "webContents", "handleContextMenu", "_event", "props", "editFlags", "hasText", "init_cjs_shim", "init_cjs_shim", "app", "BrowserWindow", "protocol", "ipcMain", "session", "screen", "Mime", "Menu", "nativeImage", "shell", "dialog", "clipboard", "join", "dirname", "fileURLToPath", "platform", "readdir", "stat", "rmdir", "writeFile", "readFile", "existsSync", "__dirname", "log", "getLogger", "open_apps", "accounts_sessions", "CSP", "ALLOWED_PERMISSIONS", "WRAPPER_PATH", "BOUNDS_UI_CONFIG_PREFIX", "DEFAULT_SIZE_WEBXDC", "DEFAULT_SIZE_MAP", "DCWebxdc", "controller", "request", "a", "m", "accountId", "messageId", "icon", "blob", "error", "openWebxdc", "_ev", "msg_id", "p", "defaultSize", "webxdcInfo", "chatName", "href", "base64EncodedHref", "appURL", "url", "relativeUrl", "window", "icon_blob", "ses", "sessionFromAccountId", "args", "webxdcProtocolHandler", "app_icon", "webxdcWindow", "partitionFromAccountId", "DesktopSettings", "htmlDistDir", "makeTitle", "setContentProtection", "lastBounds", "size", "adjustSize", "bounds", "isMac", "makeMenu", "getAppMenu", "getFileMenu", "getEditMenu", "tx", "response", "refresh", "ev", "denyPreventUnload", "loggedPermissionRequests", "permission_handler", "permission", "isAllowed", "_wc", "callback", "event", "input", "lookupAppFromEvent", "serial", "update", "file", "text", "file_name", "base64_content", "icon_data_url", "path", "writeTempFileFromBase64", "instanceId", "instance", "payload", "chatId", "name", "webxdcId", "s", "evt", "msgId", "relatedChatInfo", "accountInfo", "key", "messageWithMap", "raw", "open_app", "rpc", "makeResponse", "body", "responseInit", "mime_type", "headers", "id", "account", "msg", "filename", "mimeType", "displayName", "selfAddr", "truncateText", "_", "cache_size", "real_total_size", "get_recursive_folder_size", "empty_size", "total_size", "data_size", "exclude_list", "item", "item_path", "stats", "webxdcStartUpCleanup", "partitions_dir", "getConfigPath", "folders", "folder", "screenHeight", "screenWidth", "init_cjs_shim", "init_cjs_shim", "BuildInfo", "spawn", "app", "dialog", "arch", "platform", "log", "getLogger", "StdioServer", "on_data", "accounts_path", "cmd_path", "err", "getLogsPath", "buffer", "data", "n", "message", "errorLog", "ERROR_LOG_LENGTH", "code", "signal", "BuildInfo", "init_cjs_shim", "startDeltaChat", "existsSync", "lstatSync", "join", "mkdir", "readdir", "rename", "rm", "rmdir", "stat", "migrateAccountsIfNeeded", "cwd", "log", "treatFailedMigrationAsError", "tmpDC", "eventLogger", "accountId", "event", "configPath", "accountFoldersFormat1", "folderName", "path", "db_path", "error", "migrateFromFormat1", "migrateFromFormat2", "path_accounts", "pathAccountsOld", "oldFoldersToDelete", "folder", "pathDBFile", "blobsFolder", "entry", "path_dbfile", "account_id", "old_sticker_folder", "blobdir", "new_sticker_folder", "oldFolder", "f", "err", "rawApp", "ipcMain", "EventEmitter", "yerpc", "BaseDeltaChat", "getRPCServerPath", "app", "log", "getLogger", "logCoreEvent", "ElectronMainTransport", "sender", "message", "JRPCDeltaChat", "DeltaChatController", "cwd", "migrateAccountsIfNeeded", "DesktopSettings", "serverPath", "rc_default", "StdioServer", "response", "mainProcessTransport", "error", "send", "result", "contextId", "event", "event_clone", "_ev", "account", "DCWebxdc", "copyFile", "writeFile", "mkdir", "rm", "rawApp", "clipboard", "dialog", "ipcMain", "nativeImage", "shell", "systemPreferences", "path", "basename", "extname", "join", "posix", "sep", "dirname", "normalize", "inspect", "platform", "existsSync", "versions", "fileURLToPath", "__dirname", "log", "getLogger", "app", "dcController", "getDCJsonrpcClient", "init", "cwd", "logHandler", "main", "main_exports", "DeltaChatController", "error", "getLogsPath", "_e", "channel", "level", "stacktrace", "args", "event", "filePath", "icon", "htmlDistDir", "size", "buffer", "i", "_ev", "locale", "anchor", "openHelpWindow", "window", "ev", "getConfigPath", "info", "appx", "BuildInfo", "arg", "mediaType", "resolve", "options", "returnValue", "lastSaveDialogLocation", "pathToSource", "filename", "base_path", "canceled", "DesktopSettings", "key", "value", "updateTrayIcon", "updateContentProtectionOnAllActiveWindows", "_", "count", "set_has_unread", "name", "content", "writeTempFileFromBase64", "writeTempFile", "pathToFile", "copyFileToInternalTmpDir", "removeTempFile", "url", "mapPackagePath", "image", "text", "file", "isDefaultPicture", "originalFilePath", "bgDir", "fileName", "newPath", "accountId", "messageId", "isContactRequest", "subject", "sender", "receiveTime", "openHtmlEmailWindow", "getDraftTempDir", "sourcePath", "sourceFileName", "sourceDir", "destinationDir", "INTERNAL_TMP_DIR_NAME", "targetPath", "init_cjs_shim", "platform", "app", "Notification", "nativeImage", "ipcMain", "log", "getLogger", "isMac", "showNotification", "clearNotificationsForChat", "clearAll", "createNotification", "data", "icon", "appIcon", "notificationOptions", "filterNotificationText", "onClickNotification", "accountId", "chatId", "msgId", "_ev", "send", "show", "window", "notifications", "_event", "notify", "Event", "n", "error", "_", "text", "init_cjs_shim", "app", "mkdir", "readdir", "rm", "rmdir", "join", "readdirSync", "log", "getLogger", "cleanupDraftTempDir", "path", "getDraftTempDir", "files", "promises", "file", "error", "cleanupInternalTempDirs", "deletedTmpDirs", "tmpDirents", "getAccountsPath", "dirent", "accountDir", "tmpDir", "INTERNAL_TMP_DIR_NAME", "mkdirSync", "watchFile", "rawApp", "dialog", "ipcMain", "protocol", "hostRules", "rc_default", "BuildInfo", "getHelpMenu", "app", "getConfigPath", "getLogsPath", "getCustomThemesPath", "logHandler", "createLogHandler", "log", "getLogger", "setLogHandler", "err", "error", "resolve", "_reject", "DesktopSettings", "isWindowsStorePackage", "webxdcStartUpCleanup", "onReady", "platform", "arch", "ipc_shutdown_function", "_appReady", "_loadedState", "_appx", "_webxdc_cleanup", "acceptThemeCLI", "setLanguage", "cwd", "getAccountsPath", "init", "toggleDevTools", "join", "getLocaleDirectoryPath", "curr", "prev", "chooseLanguage", "getCurrentLocaleDate", "cleanupLogFolder", "cleanupDraftTempDir", "cleanupInternalTempDirs", "initialisePowerMonitor", "window", "updateTrayIcon", "hideDeltaChat", "quit", "doQuit", "showDeltaChat", "_ev", "contents", "webxdcOpenUrl", "url", "open_url", "ev", "navigationUrl", "_details", "e", "event", "_webPreferences", "_params", "electron_context_menu_default", "openUrlsAndFilesFromArgv"]
}
